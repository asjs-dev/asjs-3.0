var WebGl={};(function(){c3(WebGl,"MatrixUtils");var n=WebGl.MatrixUtils;rof(WebGl.MatrixUtils,"isPointInMatrix",function(M,m,bk,bl){n.inverse(m,bk);n.multiplyVector(bk,M,bl);return bl[0]>=0&&bl[1]>=0&&bl[0]<=1&&bl[1]<=1});rof(WebGl.MatrixUtils,"transformTexture2D",function(x,y,t,A,w,B,p,U){var c=_m.cos(t);var s=_m.sin(t);U[0]=c*B;U[1]=s*B;U[4]=-s*p;U[5]=c*p;U[12]=(U[0]*-A+U[4]*-w)+x;U[13]=(U[1]*-A+U[5]*-w)+y});rof(WebGl.MatrixUtils,"transform2D",function(m,x,y,z,t,A,w,B,p,U){n.translateDst(m,x,y,z,U);n.zRotate(U,t);n.translate(U,-A,-w,0);n.scale(U,B,p,1)});rof(WebGl.MatrixUtils,"transform",function(m,x,y,z,r,q,t,A,w,u,B,p,o,U){n.translateDst(m,x,y,z,U);n.xRotate(U,r);n.yRotate(U,q);n.zRotate(U,t);n.translate(U,-A,-w,-u);n.scale(U,B,p,o)});rof(WebGl.MatrixUtils,"multiply",function(a,b,U){U[0]=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];U[1]=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13];U[2]=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14];U[3]=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15];U[4]=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12];U[5]=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13];U[6]=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14];U[7]=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15];U[8]=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12];U[9]=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13];U[10]=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14];U[11]=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15];U[12]=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12];U[13]=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13];U[14]=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14];U[15]=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15]});rof(WebGl.MatrixUtils,"multiplyVector",function(a,b,U){U[0]=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];U[1]=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13];U[2]=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14];U[3]=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15]});rof(WebGl.MatrixUtils,"length",function(v){return _m.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])});rof(WebGl.MatrixUtils,"identity",function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])});rof(WebGl.MatrixUtils,"perspective",function(bD,bm,X,V){var f=_m.tan(_m.PI*0.5-bD*0.5);var bB=1.0/(X-V);return new Float32Array([f/bm,0,0,0,0,f,0,0,0,0,(X+V)*bB,-1,0,0,X*V*bB*2,0])});rof(WebGl.MatrixUtils,"orthographic",function(W,bh,bA,S,X,V){return new Float32Array([2/(bh-W),0,0,0,0,2/(S-bA),0,0,0,0,2/(X-V),0,(W+bh)/(W-bh),(bA+S)/(bA-S),(X+V)/(X-V),1])});rof(WebGl.MatrixUtils,"translate",function(m,i,h,g){var R=m[12];var Q=m[13];var T=m[14];var P=m[15];m[12]=m[0]*i+m[4]*h+m[8]*g+R;m[13]=m[1]*i+m[5]*h+m[9]*g+Q;m[14]=m[2]*i+m[6]*h+m[10]*g+T;m[15]=m[3]*i+m[7]*h+m[11]*g+P});rof(WebGl.MatrixUtils,"translateDst",function(m,i,h,g,U){U[0]=m[0];U[1]=m[1];U[2]=m[2];U[3]=m[3];U[4]=m[4];U[5]=m[5];U[6]=m[6];U[7]=m[7];U[8]=m[8];U[9]=m[9];U[10]=m[10];U[11]=m[11];U[12]=m[0]*i+m[4]*h+m[8]*g+m[12];U[13]=m[1]*i+m[5]*h+m[9]*g+m[13];U[14]=m[2]*i+m[6]*h+m[10]*g+m[14];U[15]=m[3]*i+m[7]*h+m[11]*g+m[15]});rof(WebGl.MatrixUtils,"xRotation",function(bC,U){var c=_m.cos(bC);var s=_m.sin(bC);U[0]=1;U[1]=0;U[2]=0;U[3]=0;U[4]=0;U[5]=c;U[6]=s;U[7]=0;U[8]=0;U[9]=-s;U[10]=c;U[11]=0;U[12]=0;U[13]=0;U[14]=0;U[15]=1});rof(WebGl.MatrixUtils,"xRotate",function(m,bC){var N=m[4];var C=m[5];var D=m[6];var E=m[7];var G=m[8];var H=m[9];var I=m[10];var F=m[11];var c=_m.cos(bC);var s=_m.sin(bC);m[4]=c*N+s*G;m[5]=c*C+s*H;m[6]=c*D+s*I;m[7]=c*E+s*F;m[8]=c*G-s*N;m[9]=c*H-s*C;m[10]=c*I-s*D;m[11]=c*F-s*E});rof(WebGl.MatrixUtils,"xRotateDst",function(m,bC,U){var N=m[4];var C=m[5];var D=m[6];var E=m[7];var G=m[8];var H=m[9];var I=m[10];var F=m[11];var c=_m.cos(bC);var s=_m.sin(bC);U[4]=c*N+s*G;U[5]=c*C+s*H;U[6]=c*D+s*I;U[7]=c*E+s*F;U[8]=c*G-s*N;U[9]=c*H-s*C;U[10]=c*I-s*D;U[11]=c*F-s*E;U[0]=m[0];U[1]=m[1];U[2]=m[2];U[3]=m[3];U[12]=m[12];U[13]=m[13];U[14]=m[14];U[15]=m[15]});rof(WebGl.MatrixUtils,"yRotation",function(bC,U){var c=_m.cos(bC);var s=_m.sin(bC);U[0]=c;U[1]=0;U[2]=-s;U[3]=0;U[4]=0;U[5]=1;U[6]=0;U[7]=0;U[8]=s;U[9]=0;U[10]=c;U[11]=0;U[12]=0;U[13]=0;U[14]=0;U[15]=1});rof(WebGl.MatrixUtils,"yRotate",function(m,bC){var J=m[0];var O=m[1];var K=m[2];var L=m[3];var G=m[8];var H=m[9];var I=m[10];var F=m[11];var c=_m.cos(bC);var s=_m.sin(bC);m[0]=c*J-s*G;m[1]=c*O-s*H;m[2]=c*K-s*I;m[3]=c*L-s*F;m[8]=c*G+s*J;m[9]=c*H+s*O;m[10]=c*I+s*K;m[11]=c*F+s*L});rof(WebGl.MatrixUtils,"yRotateDst",function(m,bC,U){var J=m[0];var O=m[1];var K=m[2];var L=m[3];var G=m[8];var H=m[9];var I=m[10];var F=m[11];var c=_m.cos(bC);var s=_m.sin(bC);U[0]=c*J-s*G;U[1]=c*O-s*H;U[2]=c*K-s*I;U[3]=c*L-s*F;U[8]=c*G+s*J;U[9]=c*H+s*O;U[10]=c*I+s*K;U[11]=c*F+s*L;U[4]=m[4];U[5]=m[5];U[6]=m[6];U[7]=m[7];U[12]=m[12];U[13]=m[13];U[14]=m[14];U[15]=m[15]});rof(WebGl.MatrixUtils,"zRotation",function(bC,U){var c=_m.cos(bC);var s=_m.sin(bC);U[0]=c;U[1]=s;U[2]=0;U[3]=0;U[4]=-s;U[5]=c;U[6]=0;U[7]=0;U[8]=0;U[9]=0;U[10]=1;U[11]=0;U[12]=0;U[13]=0;U[14]=0;U[15]=1});rof(WebGl.MatrixUtils,"zRotate",function(m,bC){var J=m[0];var O=m[1];var K=m[2];var L=m[3];var N=m[4];var C=m[5];var D=m[6];var E=m[7];var c=_m.cos(bC);var s=_m.sin(bC);m[0]=c*J+s*N;m[1]=c*O+s*C;m[2]=c*K+s*D;m[3]=c*L+s*E;m[4]=c*N-s*J;m[5]=c*C-s*O;m[6]=c*D-s*K;m[7]=c*E-s*L});rof(WebGl.MatrixUtils,"zRotateDst",function(m,bC,U){var J=m[0];var O=m[1];var K=m[2];var L=m[3];var N=m[4];var C=m[5];var D=m[6];var E=m[7];var c=_m.cos(bC);var s=_m.sin(bC);U[0]=c*J+s*N;U[1]=c*O+s*C;U[2]=c*K+s*D;U[3]=c*L+s*E;U[4]=c*N-s*J;U[5]=c*C-s*O;U[6]=c*D-s*K;U[7]=c*E-s*L;U[8]=m[8];U[9]=m[9];U[10]=m[10];U[11]=m[11];U[12]=m[12];U[13]=m[13];U[14]=m[14];U[15]=m[15]});rof(WebGl.MatrixUtils,"scaling",function(B,p,o,U){U[0]=B;U[1]=0;U[2]=0;U[3]=0;U[4]=0;U[5]=p;U[6]=0;U[7]=0;U[8]=0;U[9]=0;U[10]=o;U[11]=0;U[12]=0;U[13]=0;U[14]=0;U[15]=1});rof(WebGl.MatrixUtils,"scale",function(m,B,p,o){m[0]=B*m[0];m[1]=B*m[1];m[2]=B*m[2];m[3]=B*m[3];m[4]=p*m[4];m[5]=p*m[5];m[6]=p*m[6];m[7]=p*m[7];m[8]=o*m[8];m[9]=o*m[9];m[10]=o*m[10];m[11]=o*m[11]});rof(WebGl.MatrixUtils,"scaleDst",function(m,B,p,o,U){U[0]=B*m[0];U[1]=B*m[1];U[2]=B*m[2];U[3]=B*m[3];U[4]=p*m[4];U[5]=p*m[5];U[6]=p*m[6];U[7]=p*m[7];U[8]=o*m[8];U[9]=o*m[9];U[10]=o*m[10];U[11]=o*m[11];U[12]=m[12];U[13]=m[13];U[14]=m[14];U[15]=m[15]});rof(WebGl.MatrixUtils,"inverse",function(m,U){var J=m[0];var O=m[1];var K=m[2];var L=m[3];var N=m[4];var C=m[5];var D=m[6];var E=m[7];var G=m[8];var H=m[9];var I=m[10];var F=m[11];var R=m[12];var Q=m[13];var T=m[14];var P=m[15];var bg=I*P;var bf=T*F;var bi=D*P;var be=T*E;var Y=D*F;var bc=I*E;var bb=K*P;var ba=T*L;var bd=K*F;var Z=I*L;var bz=K*E;var by=D*L;var bx=G*Q;var bw=R*H;var bv=N*Q;var bu=R*C;var bs=N*H;var bt=G*C;var bj=J*Q;var br=R*O;var bq=J*H;var bp=G*O;var bo=J*C;var bn=N*O;var e=(bg*C+be*H+Y*Q)-(bf*C+bi*H+bc*Q);var j=(bf*O+bb*H+Z*Q)-(bg*O+ba*H+bd*Q);var k=(bi*O+ba*C+bz*Q)-(be*O+bb*C+by*Q);var l=(bc*O+bd*C+by*H)-(Y*O+Z*C+bz*H);var d=1.0/(J*e+N*j+G*k+R*l);U[0]=d*e;U[1]=d*j;U[2]=d*k;U[3]=d*l;U[4]=d*((bf*N+bi*G+bc*R)-(bg*N+be*G+Y*R));U[5]=d*((bg*J+ba*G+bd*R)-(bf*J+bb*G+Z*R));U[6]=d*((be*J+bb*N+by*R)-(bi*J+ba*N+bz*R));U[7]=d*((Y*J+Z*N+bz*G)-(bc*J+bd*N+by*G));U[8]=d*((bx*E+bu*F+bs*P)-(bw*E+bv*F+bt*P));U[9]=d*((bw*L+bj*F+bp*P)-(bx*L+br*F+bq*P));U[10]=d*((bv*L+br*E+bo*P)-(bu*L+bj*E+bn*P));U[11]=d*((bt*L+bq*E+bn*F)-(bs*L+bp*E+bo*F));U[12]=d*((bv*I+bt*T+bw*D)-(bs*T+bx*D+bu*I));U[13]=d*((bq*T+bx*K+br*I)-(bj*I+bp*T+bw*K));U[14]=d*((bj*D+bn*T+bu*K)-(bo*T+bv*K+br*D));U[15]=d*((bo*I+bs*K+bp*D)-(bq*D+bn*I+bt*K))})})();c1(WebGl,"Utils",ASJS.BaseClass,function(f){var r={};f.new=x;get(f,"webGlInfo",function(){return r});function x(){r.isWebGl2Supported=!1;map(["webgl2"],function(a,d){var i=_d.createElement("canvas");var n;if(n=i.getContext(d)){r.isWebGl2Supported=!0;r.maxTextureImageUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);r.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE);r.maxVertexAttributes=n.getParameter(n.MAX_VERTEX_ATTRIBS);r.maxVaryingVectors=n.getParameter(n.MAX_VARYING_VECTORS);r.maxVertexUniformVectors=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS);r.maxFragmentUniformComponents=n.getParameter(n.MAX_FRAGMENT_UNIFORM_COMPONENTS);r.maxFragmentUniformVectors=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS);r.maxVaryingComponents=n.getParameter(n.MAX_VARYING_COMPONENTS);r.canShaderRun=r.maxVertexAttributes>=8&&r.maxVaryingVectors>=5&&r.maxVaryingComponents>=20&&r.maxFragmentUniformComponents>=199&&r.maxFragmentUniformVectors>=6}})};f.bindTexture2DSource=function(b,u){b.activeTexture(b.TEXTURE0+r.maxTextureImageUnits+1);b.bindTexture(u.target,u.texture);if(u.source.tagName.toLowerCase()!=="video"){b.texImage2D(u.target,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u.source)};b.texParameteri(u.target,b.TEXTURE_WRAP_S,u.wrapS);b.texParameteri(u.target,b.TEXTURE_WRAP_T,u.wrapT);b.texParameteri(u.target,b.TEXTURE_MIN_FILTER,u.minFilter);b.texParameteri(u.target,b.TEXTURE_MAG_FILTER,u.magFilter);b.generateMipmap(u.target)};f.useTexture=function(b,e,u){b.activeTexture(b.TEXTURE0+e);b.bindTexture(u.target,u.texture);if(u.shouldUpdate){b.texImage2D(u.target,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u.source)}};f.loadShader=function(b,s,v){var g=b.createShader(b[s]);b.shaderSource(g,v);b.compileShader(g);var o=b.getShaderParameter(g,b.COMPILE_STATUS);if(!o){var p=b.getShaderInfoLog(g);trc("Error compiling shader "+s+":"+p);b.deleteShader(g);return null};return g};f.createProgram=function(b,l,t,w){var k=b.createProgram();map(l,function(c,g){b.attachShader(k,g)});if(t){map(t,function(c,j){b.bindAttribLocation(k,w?w[c]:c,j)})};b.linkProgram(k);var h=b.getProgramParameter(k,b.LINK_STATUS);if(!h){var p=b.getProgramInfoLog(k);trc("Error in program linking:"+p);b.deleteProgram(k);return null};return k};f.getLocationsFor=function(b,k,z){var q={};map(z,function(c,y){q[c]=b[y](k,c)});return q};f.destroyTexture=function(b,m){b.bindTexture(m.target,null);b.deleteTexture(m.texture)}});cnst(WebGl.Utils,"ShaderType",{"VERTEX_SHADER":"VERTEX_SHADER","FRAGMENT_SHADER":"FRAGMENT_SHADER"});c0(WebGl,"Bitmap",ASJS.DisplayObject,function(b,c){b.clearColor=ASJS.Color.toFloat(ASJS.Color.create());var a;ASJS.CanvasApi.initBaseCanvas(b,c);ovrd(b,c,"new");b.new=function(e,f,g){c.new("canvas");if(!g)g={};g.premultipliedAlpha=!0;g.preserveDrawingBuffer=!0;g.stencil=!0;g.depth=!0;c.prot.contextAttributes=g;c.prot.contextType="webgl2";b.setBitmapSize(e,f);a=b.getContext();a.enable(a.BLEND);a.depthMask(!0);a.enable(a.DEPTH_TEST);a.depthFunc(a.ALWAYS);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);a.enable(a.SCISSOR_TEST);b.updateScissor()};b.clearRect=function(x,y,w,h){b.setDrawArea(x,y,w,h);var d=b.clearColor;a.clearColor(d[0],d[1],d[2],d[3]);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)};ovrd(b,c,"destruct");b.destruct=function(){b.clearColor=a=null;b.destructBaseCanvasApi();c.destruct()};b.setDrawArea=function(x,y,w,h){a.scissor(x,b.bitmapHeight-y-h,w,h);a.viewport(0,0,b.bitmapWidth,b.bitmapHeight)};b.updateScissor=function(){if(a)a.scissor(0,0,b.bitmapWidth,b.bitmapHeight);b[de](WebGl.Bitmap.RESIZE)};b.update=b.updateScissor});msg(WebGl.Bitmap,"RESIZE");c3(WebGl,"Config");rof(WebGl.Config,"create",function(c,b,a){return{"showLights":c,"useMask":b,"filters":a}});c3(WebGl,"BlendModes");cnst(WebGl.BlendModes,"NORMAL",["SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","ONE_MINUS_SRC_ALPHA"]);cnst(WebGl.BlendModes,"ADD",["SRC_ALPHA","DST_ALPHA","ONE","DST_ALPHA"]);cnst(WebGl.BlendModes,"MULTIPLY",["DST_COLOR","ONE_MINUS_SRC_ALPHA"]);cnst(WebGl.BlendModes,"SCREEN",["SRC_ALPHA","ONE_MINUS_SRC_COLOR","ONE","ONE_MINUS_SRC_COLOR"]);cnst(WebGl.BlendModes,"OVERLAY",["ONE","ONE_MINUS_SRC_ALPHA"]);c0(WebGl,"Texture",ASJS.EventDispatcher,function(c,d){var k=WebGl.Utils.instance;c.shouldUpdate=!1;var b;var h;var o;var g;var i;var f=!1;var j=!1;c.new=function(a,e,n){b=a;h=b.TEXTURE_2D;i=b.createTexture();c.wrapS=a.CLAMP_TO_EDGE;c.wrapT=a.CLAMP_TO_EDGE;c.minFilter=a.NEAREST;c.magFilter=a.NEAREST;c.source=e;c.shouldUpdate=n};get(c,"loaded",function(){return f});get(c,"target",function(){return h});get(c,"texture",function(){return i});prop(c,"source",{get:function(){return g},set:function(v){g=v;tis(g,"string")?m():l()}});ovrd(c,d,"destruct");c.destruct=function(){o[off](ASJS.LoaderEvent.LOAD,p);o.destruct();b=h=i=f=o=g=null;d.destruct()};function l(){k.bindTexture2DSource(b,c)};function m(){o=o||new ASJS.Image();f=!1;o[off](ASJS.LoaderEvent.LOAD,p);o[on](ASJS.LoaderEvent.LOAD,p);o.src=g};function p(){o[off](ASJS.LoaderEvent.LOAD,p);g=o.el;l();f=!0;c[de](ASJS.LoaderEvent.LOAD)}});c0(WebGl,"Item",ASJS.BaseClass,function(f,g){f.props={"x":0,"y":0,"z":0,"rotationZ":0,"scaleX":1,"scaleY":1,"width":1,"height":1,"anchorX":0,"anchorY":0,};f.color={"r":1,"g":1,"b":1,"a":1};f.renderable=!0;f.interactive=!1;f.matrixCache=WebGl.MatrixUtils.identity();f.colorCache=new Float32Array(4);f.parentMatrix=null;g.prot.updateList=[];var h=null;f.new=function(){f.shouldUpdateProps();f.shouldUpdateColorCache()};prop(f,"parent",{get:function(){return h},set:function(v){if(emp(v)||v.getChildIndex(f)>-1)h=v}});get(f,"stage",function(){return f.parent?f.parent.stage:null});ovrd(f,g,"destruct");f.destruct=function(){f.props=f.color=f.renderable=f.colorCache=f.matrixCache=f.parentMatrix=f.parent=null;g.destruct()};f.preRender=function(){};f.postRender=function(){};f.shouldUpdateProps=function(){g.prot.updateList.addUnique(g.prot.updateProps)};f.shouldUpdateColorCache=function(){g.prot.updateList.addUnique(g.prot.updateColorCache)};f.update=function(i){var a;while(a=g.prot.updateList.shift())a(i)};g.prot.updateProps=function(i){var d=f.props;var b=d.scaleX;var c=d.scaleY;i(f.parentMatrix,d.x,d.y,d.z,d.rotationZ,d.anchorX*b,d.anchorY*c,d.width*b,d.height*c,f.matrixCache)};g.prot.updateColorCache=function(){var e=f.color;f.colorCache[0]=e.r;f.colorCache[1]=e.g;f.colorCache[2]=e.b;f.colorCache[3]=e.a}});c0(WebGl,"Light",WebGl.Item,function(a,b){a.effect={"anchorX":0,"anchorY":0,"quadX":1,"quadY":1};a.positionCache=new Float32Array(3);a.volumeCache=new Float32Array(3);a.effectCache=new Float32Array(4);var d={};ovrd(a,b,"destruct");a.destruct=function(){a.effect=a.positionCache=a.volumeCache=a.effectCache=d=null;b.destruct()};ovrd(b.protected,d,"updateProps");b.prot.updateProps=function(c){d.updateProps(c);a.positionCache[0]=a.matrixCache[12];a.positionCache[1]=a.matrixCache[13];a.positionCache[2]=a.matrixCache[14];a.volumeCache[0]=a.matrixCache[0];a.volumeCache[1]=a.matrixCache[5];a.volumeCache[2]=a.matrixCache[10];a.effectCache[0]=a.effect.anchorX;a.effectCache[1]=a.effect.anchorY;a.effectCache[2]=a.effect.quadX;a.effectCache[3]=a.effect.quadY}});c0(WebGl,"Image",WebGl.Item,function(a,b){var e=WebGl.MatrixUtils;a.textureProps={"x":0,"y":0,"rotationZ":0,"width":1,"height":1,"anchorX":0,"anchorY":0,"crop":{"x":0,"y":0,"width":1,"height":1}};a.textureMatrixCache=e.identity();a.texture;a.mask;a.tintType=WebGl.Image.Tint.NORMAL;a.blendMode=WebGl.BlendModes.NORMAL;a.textureCropCache=new Float32Array(4);ovrd(a,b,"new");a.new=function(c){b.new();a.texture=c;a.shouldUpdateTextureProps();a.shouldUpdateTextureCrop()};ovrd(a,b,"destruct");a.destruct=function(){a.textureProps=a.textureCrop=a.textureMatrixCache=a.textureCropCache=a.tintType=a.texture=null;b.destruct()};a.shouldUpdateTextureProps=function(){b.prot.updateList.addUnique(b.prot.updateTextureProps)};a.shouldUpdateTextureCrop=function(){b.prot.updateList.addUnique(b.prot.updateTextureCrop)};b.prot.updateTextureProps=function(){var f=a.textureProps;e.transformTexture2D(f.x,f.y,f.rotationZ,f.anchorX,f.anchorY,f.width,f.height,a.textureMatrixCache)};b.prot.updateTextureCrop=function(){var d=a.textureProps.crop;a.textureCropCache[0]=d.x;a.textureCropCache[1]=d.y;a.textureCropCache[2]=d.width;a.textureCropCache[3]=d.height}});cnst(WebGl.Image,"Tint",{"NORMAL":0,"GRAYSCALE":1,"OVERRIDE":2,});c0(WebGl,"AnimatedImage",WebGl.Image,function(c,d){c.frameLength=120;c.frame=0;c.frames=[];c.isPlaying=!1;var g=-1;c.gotoAndStop=function(b){c.frame=b};c.gotoAndPlay=function(b){c.frame=b;c.play()};c.stop=function(){c.isPlaying=!1};c.play=function(){c.isPlaying=!0};c.postRender=function(a){if(c.isPlaying){var f=a-g;if(f>=c.frameLength){g=a;c.frame+=_m.floor(f/c.frameLength);c.frame>=c.frames.length&&(c.frame=0);h()}}};ovrd(c,d,"destruct");c.destruct=function(){c.stop();c.frameLength=c.frame=c.frames=c.isPlaying=null;d.destruct()};function h(){var e=c.frames[c.frame];c.textureCropCache[0]=e.x;c.textureCropCache[1]=e.y;c.textureCropCache[2]=e.width;c.textureCropCache[3]=e.height}});c0(WebGl,"Container",WebGl.Item,function(e,f){var j=[];var n=!0;var m;prop(e,"mouseChildren",{get:function(){return n},set:function(v){n=v;var i=e.numChildren;while(i--)e.getChildAt(i).enabled=n}});get(e,"numChildren",function(){return j.length});e.clear=function(){while(e.numChildren)e.removeChildAt(0)};e.contains=function(b){return e.getChildIndex(b)>-1};e.addChild=function(b){return e.addChildAt(b,e.numChildren)};e.addChildAt=function(b,c){if(!b)return null;if(b.parent)b.parent.removeChild(b);b.enabled=b.enabled?n:b.enabled;j.push(b);e.setChildIndex(b,c);b.parent=e;if(is(b,WebGl.Container))b.setParentColor(e.colorCache);b.parentMatrix=e.matrixCache;return b};e.removeChild=function(b){if(!b||!e.contains(b))return null;j.remove(b);if(is(b,WebGl.Container))b.setParentColor(null);b.parentMatrix=null;b.parent=null;return b};e.removeChildAt=function(c){return e.removeChild(e.getChildAt(c))};e.getChildAt=function(c){return j[c]};e.setChildIndex=function(b,c){if(!b||c<0)return null;j.remove(b);j.splice(c,0,b);return b};e.getChildIndex=function(b){return j.indexOf(b)};e.swapChildren=function(g,h){var k=e.getChildIndex(g);var l=e.getChildIndex(h);if(k===-1||l===-1)return!1;e.setChildIndex(g,l);e.setChildIndex(h,k);return!0};e.setParentColor=function(v){m=v};ovrd(e,f,"destruct");e.destruct=function(){if(_parent&&_parent.removeChild)_parent.removeChild(e);j=n=m=_parent=null;f.destruct()};ovrd(e,f,"shouldUpdateProps");e.shouldUpdateProps=function(){o("shouldUpdateProps")};ovrd(e,f,"shouldUpdateColorCache");e.shouldUpdateColorCache=function(){o("shouldUpdateColorCache")};f.prot.updateColorCache=function(){var d=e.color;e.colorCache[0]=m[0]*d.r;e.colorCache[1]=m[1]*d.g;e.colorCache[2]=m[2]*d.b;e.colorCache[3]=m[3]*d.a};function o(a){f[a]();for(var i=0;i<j.length;i++)j[i][a]()}});c0(WebGl,"Stage2D",WebGl.Container,function(q,p){var O=WebGl.Utils.instance;var bb=WebGl.MatrixUtils;var bE=bb.transform2D;var j={};cnst(j,"DEFAULT_DOU",[0,0]);cnst(j,"DEFAULT_TRI",[0,0,0]);cnst(j,"DEFAULT_QUAD",[0,0,0,0]);cnst(j,"SHADER_LOCATIONS",{"a_position":"getAttribLocation","a_matrix":"getAttribLocation","a_texMatrix":"getAttribLocation","a_texCrop":"getAttribLocation","a_fillColor":"getAttribLocation","a_texId":"getAttribLocation","a_maskTexId":"getAttribLocation","a_tintColor":"getAttribLocation","a_tintType":"getAttribLocation","u_resolution":"getUniformLocation","u_texIds":"getUniformLocation","u_lightPositions":"getUniformLocation","u_lightVolumes":"getUniformLocation","u_lightColors":"getUniformLocation","u_lightEffects":"getUniformLocation","u_fog":"getUniformLocation","u_filters":"getUniformLocation",});q.fog={r:1,g:1,b:1,v:0};var bB=WebGl.BlendModes.NORMAL;var V;var bq;var bK;var bJ;var bC;var L;var bn;var bj;var bk;var bD;var bP;var bO;var bI;var ba;var bz;var by;var M=0;var U=[];var S=[];var bx=[];var bw;var bl;var bd;var bm;var b;var be;var E;var K;var bh=!0;var Y;var w;var A;var I;var P;var bu=[];var bc=!1;var bH=new Float32Array([0,0,0,1]);var bL=new Float32Array(16);var T=new Float32Array(4);var z;var bM;var bA;var bN;ovrd(q,p,"new");q.new=function(N,Z,bp,r){p.new();z=r;be=N;be[on](WebGl.Bitmap.RESIZE,D);b=be.getContext();E=O.createProgram(b,[O.loadShader(b,WebGl.Utils.ShaderType.VERTEX_SHADER,Z(z)),O.loadShader(b,WebGl.Utils.ShaderType.FRAGMENT_SHADER,bp(z))]);K=O.getLocationsFor(b,E,j.SHADER_LOCATIONS);b.useProgram(E);X();var bo=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,bo);b.bufferData(b.ARRAY_BUFFER,new Uint8Array([0,0,1,0,1,1,0,1]),b.STATIC_DRAW);b.enableVertexAttribArray(K["a_position"]);b.vertexAttribPointer(K["a_position"],2,b.BYTE,!1,0,0);if(z.showLights){bw=new Float32Array(16*3);bl=new Float32Array(16*3);bd=new Float32Array(16*4);bm=new Float32Array(16*4)};bM=z.showLights?bi:emptyFunction;V=new Float32Array(10000*16);bk=bF(V,"a_matrix",16,4,4,b.FLOAT,4);bq=new Uint8Array(10000);bD=bF(bq,"a_texId",1,1,1,b.BYTE,0);bJ=new Float32Array(10000*16);bO=bF(bJ,"a_texMatrix",16,4,4,b.FLOAT,4);bC=new Float32Array(10000*4);bI=bF(bC,"a_texCrop",4,1,4,b.FLOAT,4);L=new Float32Array(10000*4);ba=bF(L,"a_fillColor",4,1,4,b.FLOAT,4);bn=new Float32Array(10000*4);bz=bF(bn,"a_tintColor",4,1,4,b.FLOAT,4);bj=new Uint8Array(10000);by=bF(bj,"a_tintType",1,1,1,b.BYTE,0);if(z.useMask){bK=new Uint8Array(10000);bP=bF(bK,"a_maskTexId",1,1,1,b.BYTE,0)};bA=z.useMask?W:emptyFunction;bN=z.useMask?br:emptyFunction;s();q.setParentColor([1,1,1,1]);q.filters=WebGl.Stage2D.Filters.NONE};set(q,"filters",function(f){b.uniform1i(K["u_filters"],f)});get(q,"bitmap",function(){return be});get(q,"stage",function(){return q});get(q,"isComplete",function(){return _isComplete});get(q,"pickedElements",function(){return bu.clone()});q.render=function(){Y=Date.now();bu.length=0;s();G();bM();B(q);M>0&&F();bc=!1};q.isLightAttached=function(m){return bx.has(m)};q.attachLight=function(m){!q.isLightAttached(m)&&bx.length<16&&bx.push(m)};q.detachLight=function(m){bx.remove(m)};q.setPickerPoint=function(x,y){bc=!0;bH[0]=(x-I)*q.parentMatrix[0];bH[1]=(y-P)*q.parentMatrix[5]};ovrd(q,p,"destruct");q.destruct=function(){be[off](WebGl.Bitmap.RESIZE,D);j=Y=O=be=bb=E=bh=K=V=bq=bK=bJ=bC=L=bn=bj=bk=bD=bP=bO=bI=ba=bz=by=U=S=M=bx=bw=bl=bd=bm=w=A=I=P=bH=T=bL=bu=bc=z=bM=bA=bN=null;p.destruct()};function G(){b.uniform4fv(K["u_fog"],[q.fog.r,q.fog.g,q.fog.b,q.fog.v])};function bi(){var m;for(var i=0;i<16;i++){m=i>=bx.length||!bx[i].renderable?null:bx[i];bw.set(m?m.positionCache:j.DEFAULT_TRI,i*3);bl.set(m?m.volumeCache:j.DEFAULT_TRI,i*3);bd.set(m?m.colorCache:j.DEFAULT_QUAD,i*4);bm.set(m?m.effectCache:j.DEFAULT_QUAD,i*4)};m=null;b.uniform3fv(K["u_lightPositions"],bw);b.uniform3fv(K["u_lightVolumes"],bl);b.uniform4fv(K["u_lightColors"],bd);b.uniform4fv(K["u_lightEffects"],bm)};function B(e){if(e.renderable){e.update(bE);if(is(e,WebGl.Container))bg(e);else if(is(e,WebGl.Image))H(e)}};function bg(e){for(var i=0;i<e.numChildren;i++){B(e.getChildAt(i))}};function W(e){bK[M]=R(e.mask)};function H(e){e.preRender();if(bB!==e.blendMode){F();bB=e.blendMode};if(bc&&e.interactive&&bb.isPointInMatrix(bH,e.matrixCache,bL,T)){bu.push(e)};bA(e);var bv=R(e.texture);var v=M*4;var l=M*16;V.set(e.matrixCache,l);bq[M]=bv;bJ.set(e.textureMatrixCache,l);bC.set(e.textureCropCache,v);L.set(e.parent.colorCache,v);bn.set(e.colorCache,v);bj[M]=e.tintType||0;M++;M===10000&&F();e.postRender(Y)};function bF(g,J,t,a,d,h,k){var o=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,o);b.bufferData(b.ARRAY_BUFFER,g.byteLength,b.DYNAMIC_DRAW);bG(K[J],o,g,t,a,d,h,k);return o};function bG(C,o,g,t,a,d,h,k){bs(o,g);var n=k*t;var i=a+1;while(--i){var c=C+(a-i);b.enableVertexAttribArray(c);b[h===b.FLOAT?"vertexAttribPointer":"vertexAttribIPointer"](c,d,h,!1,n,(a-i)*t);b.vertexAttribDivisor(c,1)}};function bs(o,g){b.bindBuffer(b.ARRAY_BUFFER,o);b.bufferSubData(b.ARRAY_BUFFER,0,g)};var br=bs.bind(this);function F(){b.uniform1iv(K["u_texIds"],new Uint8Array(S));bN(bP,bK);bs(bk,V);bs(bD,bq);bs(bO,bJ);bs(bI,bC);bs(ba,L);bs(bz,bn);bs(by,bj);X();b.drawArraysInstanced(b.TRIANGLE_FAN,0,4,M);U.length=S.length=M=0};function R(Q){if(!Q)return 0;var bv=U.indexOf(Q);var bf=bv===-1;if(bf||Q.shouldUpdate){if(bf||!Q.shouldUpdate){U.length===O.webGlInfo.maxTextureImageUnits&&F();U.push(Q);bv=U.length-1;S.push(bv)};O.useTexture(b,bv,Q)};return bv+1};function X(){bB.length===4?b.blendFuncSeparate(b[bB[0]],b[bB[1]],b[bB[2]],b[bB[3]]):b.blendFunc(b[bB[0]],b[bB[1]])};function s(){if(bh){bh=!1;w=be.bitmapWidth;A=be.bitmapHeight;I=w*0.5;P=A*0.5;q.parentMatrix=bb.orthographic(0,w,A,0,-1,1);b.uniform2f(K["u_resolution"],w/A,96/w);q.shouldUpdateProps()}};function D(){bh=!0}});cnst(WebGl.Stage2D,"MAX_LIGHT_SOURCES",16);rof(WebGl.Stage2D,"createVertexShader",function(r){var u="#version 300 es\nprecision lowp float;in vec4 a_position;in mat4 a_matrix;in mat4 a_texMatrix;in vec4 a_texCrop;in vec4 a_fillColor;in vec4 a_tintColor;in int a_texId;";if(r.useMask)u+="in int a_maskTexId;";u+="in int a_tintType;out vec2 v_texCoord;out vec4 v_coord;out vec4 v_texCrop;out vec2 v_texCropSize;out vec4 v_fillColor;out vec4 v_tintColor;flat out int v_texId;";if(r.useMask)u+="flat out int v_maskTexId;";u+="flat out int v_tintType;void main() {gl_Position = a_matrix * a_position;v_texCoord = (a_texMatrix * a_position).xy;v_coord = gl_Position;v_texCrop = a_texCrop;v_texCropSize = v_texCrop.zw - v_texCrop.xy;v_fillColor = a_fillColor;v_texId = a_texId;";if(r.useMask)u+="v_maskTexId = a_maskTexId;";u+="v_tintColor = a_tintColor;v_tintType = a_tintType;}";return u});rof(WebGl.Stage2D,"createFragmentShader",function(r){var bQ=WebGl.Utils.instance.webGlInfo.maxTextureImageUnits;var bt=16;var u="#version 300 es\nprecision lowp float;in vec4 v_coord;in vec2 v_texCoord;in vec4 v_texCrop;in vec2 v_texCropSize;in vec4 v_fillColor;in vec4 v_tintColor;flat in int v_texId;";if(r.useMask)u+="flat in int v_maskTexId;";u+="flat in int v_tintType;uniform sampler2D u_texIds["+bQ+"];uniform vec2 u_resolution;uniform int u_filters;uniform vec4 u_fog;";if(r.showLights){u+="uniform vec3 u_lightPositions["+bt+"];uniform vec3 u_lightVolumes["+bt+"];uniform vec4 u_lightColors["+bt+"];uniform vec4 u_lightEffects["+bt+"];"};u+="out vec4 fragColor;";u+="vec2 coordLimit(vec2 coord, vec2 size, vec4 crop) {return crop.xy + mod(coord * size, size);}";if(r.showLights){u+="vec4 lightValue(vec3 lightPosition, vec3 lightVolume, vec4 lightColor, vec4 lightEffect) {vec2 dist = v_coord.xy - lightPosition.xy;return lightColor * lightColor.a * max(0.0, min(1.0, 1.0 - sqrt(pow(abs(dist.x + (abs(dist.x) * lightEffect.x)), 2.0 * lightEffect.z) * (lightVolume.x / u_resolution.y) + pow(abs(dist.y + (abs(dist.y) * lightEffect.y)), 2.0 * lightEffect.w) * (lightVolume.y / u_resolution.x / u_resolution.y))));}"};u+="void main() {vec2 coord = coordLimit(v_texCoord, v_texCropSize, v_texCrop);";u+="if (v_texId == 0) discard;bool isTexFound = false;";for(var i=0;i<bQ;i++){u+=(i>0?" else ":"")+"if ("+(i>0?"!isTexFound && ":"")+"v_texId == "+(i+1)+") {fragColor = texture(u_texIds["+i+"], coord);isTexFound = true;}"};if(r.useMask){u+="float maskAlpha = 1.0;if (v_maskTexId > 0) {vec2 maskCoord = (v_coord.xy + vec2(1.0, -1.0)) / vec2(2.0, -2.0);bool isMaskTexFound = false;";for(var i=0;i<bQ;i++){u+=(i>0?" else ":"")+"if ("+(i>0?"!isMaskTexFound && ":"")+"v_maskTexId == "+(i+1)+") {maskAlpha = texture(u_texIds["+i+"], maskCoord).a;isMaskTexFound = true;}"};u+="}if (maskAlpha == 0.0) discard;"};u+="if (fragColor.a == 0.0) discard;if (v_tintType == 0) fragColor *= v_tintColor;else if (v_tintType == 1 && fragColor.r == fragColor.g && fragColor.r == fragColor.b) fragColor *= v_tintColor;else if (v_tintType == 2) fragColor = vec4((fragColor.rgb * (1.0 - v_tintColor.a)) + (v_tintColor.rgb * v_tintColor.a), fragColor.a);vec4 lightColor = vec4(0.0);";if(r.showLights){for(var i=0;i<bt;i++){u+="if (u_lightColors["+i+"].a > 0.0 && u_lightPositions["+i+"].z <= v_coord.z) {lightColor += lightValue(u_lightPositions["+i+"], 1.0 / abs(u_lightVolumes["+i+"]), u_lightColors["+i+"], u_lightEffects["+i+"]);}"}};u+="float colorLightMultiply = max(0.0, u_fog.a - lightColor.a);float colorMultiply = max(0.0, 1.0 - colorLightMultiply);vec4 fogColor = vec4(u_fog.rgb * colorLightMultiply, 0.0);vec4 finalColor = vec4(fragColor.rgb * colorMultiply, fragColor.a);fragColor = (finalColor * (v_fillColor + lightColor)) + fogColor;if (fragColor.a == 0.0) discard;";if(r.filters&&r.filters.length>0){u+="if (u_filters > 0) {";for(var i=0;i<r.filters.length;i++){u+="if (("+r.filters[i]+" & u_filters) > 0) {";switch(r.filters[i]){case WebGl.Stage2D.Filters.GRAYSCALE:u+="fragColor = vec4(vec3(1.0) * ((fragColor.r + (fragColor.g + fragColor.b)) / 3.0), fragColor.a);";break;case WebGl.Stage2D.Filters.SEPIA:u+="fragColor = vec4(vec3(0.874, 0.514, 0.156) * ((fragColor.r + (fragColor.g + fragColor.b)) / 3.0), fragColor.a);";break;case WebGl.Stage2D.Filters.INVERT:u+="fragColor = abs(vec4(fragColor.rgb - 1.0, fragColor.a));";break;case WebGl.Stage2D.Filters.COLORLIMIT:u+="fragColor = vec4((floor((fragColor.rgb * 256.0) / 32.0) / 256.0) * 32.0, fragColor.a);";break;case WebGl.Stage2D.Filters.VIGNETTE:u+="fragColor = vec4(fragColor.rgb * (1.0 - sqrt(pow(v_coord.x, 4.0) + pow(v_coord.y, 4.0))), fragColor.a);";break;case WebGl.Stage2D.Filters.RAINBOW:u+="fragColor = vec4(fragColor.rgb + vec3(v_coord.x * 0.15, v_coord.y * 0.15, (v_coord.x - v_coord.y) * 0.15), fragColor.a);";break;case WebGl.Stage2D.Filters.LINES:u+="fragColor += vec4(sin(v_coord.y * 500.0) * 0.2);";break};u+="}"};u+="}"};if(r.useMask)u+="fragColor.a *= maskAlpha;";u+="}";return u});cnst(WebGl.Stage2D,"Filters",{"NONE":0,"GRAYSCALE":1,"SEPIA":2,"INVERT":4,"COLORLIMIT":8,"VIGNETTE":16,"RAINBOW":32,"LINES":64,});