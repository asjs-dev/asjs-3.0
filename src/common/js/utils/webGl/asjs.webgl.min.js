var WebGl={};(function(){c3(WebGl,"Matrix3");var k=WebGl.Matrix3;rof(k,"isPointInMatrix",function(q,m,E,D){var p=m[4]-m[5]*m[7];var o=m[1]-m[2]*m[7];var n=m[1]*m[5]-m[2]*m[4];var d=1/(m[0]*p-m[3]*o+m[6]*n);E[0]=d*p;E[1]=-d*o;E[2]=d*n;E[3]=-d*(m[3]-m[5]*m[6]);E[4]=d*(m[0]-m[2]*m[6]);E[5]=-d*(m[0]*m[5]-m[2]*m[3]);E[6]=d*(m[3]*m[7]-m[4]*m[6]);E[7]=-d*(m[0]*m[7]-m[1]*m[6]);E[8]=d*(m[0]*m[4]-m[1]*m[3]);D[0]=q[0]*E[0]+q[1]*E[3]+E[6];D[1]=q[0]*E[1]+q[1]*E[4]+E[7];return D[0]>=0&&D[1]>=0&&D[0]<=1&&D[1]<=1});rof(k,"identity",function(){return new Float32Array([1,0,0,0,1,0,0,0,1,])});rof(k,"projection",function(B,C){return new Float32Array([2/B,0,0,0,-2/C,0,-1,1,1,])});rof(k,"transformTexture",function(x,y,r,j,i,h,g,l){var c=_m.cos(r);var s=_m.sin(r);l[0]=c*h;l[1]=s*h;l[3]=-s*g;l[4]=c*g;l[6]=(l[0]*-j+l[3]*-i)+y;l[7]=(l[1]*-j+l[4]*-i)+x});rof(k,"transform",function(m,x,y,r,j,i,h,g,l){var c=_m.cos(r);var s=_m.sin(r);l[0]=c*m[0]+s*m[3];l[1]=c*m[1]+s*m[4];l[3]=c*m[3]-s*m[0];l[4]=c*m[4]-s*m[1];l[6]=-j*l[0]-i*l[3]+x*m[0]+y*m[3]+m[6];l[7]=-j*l[1]-i*l[4]+x*m[1]+y*m[4]+m[7];l[0]*=h;l[1]*=h;l[3]*=g;l[4]*=g})})();c1(WebGl,"Utils",ASJS.BaseClass,function(f){var r={};f.new=x;get(f,"webGlInfo",function(){return r});function x(){r.isWebGl2Supported=_fls;map(["webgl2"],function(a,d){var i=_d.createElement("canvas");var n;if(n=i.getContext(d)){r.isWebGl2Supported=_tru;r.maxTextureImageUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);r.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE);r.maxVertexAttributes=n.getParameter(n.MAX_VERTEX_ATTRIBS);r.maxVaryingVectors=n.getParameter(n.MAX_VARYING_VECTORS);r.maxVertexUniformVectors=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS);r.maxFragmentUniformComponents=n.getParameter(n.MAX_FRAGMENT_UNIFORM_COMPONENTS);r.maxFragmentUniformVectors=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS);r.maxVaryingComponents=n.getParameter(n.MAX_VARYING_COMPONENTS);r.canShaderRun=r.maxVertexAttributes>=8&&r.maxVaryingVectors>=5&&r.maxVaryingComponents>=20&&r.maxFragmentUniformComponents>=199&&r.maxFragmentUniformVectors>=6}})};f.bindTexture2DSource=function(b,u){b.activeTexture(b.TEXTURE0+r.maxTextureImageUnits+1);b.bindTexture(u.target,u.texture);if(u.source.tagName.toLowerCase()!=="video"){b.texImage2D(u.target,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u.source)};b.texParameteri(u.target,b.TEXTURE_WRAP_S,u.wrapS);b.texParameteri(u.target,b.TEXTURE_WRAP_T,u.wrapT);b.texParameteri(u.target,b.TEXTURE_MIN_FILTER,u.minFilter);b.texParameteri(u.target,b.TEXTURE_MAG_FILTER,u.magFilter);b.generateMipmap(u.target)};f.useTexture=function(b,e,u){b.activeTexture(b.TEXTURE0+e);b.bindTexture(u.target,u.texture);if(u.shouldUpdate){b.texImage2D(u.target,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u.source)}};f.loadShader=function(b,s,v){var g=b.createShader(b[s]);b.shaderSource(g,v);b.compileShader(g);var o=b.getShaderParameter(g,b.COMPILE_STATUS);if(!o){var p=b.getShaderInfoLog(g);trc("Error compiling shader "+s+":"+p);b.deleteShader(g);return null};return g};f.createProgram=function(b,l,t,w){var k=b.createProgram();map(l,function(c,g){b.attachShader(k,g)});if(t){map(t,function(c,j){b.bindAttribLocation(k,w?w[c]:c,j)})};b.linkProgram(k);var h=b.getProgramParameter(k,b.LINK_STATUS);if(!h){var p=b.getProgramInfoLog(k);trc("Error in program linking:"+p);b.deleteProgram(k);return null};return k};f.getLocationsFor=function(b,k,z){var q={};map(z,function(c,y){q[c]=b[y](k,c)});return q};f.destroyTexture=function(b,m){b.bindTexture(m.target,null);b.deleteTexture(m.texture)}});cnst(WebGl.Utils,"ShaderType",{"VERTEX_SHADER":"VERTEX_SHADER","FRAGMENT_SHADER":"FRAGMENT_SHADER"});c0(WebGl,"Bitmap",ASJS.DisplayObject,function(b,c){b.clearColor=ASJS.Color.toFloat(ASJS.Color.create());var a;ASJS.CanvasApi.initBaseCanvas(b,c);ovrd(b,c,"new");b.new=function(e,f,g){c.new("canvas");if(!g)g={};g.premultipliedAlpha=_tru;g.preserveDrawingBuffer=_tru;g.stencil=_tru;c.prot.contextAttributes=g;c.prot.contextType="webgl2";b.setBitmapSize(e,f);a=b.getContext();a.enable(a.BLEND);a.depthMask(_tru);a.enable(a.DEPTH_TEST);a.depthFunc(a.ALWAYS);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_tru);a.enable(a.SCISSOR_TEST);b.updateScissor()};b.clearRect=function(x,y,w,h){b.setDrawArea(x,y,w,h);var d=b.clearColor;a.clearColor(d[0],d[1],d[2],d[3]);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)};ovrd(b,c,"destruct");b.destruct=function(){b.clearColor=a=null;b.destructBaseCanvasApi();c.destruct()};b.setDrawArea=function(x,y,w,h){a.scissor(x,b.bitmapHeight-y-h,w,h);a.viewport(0,0,b.bitmapWidth,b.bitmapHeight)};b.updateScissor=function(){a&&a.scissor(0,0,b.bitmapWidth,b.bitmapHeight);b[de](WebGl.Bitmap.RESIZE)};b.update=b.updateScissor});msg(WebGl.Bitmap,"RESIZE");c3(WebGl,"Config");rof(WebGl.Config,"create",function(c,b,a){return{"showLights":c,"useMask":b,"filters":a}});c0(WebGl,"ColorProps",ASJS.BaseClass,function(e){var g;var a=1;var b=1;var c=1;var d=1;e.new=function(f){g=f;g()};prop(e,"r",{get:function(){return a},set:function(v){a=v;g()}});prop(e,"g",{get:function(){return b},set:function(v){b=v;g()}});prop(e,"b",{get:function(){return c},set:function(v){c=v;g()}});prop(e,"a",{get:function(){return d},set:function(v){d=v;g()}})});c0(WebGl,"ItemProps",ASJS.BaseClass,function(c){var k;var a=0;var b=0;var l=0;var e=1;var f=1;var d=1;var g=1;var h=0;var i=0;c.new=function(j){k=j;k()};prop(c,"x",{get:function(){return a},set:function(v){a=v;k()}});prop(c,"y",{get:function(){return b},set:function(v){b=v;k()}});prop(c,"rotation",{get:function(){return l},set:function(v){l=v;k()}});prop(c,"scaleX",{get:function(){return e},set:function(v){e=v;k()}});prop(c,"scaleY",{get:function(){return f},set:function(v){f=v;k()}});prop(c,"width",{get:function(){return d},set:function(v){d=v;k()}});prop(c,"height",{get:function(){return g},set:function(v){g=v;k()}});prop(c,"anchorX",{get:function(){return h},set:function(v){h=v;k()}});prop(c,"anchorY",{get:function(){return i},set:function(v){i=v;k()}})});c0(WebGl,"LightEffectProps",ASJS.BaseClass,function(a){var g;var d=0;var e=0;var b=1;var c=1;a.new=function(f){g=f;g()};prop(a,"anchorX",{get:function(){return d},set:function(v){d=v;g()}});prop(a,"anchorY",{get:function(){return e},set:function(v){e=v;g()}});prop(a,"quadX",{get:function(){return b},set:function(v){b=v;g()}});prop(a,"quadY",{get:function(){return c},set:function(v){c=v;g()}})});c0(WebGl,"TextureCrop",ASJS.BaseClass,function(c){var g;var a=0;var b=0;var d=1;var e=1;c.new=function(f){g=f;g()};prop(c,"x",{get:function(){return a},set:function(v){a=v;g()}});prop(c,"y",{get:function(){return b},set:function(v){b=v;g()}});prop(c,"width",{get:function(){return d},set:function(v){d=v;g()}});prop(c,"height",{get:function(){return e},set:function(v){e=v;g()}})});c0(WebGl,"TextureProps",ASJS.BaseClass,function(c){var i;var a=0;var b=0;var j=0;var d=1;var e=1;var f=0;var g=0;c.new=function(h){i=h;i()};prop(c,"x",{get:function(){return a},set:function(v){a=v;i()}});prop(c,"y",{get:function(){return b},set:function(v){b=v;i()}});prop(c,"rotation",{get:function(){return j},set:function(v){j=v;i()}});prop(c,"width",{get:function(){return d},set:function(v){d=v;i()}});prop(c,"height",{get:function(){return e},set:function(v){e=v;i()}});prop(c,"anchorX",{get:function(){return f},set:function(v){f=v;i()}});prop(c,"anchorY",{get:function(){return g},set:function(v){g=v;i()}})});c3(WebGl,"BlendModes");cnst(WebGl.BlendModes,"NORMAL",["SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","ONE_MINUS_SRC_ALPHA"]);cnst(WebGl.BlendModes,"ADD",["SRC_ALPHA","DST_ALPHA","ONE","DST_ALPHA"]);cnst(WebGl.BlendModes,"MULTIPLY",["DST_COLOR","ONE_MINUS_SRC_ALPHA"]);cnst(WebGl.BlendModes,"SCREEN",["SRC_ALPHA","ONE_MINUS_SRC_COLOR","ONE","ONE_MINUS_SRC_COLOR"]);cnst(WebGl.BlendModes,"OVERLAY",["ONE","ONE_MINUS_SRC_ALPHA"]);c0(WebGl,"Texture",ASJS.EventDispatcher,function(c,d){var k=WebGl.Utils.instance;c.shouldUpdate=_fls;var b;var h;var o;var g;var i;var f=_fls;var j=_fls;c.new=function(a,e,n){b=a;h=b.TEXTURE_2D;i=b.createTexture();c.wrapS=a.CLAMP_TO_EDGE;c.wrapT=a.CLAMP_TO_EDGE;c.minFilter=a.NEAREST;c.magFilter=a.NEAREST;c.source=e;c.shouldUpdate=n};get(c,"loaded",function(){return f});get(c,"target",function(){return h});get(c,"texture",function(){return i});prop(c,"source",{get:function(){return g},set:function(v){g=v;tis(g,"string")?m():l()}});ovrd(c,d,"destruct");c.destruct=function(){o[off](ASJS.LoaderEvent.LOAD,p);o.destruct();b=h=i=f=o=g=null;d.destruct()};function l(){k.bindTexture2DSource(b,c)};function m(){o=o||new ASJS.Image();f=_fls;o[off](ASJS.LoaderEvent.LOAD,p);o[on](ASJS.LoaderEvent.LOAD,p);o.src=g};function p(){o[off](ASJS.LoaderEvent.LOAD,p);g=o.el;l();f=_tru;c[de](ASJS.LoaderEvent.LOAD)}});c0(WebGl,"Item",ASJS.BaseClass,function(g,h){var i=WebGl.Matrix3;var d=h.protected;g.renderable=_tru;g.interactive=_fls;g.matrixCache=i.identity();g.colorCache=new Float32Array(4);g.parentMatrix=i.identity();d.updateList=[];d.parent=null;g.new=function(){g.props=new WebGl.ItemProps(g.updateProps);g.color=new WebGl.ColorProps(g.updateColor)};prop(g,"parent",{get:function(){return d.parent},set:function(v){if(emp(v)||v.getChildIndex(g)>-1)d.parent=v}});get(g,"stage",function(){return g.parent?g.parent.stage:null});ovrd(g,h,"destruct");g.destruct=function(){d.parent&&d.parent.removeChild&&d.parent.removeChild(g);g.props.destruct();g.color.destruct();g.props=g.color=g.renderable=g.colorCache=g.matrixCache=g.parentMatrix=g.parent=null;h.destruct()};g.void=emptyFunction;g.preRender=emptyFunction;g.postRender=emptyFunction;g.updateProps=function(){d.updateList.push(d.updateProps)};g.updateColor=function(){d.updateList.push(d.updateColor)};g.update=function(j){d.parent.shouldUpdateProps&&g.updateProps();var a;while(a=d.updateList.shift())a(j)};d.updateProps=function(j){var e=g.props;var b=e.scaleX;var c=e.scaleY;j(g.parentMatrix,e.x,e.y,e.rotation,e.anchorX*b,e.anchorY*c,e.width*b,e.height*c,g.matrixCache)};d.updateColor=function(){var f=g.color;g.colorCache[0]=f.r;g.colorCache[1]=f.g;g.colorCache[2]=f.b;g.colorCache[3]=f.a}});c0(WebGl,"Light",WebGl.Item,function(b,c){var a=c.protected;b.positionCache=new Float32Array(2);b.volumeCache=new Float32Array(2);b.effectCache=new Float32Array(4);var e={};ovrd(b,c,"new");b.new=function(){c.new();b.effect=new WebGl.LightEffectProps(b.updateEffect)};ovrd(b,c,"destruct");b.destruct=function(){b.effect.destruct();b.effect=b.positionCache=b.volumeCache=b.effectCache=e=null;c.destruct()};b.updateEffect=function(){a.updateList.push(a.updateEffect)};ovrd(a,e,"updateProps");a.updateProps=function(d){e.updateProps(d);b.positionCache[0]=b.matrixCache[6];b.positionCache[1]=b.matrixCache[7];b.volumeCache[0]=b.matrixCache[0];b.volumeCache[1]=b.matrixCache[4]};a.updateEffect=function(){b.effectCache[0]=b.effect.anchorX;b.effectCache[1]=b.effect.anchorY;b.effectCache[2]=b.effect.quadX;b.effectCache[3]=b.effect.quadY}});c0(WebGl,"Image",WebGl.Item,function(b,c){var a=c.protected;var f=WebGl.Matrix3;b.textureMatrixCache=f.identity();b.texture;b.mask;b.tintType=WebGl.Image.Tint.NORMAL;b.blendMode=WebGl.BlendModes.NORMAL;b.textureCropCache=new Float32Array(4);ovrd(b,c,"new");b.new=function(d){c.new();b.texture=d;b.textureProps=new WebGl.TextureProps(b.updateTextureProps);b.textureCrop=new WebGl.TextureCrop(b.updateTextureCrop)};ovrd(b,c,"destruct");b.destruct=function(){b.textureProps.destruct();b.textureCrop.destruct();b.textureProps=b.textureCrop=b.textureMatrixCache=b.textureCropCache=b.tintType=b.texture=null;c.destruct()};b.updateTextureProps=function(){a.updateList.push(a.updateTextureProps)};b.updateTextureCrop=function(){a.updateList.push(a.updateTextureCrop)};a.updateTextureProps=function(){var g=b.textureProps;f.transformTexture(g.x,g.y,g.rotation,g.anchorX,g.anchorY,g.width,g.height,b.textureMatrixCache)};a.updateTextureCrop=function(){var e=b.textureCrop;b.textureCropCache[0]=e.x;b.textureCropCache[1]=e.y;b.textureCropCache[2]=e.width;b.textureCropCache[3]=e.height}});cnst(WebGl.Image,"Tint",{"NORMAL":0,"GRAYSCALE":1,"OVERRIDE":2,});c0(WebGl,"AnimatedImage",WebGl.Image,function(c,d){c.frameLength=120;c.frame=0;c.frames=[];c.isPlaying=_fls;var g=-1;c.gotoAndStop=function(b){c.frame=b};c.gotoAndPlay=function(b){c.frame=b;c.play()};c.stop=function(){c.isPlaying=_fls};c.play=function(){c.isPlaying=_tru};c.postRender=function(a){if(c.isPlaying){var f=a-g;if(f>=c.frameLength){g=a;c.frame+=_m.floor(f/c.frameLength);c.frame>=c.frames.length&&(c.frame=0);c.updateTextureCrop()}}};ovrd(c,d,"destruct");c.destruct=function(){c.stop();c.frameLength=c.frame=c.frames=c.isPlaying=null;d.destruct()};d.prot.updateTextureCrop=function(){var e=c.frames[c.frame];c.textureCropCache[0]=e.x;c.textureCropCache[1]=e.y;c.textureCropCache[2]=e.width;c.textureCropCache[3]=e.height}});c0(WebGl,"Container",WebGl.Item,function(e,f){var a=f.protected;e.shouldUpdateProps=e.shouldUpdateColor=_tru;e.parentColor=null;var i=[];get(e,"numChildren",function(){return i.length});e.clear=function(){while(e.numChildren)e.removeChildAt(0)};e.contains=function(b){return e.getChildIndex(b)>-1};e.addChild=function(b){return e.addChildAt(b,e.numChildren)};e.addChildAt=function(b,c){if(!b)return null;if(b.parent)b.parent.removeChild(b);b.enabled=b.enabled?_mouseChildren:b.enabled;i.push(b);e.setChildIndex(b,c);b.parent=e;if(is(b,WebGl.Container)){b.parentColor=e.colorCache};b.parentMatrix=e.matrixCache;return b};e.removeChild=function(b){if(!b||!e.contains(b))return null;i.remove(b);if(is(b,WebGl.Container))b.parentColor=null;b.parentMatrix=null;b.parent=null;return b};e.removeChildAt=function(c){return e.removeChild(e.getChildAt(c))};e.getChildAt=function(c){return i[c]};e.setChildIndex=function(b,c){if(!b||c<0)return null;i.remove(b);i.splice(c,0,b);return b};e.getChildIndex=function(b){return i.indexOf(b)};e.swapChildren=function(g,h){var j=e.getChildIndex(g);var k=e.getChildIndex(h);if(j===-1||k===-1)return _fls;e.setChildIndex(g,k);e.setChildIndex(h,j);return _tru};ovrd(e,f,"destruct");e.destruct=function(){i=_mouseChildren=_parent=e.parentMatrix=e.parentColor=e.shouldUpdateProps=e.shouldUpdateColor=null;f.destruct()};e.postRender=function(){e.shouldUpdateProps=e.shouldUpdateColor=_fls};e.updateProps=function(){a.updateList.push(a.updateProps);e.shouldUpdateProps=_tru};e.updateColor=function(){a.updateList.push(a.updateColor);e.shouldUpdateColor=_tru};ovrd(e,f,"update");e.update=function(m){a.parent.shouldUpdateColor&&e.updateColor();f.update(m)};a.updateColor=function(){var d=e.color;var l=e.parentColor;e.colorCache[0]=l[0]*d.r;e.colorCache[1]=l[1]*d.g;e.colorCache[2]=l[2]*d.b;e.colorCache[3]=l[3]*d.a}});c0(WebGl,"Stage2D",WebGl.Container,function(u,p){p.prot.parent=u;var S=WebGl.Utils.instance;var Z=WebGl.Matrix3;var g={};cnst(g,"DEFAULT_DUO",[0,0]);cnst(g,"DEFAULT_QUAD",[0,0,0,0]);cnst(g,"SHADER_LOCATIONS",{"a_position":"getAttribLocation","a_matrix":"getAttribLocation","a_texMatrix":"getAttribLocation","a_texCrop":"getAttribLocation","a_fillColor":"getAttribLocation","a_tintColor":"getAttribLocation","a_effects":"getAttribLocation","u_resolution":"getUniformLocation","u_texIds":"getUniformLocation","u_lightPositions":"getUniformLocation","u_lightVolumes":"getUniformLocation","u_lightColors":"getUniformLocation","u_lightEffects":"getUniformLocation","u_fog":"getUniformLocation","u_filters":"getUniformLocation",});u.fog={r:1,g:1,b:1,v:0};var bA=WebGl.BlendModes.NORMAL;var bJ=Z.transform;var Y;var bI;var bB;var K;var bq;var W;var bl;var bm;var bL;var bH;var bh;var bC;var bp;var R=0;var N=[];var X=[];var bx=[];var bv;var bo;var bb;var bn;var b;var ba;var E;var M;var bj=_tru;var bc;var t;var z;var L;var P;var by=[];var bg=_fls;var bD=new Float32Array([0,0,1]);var bG=new Float32Array(9);var Q=new Float32Array(3);var A;var bK;var bz;ovrd(u,p,"new");u.new=function(U,be,bs,o){p.new();A=o;ba=U;ba[on](WebGl.Bitmap.RESIZE,D);b=ba.getContext();E=S.createProgram(b,[S.loadShader(b,WebGl.Utils.ShaderType.VERTEX_SHADER,be(A)),S.loadShader(b,WebGl.Utils.ShaderType.FRAGMENT_SHADER,bs(A))]);M=S.getLocationsFor(b,E,g.SHADER_LOCATIONS);b.useProgram(E);bd();var br=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,br);b.bufferData(b.ARRAY_BUFFER,new Uint8Array([0,0,1,0,1,1,0,1]),b.STATIC_DRAW);b.enableVertexAttribArray(M["a_position"]);b.vertexAttribPointer(M["a_position"],2,b.BYTE,_fls,0,0);if(A.showLights){bv=new Float32Array(16*2);bo=new Float32Array(16*2);bb=new Float32Array(16*4);bn=new Float32Array(16*4)};bK=A.showLights?bi:emptyFunction;Y=new Float32Array(10000*9);bm=bF(Y,"a_matrix",9,3,3,b.FLOAT,4);bI=new Float32Array(10000*9);bL=bF(bI,"a_texMatrix",9,3,3,b.FLOAT,4);bB=new Float32Array(10000*4);bH=bF(bB,"a_texCrop",4,1,4,b.FLOAT,4);K=new Float32Array(10000*4);bh=bF(K,"a_fillColor",4,1,4,b.FLOAT,4);bq=new Float32Array(10000*4);bC=bF(bq,"a_tintColor",4,1,4,b.FLOAT,4);bl=(A.useMask?3:2);W=new Uint8Array(10000*bl);bp=bF(W,"a_effects",bl,1,bl,b.BYTE,0);bz=A.useMask?V:emptyFunction;v();u.parentColor=[1,1,1,1];u.filters=WebGl.Stage2D.Filters.NONE};prop(u,"parent",{set:emptyFunction});set(u,"filters",function(f){b.uniform1i(M["u_filters"],f)});get(u,"bitmap",function(){return ba});get(u,"stage",function(){return u});get(u,"isComplete",function(){return _isComplete});get(u,"pickedElements",function(){return by.clone()});u.render=function(){bc=Date.now();by.length=0;v();I();bK();F(u);R>0&&G();bg=_fls};u.isLightAttached=function(m){return bx.has(m)};u.attachLight=function(m){!u.isLightAttached(m)&&bx.length<16&&bx.push(m)};u.detachLight=function(m){bx.remove(m)};u.setPickerPoint=function(x,y){bg=_tru;bD[0]=(x-L)*u.parentMatrix[0];bD[1]=(y-P)*u.parentMatrix[4]};ovrd(u,p,"destruct");u.destruct=function(){ba[off](WebGl.Bitmap.RESIZE,D);g=bc=S=ba=Z=E=bj=M=Y=bI=bB=K=bq=W=bm=bL=bH=bh=bC=bp=N=X=R=bx=bv=bo=bb=bn=t=z=L=P=bD=Q=bG=by=bg=A=bK=bz=bJ=null;p.destruct()};function I(){b.uniform4fv(M["u_fog"],[u.fog.r,u.fog.g,u.fog.b,u.fog.v])};function bi(){var m;for(var i=0;i<16;i++){m=i>=bx.length||!bx[i].renderable?null:bx[i];bv.set(m?m.positionCache:g.DEFAULT_DUO,i*2);bo.set(m?m.volumeCache:g.DEFAULT_DUO,i*2);bb.set(m?m.colorCache:g.DEFAULT_QUAD,i*4);bn.set(m?m.effectCache:g.DEFAULT_QUAD,i*4)};m=null;b.uniform2fv(M["u_lightPositions"],bv);b.uniform2fv(M["u_lightVolumes"],bo);b.uniform4fv(M["u_lightColors"],bb);b.uniform4fv(M["u_lightEffects"],bn)};function F(d){if(d.renderable){d.preRender(bc);d.update(bJ);if(is(d,WebGl.Container))bk(d);else if(is(d,WebGl.Image))H(d);d.postRender(bc)}};function bk(d){for(var i=0;i<d.numChildren;i++){F(d.getChildAt(i))}};function V(d){W[R*bl+2]=O(d.mask)};function H(d){if(bA!==d.blendMode){G();bA=d.blendMode};if(bg&&d.interactive&&Z.isPointInMatrix(bD,d.matrixCache,bG,Q))by.push(d);bz(d);var bw=O(d.texture);var n=R*4;var l=R*9;var C=R*bl;Y.set(d.matrixCache,l);bI.set(d.textureMatrixCache,l);bB.set(d.textureCropCache,n);K.set(d.parent.colorCache,n);bq.set(d.colorCache,n);W.set([bw,d.tintType],C);R++;R===10000&&G()};function bF(h,J,s,c,j,e,k){var q=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,q);b.bufferData(b.ARRAY_BUFFER,h.byteLength,b.DYNAMIC_DRAW);bE(M[J],q,h,s,c,j,e,k);return q};function bE(B,q,h,s,c,j,e,k){bt(q,h);var r=k*s;var i=c+1;while(--i){var a=B+(c-i);b.enableVertexAttribArray(a);b[e===b.FLOAT?"vertexAttribPointer":"vertexAttribIPointer"](a,j,e,_fls,r,(c-i)*k*j);b.vertexAttribDivisor(a,1)}};function bt(q,h){b.bindBuffer(b.ARRAY_BUFFER,q);b.bufferSubData(b.ARRAY_BUFFER,0,h)};function G(){b.uniform1iv(M["u_texIds"],new Uint8Array(X));bt(bm,Y);bt(bL,bI);bt(bH,bB);bt(bh,K);bt(bC,bq);bt(bp,W);bd();b.drawArraysInstanced(b.TRIANGLE_FAN,0,4,R);N.length=X.length=R=0};function O(T){if(!T)return 0;var bw=N.indexOf(T);var bf=bw===-1;if(bf||T.shouldUpdate){if(bf||!T.shouldUpdate){N.length===S.webGlInfo.maxTextureImageUnits&&G();N.push(T);bw=N.length-1;X.push(bw)};S.useTexture(b,bw,T)};return bw+1};function bd(){bA.length===4?b.blendFuncSeparate(b[bA[0]],b[bA[1]],b[bA[2]],b[bA[3]]):b.blendFunc(b[bA[0]],b[bA[1]])};function v(){if(bj){bj=_fls;t=ba.bitmapWidth;z=ba.bitmapHeight;L=t*0.5;P=z*0.5;u.parentMatrix=Z.projection(t,z);b.uniform2f(M["u_resolution"],t/z,100/t);u.updateProps()}};function D(){bj=_tru}});cnst(WebGl.Stage2D,"MAX_LIGHT_SOURCES",16);rof(WebGl.Stage2D,"createVertexShader",function(o){var w="#version 300 es\nprecision lowp float;in vec2 a_position;in mat3 a_matrix;in mat3 a_texMatrix;in vec4 a_texCrop;in vec4 a_fillColor;in vec4 a_tintColor;in ivec"+(o.useMask?"3":"2")+" a_effects;";w+="out vec2 v_texCoord;out vec4 v_coord;out vec4 v_texCrop;out vec2 v_texCropSize;out vec4 v_fillColor;out vec4 v_tintColor;flat out int v_texId;flat out int v_tintType;";if(o.useMask)w+="flat out int v_maskTexId;";w+="void main() {vec3 pos = vec3(a_position, 1.0);gl_Position = vec4((a_matrix * pos).xy, 0.0, 1.0);v_texCoord = (a_texMatrix * pos).xy;v_coord = gl_Position;v_texCrop = a_texCrop;v_texCropSize = v_texCrop.zw - v_texCrop.xy;v_fillColor = a_fillColor;v_tintColor = a_tintColor;v_texId = a_effects.x;v_tintType = a_effects.y;";if(o.useMask)w+="v_maskTexId = a_effects.z;";w+="}";return w});rof(WebGl.Stage2D,"createFragmentShader",function(o){var bM=WebGl.Utils.instance.webGlInfo.maxTextureImageUnits;var bu=16;var w="#version 300 es\nprecision lowp float;in vec4 v_coord;in vec2 v_texCoord;in vec4 v_texCrop;in vec2 v_texCropSize;in vec4 v_fillColor;in vec4 v_tintColor;flat in int v_texId;flat in int v_tintType;";if(o.useMask)w+="flat in int v_maskTexId;";w+="uniform sampler2D u_texIds["+bM+"];uniform vec2 u_resolution;uniform int u_filters;uniform vec4 u_fog;";if(o.showLights){w+="uniform vec2 u_lightPositions["+bu+"];uniform vec2 u_lightVolumes["+bu+"];uniform vec4 u_lightColors["+bu+"];uniform vec4 u_lightEffects["+bu+"];"};w+="out vec4 fragColor;";w+="vec2 coordLimit(vec2 coord, vec2 size, vec4 crop) {return crop.xy + mod(coord * size, size);}";if(o.showLights){w+="vec4 lightValue(vec2 lightPosition, vec2 lightVolume, vec4 lightColor, vec4 lightEffect) {vec2 dist = v_coord.xy - lightPosition;return lightColor * lightColor.a * max(0.0, min(1.0, 1.0 - sqrt(pow(abs(dist.x + (abs(dist.x) * lightEffect.x)), 2.0 * lightEffect.z) * (lightVolume.x / u_resolution.y) + pow(abs(dist.y + (abs(dist.y) * lightEffect.y)), 2.0 * lightEffect.w) * (lightVolume.y / u_resolution.x / u_resolution.y))));}"};w+="void main() {if (v_texId == 0) discard;";if(o.useMask){w+="float maskAlpha = 1.0;if (v_maskTexId > 0) {vec2 maskCoord = (v_coord.xy + vec2(1.0, -1.0)) / vec2(2.0, -2.0);bool isMaskTexFound = false;";for(var i=0;i<bM;i++){w+=(i>0?" else ":"")+"if ("+(i>0?"!isMaskTexFound && ":"")+"v_maskTexId == "+(i+1)+") {maskAlpha = texture(u_texIds["+i+"], maskCoord).a;isMaskTexFound = true;}"};w+="}if (maskAlpha == 0.0) discard;"};w+="vec2 coord = coordLimit(v_texCoord, v_texCropSize, v_texCrop);bool isTexFound = false;";for(var i=0;i<bM;i++){w+=(i>0?" else ":"")+"if ("+(i>0?"!isTexFound && ":"")+"v_texId == "+(i+1)+") {fragColor = texture(u_texIds["+i+"], coord);isTexFound = true;}"};w+="if (fragColor.a == 0.0) discard;if (v_tintType == 0) fragColor *= v_tintColor;else if (v_tintType == 1 && fragColor.r == fragColor.g && fragColor.r == fragColor.b) fragColor *= v_tintColor;else if (v_tintType == 2) fragColor = vec4((fragColor.rgb * (1.0 - v_tintColor.a)) + (v_tintColor.rgb * v_tintColor.a), fragColor.a);vec4 lightColor = vec4(0.0);";if(o.showLights){for(var i=0;i<bu;i++){w+="if (u_lightColors["+i+"].a > 0.0) {lightColor += lightValue(u_lightPositions["+i+"], 1.0 / abs(u_lightVolumes["+i+"]), u_lightColors["+i+"], u_lightEffects["+i+"]);}"}};w+="float colorLightMultiply = max(0.0, u_fog.a - lightColor.a);float colorMultiply = max(0.0, 1.0 - colorLightMultiply);vec4 fogColor = vec4(u_fog.rgb * colorLightMultiply, 0.0);vec4 finalColor = vec4(fragColor.rgb * colorMultiply, fragColor.a);fragColor = (finalColor * (v_fillColor + lightColor)) + fogColor;if (fragColor.a == 0.0) discard;";if(o.filters&&o.filters.length>0){w+="if (u_filters > 0) {";for(var i=0;i<o.filters.length;i++){w+="if (("+o.filters[i]+" & u_filters) > 0) {";switch(o.filters[i]){case WebGl.Stage2D.Filters.GRAYSCALE:w+="fragColor = vec4(vec3(1.0) * ((fragColor.r + (fragColor.g + fragColor.b)) / 3.0), fragColor.a);";break;case WebGl.Stage2D.Filters.SEPIA:w+="fragColor = vec4(vec3(0.874, 0.514, 0.156) * ((fragColor.r + (fragColor.g + fragColor.b)) / 3.0), fragColor.a);";break;case WebGl.Stage2D.Filters.INVERT:w+="fragColor = abs(vec4(fragColor.rgb - 1.0, fragColor.a));";break;case WebGl.Stage2D.Filters.COLORLIMIT:w+="fragColor = vec4((floor((fragColor.rgb * 256.0) / 32.0) / 256.0) * 32.0, fragColor.a);";break;case WebGl.Stage2D.Filters.VIGNETTE:w+="fragColor = vec4(fragColor.rgb * (1.0 - sqrt(pow(v_coord.x, 4.0) + pow(v_coord.y, 4.0))), fragColor.a);";break;case WebGl.Stage2D.Filters.RAINBOW:w+="fragColor = vec4(fragColor.rgb + vec3(v_coord.x * 0.15, v_coord.y * 0.15, (v_coord.x - v_coord.y) * 0.15), fragColor.a);";break;case WebGl.Stage2D.Filters.LINES:w+="fragColor += vec4(sin(v_coord.y * 500.0) * 0.2);";break};w+="}"};w+="}"};if(o.useMask)w+="fragColor.a *= maskAlpha;";w+="}";return w});cnst(WebGl.Stage2D,"Filters",{"NONE":0,"GRAYSCALE":1,"SEPIA":2,"INVERT":4,"COLORLIMIT":8,"VIGNETTE":16,"RAINBOW":32,"LINES":64,});