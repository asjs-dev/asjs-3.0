var WebGl={};var m4=(function(){var cs={};var l=_m.PI;var cC=l*0.5;var bJ=l*2;var cJ=90*(l/180);cs.isPointInMatrix=function(bw,m,cq,cp){cs.inverse(m,cq);cs.multiplyVector(cq,bw,cp);return cp[0]>=0&&cp[1]>=0&&cp[0]<=1&&cp[1]<=1};cs.transformTexture2D=function(x,y,M,Q,N,O,P,bx){var c=_m.cos(M);var s=_m.sin(M);bx[0]=c*O;bx[1]=s*O;bx[4]=-s*P;bx[5]=c*P;bx[12]=(bx[0]*-Q+bx[4]*-N)+x;bx[13]=(bx[1]*-Q+bx[5]*-N)+y};cs.transform2D=function(m,x,y,z,R,U,M,Q,N,Z,O,P,Y,bx){m4.translateDst(m,x,y,z,bx);m4.zRotate(bx,M);m4.translate(bx,-Q,-N,0);m4.scale(bx,O,P,1)};cs.transform=function(m,x,y,z,R,U,M,Q,N,Z,O,P,Y,bx){m4.translateDst(m,x,y,z,bx);m4.xRotate(bx,R);m4.yRotate(bx,U);m4.zRotate(bx,M);m4.translate(bx,-Q,-N,-Z);m4.scale(bx,O,P,Y)};cs.multiply=function(a,b,bx){bx[0]=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];bx[1]=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13];bx[2]=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14];bx[3]=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15];bx[4]=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12];bx[5]=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13];bx[6]=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14];bx[7]=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15];bx[8]=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12];bx[9]=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13];bx[10]=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14];bx[11]=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15];bx[12]=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12];bx[13]=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13];bx[14]=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14];bx[15]=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15]};cs.multiplyVector=function(a,b,bx){bx[0]=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];bx[1]=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13];bx[2]=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14];bx[3]=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15]};cs.length=function(v){return _m.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])};cs.identity=function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};cs.perspective=function(cK,cv,bI,bp){var f=_m.tan(cC-0.5*cK);var cD=1.0/(bI-bp);return new Float32Array([f/cv,0,0,0,0,f,0,0,0,0,(bI+bp)*cD,-1,0,0,bI*bp*cD*2,0])};cs.orthographic=function(bH,ce,cy,bq,bI,bp){return new Float32Array([2/(ce-bH),0,0,0,0,2/(bq-cy),0,0,0,0,2/(bI-bp),0,(bH+ce)/(bH-ce),(cy+bq)/(cy-bq),(bI+bp)/(bI-bp),1])};cs.frustum=function(bH,ce,cy,bq,bI,bp){var S=ce-bH;var V=bq-cy;var T=bp-bI;return new Float32Array([2*bI/S,0,0,0,0,2*bI/V,0,0,(bH+ce)/S,(bq+cy)/V,-(bp+bI)/T,-1,0,0,-2*bI*bp/T,0])};cs.translate=function(m,B,C,D){var br=m[12];var bt=m[13];var bu=m[14];var bv=m[15];m[12]=m[0]*B+m[4]*C+m[8]*D+br;m[13]=m[1]*B+m[5]*C+m[9]*D+bt;m[14]=m[2]*B+m[6]*C+m[10]*D+bu;m[15]=m[3]*B+m[7]*C+m[11]*D+bv};cs.translateDst=function(m,B,C,D,bx){bx[0]=m[0];bx[1]=m[1];bx[2]=m[2];bx[3]=m[3];bx[4]=m[4];bx[5]=m[5];bx[6]=m[6];bx[7]=m[7];bx[8]=m[8];bx[9]=m[9];bx[10]=m[10];bx[11]=m[11];bx[12]=m[0]*B+m[4]*C+m[8]*D+m[12];bx[13]=m[1]*B+m[5]*C+m[9]*D+m[13];bx[14]=m[2]*B+m[6]*C+m[10]*D+m[14];bx[15]=m[3]*B+m[7]*C+m[11]*D+m[15]};cs.xRotation=function(cH,bx){var c=_m.cos(cH);var s=_m.sin(cH);bx[0]=1;bx[1]=0;bx[2]=0;bx[3]=0;bx[4]=0;bx[5]=c;bx[6]=s;bx[7]=0;bx[8]=0;bx[9]=-s;bx[10]=c;bx[11]=0;bx[12]=0;bx[13]=0;bx[14]=0;bx[15]=1};cs.xRotate=function(m,cH){var bo=m[4];var by=m[5];var bE=m[6];var bA=m[7];var bB=m[8];var bC=m[9];var bD=m[10];var bF=m[11];var c=_m.cos(cH);var s=_m.sin(cH);m[4]=c*bo+s*bB;m[5]=c*by+s*bC;m[6]=c*bE+s*bD;m[7]=c*bA+s*bF;m[8]=c*bB-s*bo;m[9]=c*bC-s*by;m[10]=c*bD-s*bE;m[11]=c*bF-s*bA};cs.xRotateDst=function(m,cH,bx){var bo=m[4];var by=m[5];var bE=m[6];var bA=m[7];var bB=m[8];var bC=m[9];var bD=m[10];var bF=m[11];var c=_m.cos(cH);var s=_m.sin(cH);bx[4]=c*bo+s*bB;bx[5]=c*by+s*bC;bx[6]=c*bE+s*bD;bx[7]=c*bA+s*bF;bx[8]=c*bB-s*bo;bx[9]=c*bC-s*by;bx[10]=c*bD-s*bE;bx[11]=c*bF-s*bA;bx[0]=m[0];bx[1]=m[1];bx[2]=m[2];bx[3]=m[3];bx[12]=m[12];bx[13]=m[13];bx[14]=m[14];bx[15]=m[15]};cs.yRotation=function(cH,bx){var c=_m.cos(cH);var s=_m.sin(cH);bx[0]=c;bx[1]=0;bx[2]=-s;bx[3]=0;bx[4]=0;bx[5]=1;bx[6]=0;bx[7]=0;bx[8]=s;bx[9]=0;bx[10]=c;bx[11]=0;bx[12]=0;bx[13]=0;bx[14]=0;bx[15]=1};cs.yRotate=function(m,cH){var bz=m[0];var bs=m[1];var bn=m[2];var ba=m[3];var bB=m[8];var bC=m[9];var bD=m[10];var bF=m[11];var c=_m.cos(cH);var s=_m.sin(cH);m[0]=c*bz-s*bB;m[1]=c*bs-s*bC;m[2]=c*bn-s*bD;m[3]=c*ba-s*bF;m[8]=c*bB+s*bz;m[9]=c*bC+s*bs;m[10]=c*bD+s*bn;m[11]=c*bF+s*ba};cs.yRotateDst=function(m,cH,bx){var bz=m[0];var bs=m[1];var bn=m[2];var ba=m[3];var bB=m[8];var bC=m[9];var bD=m[10];var bF=m[11];var c=_m.cos(cH);var s=_m.sin(cH);bx[0]=c*bz-s*bB;bx[1]=c*bs-s*bC;bx[2]=c*bn-s*bD;bx[3]=c*ba-s*bF;bx[8]=c*bB+s*bz;bx[9]=c*bC+s*bs;bx[10]=c*bD+s*bn;bx[11]=c*bF+s*ba;bx[4]=m[4];bx[5]=m[5];bx[6]=m[6];bx[7]=m[7];bx[12]=m[12];bx[13]=m[13];bx[14]=m[14];bx[15]=m[15]};cs.zRotation=function(cH,bx){var c=_m.cos(cH);var s=_m.sin(cH);bx[0]=c;bx[1]=s;bx[2]=0;bx[3]=0;bx[4]=-s;bx[5]=c;bx[6]=0;bx[7]=0;bx[8]=0;bx[9]=0;bx[10]=1;bx[11]=0;bx[12]=0;bx[13]=0;bx[14]=0;bx[15]=1};cs.zRotate=function(m,cH){var bz=m[0];var bs=m[1];var bn=m[2];var ba=m[3];var bo=m[4];var by=m[5];var bE=m[6];var bA=m[7];var c=_m.cos(cH);var s=_m.sin(cH);m[0]=c*bz+s*bo;m[1]=c*bs+s*by;m[2]=c*bn+s*bE;m[3]=c*ba+s*bA;m[4]=c*bo-s*bz;m[5]=c*by-s*bs;m[6]=c*bE-s*bn;m[7]=c*bA-s*ba};cs.zRotateDst=function(m,cH,bx){var bz=m[0];var bs=m[1];var bn=m[2];var ba=m[3];var bo=m[4];var by=m[5];var bE=m[6];var bA=m[7];var c=_m.cos(cH);var s=_m.sin(cH);bx[0]=c*bz+s*bo;bx[1]=c*bs+s*by;bx[2]=c*bn+s*bE;bx[3]=c*ba+s*bA;bx[4]=c*bo-s*bz;bx[5]=c*by-s*bs;bx[6]=c*bE-s*bn;bx[7]=c*bA-s*ba;bx[8]=m[8];bx[9]=m[9];bx[10]=m[10];bx[11]=m[11];bx[12]=m[12];bx[13]=m[13];bx[14]=m[14];bx[15]=m[15]};cs.axisRotation=function(bG,cH,bx){var x=bG[0];var y=bG[1];var z=bG[2];var n=_m.sqrt(x*x+y*y+z*z);x/=n;y/=n;z/=n;var k=x*x;var F=y*y;var o=z*z;var c=_m.cos(cH);var s=_m.sin(cH);var cI=1-c;bx[0]=k+(1-k)*c;bx[1]=x*y*cI+z*s;bx[2]=x*z*cI-y*s;bx[3]=0;bx[4]=x*y*cI-z*s;bx[5]=F+(1-F)*c;bx[6]=y*z*cI+x*s;bx[7]=0;bx[8]=x*z*cI+y*s;bx[9]=y*z*cI-x*s;bx[10]=o+(1-o)*c;bx[11]=0;bx[12]=0;bx[13]=0;bx[14]=0;bx[15]=1};cs.axisRotate=function(m,bG,cH,bx){var x=bG[0];var y=bG[1];var z=bG[2];var n=_m.sqrt(x*x+y*y+z*z);x/=n;y/=n;z/=n;var k=x*x;var F=y*y;var o=z*z;var c=_m.cos(cH);var s=_m.sin(cH);var cI=1-c;var bi=k+(1-k)*c;var bh=x*y*cI+z*s;var bg=x*z*cI-y*s;var bf=x*y*cI-z*s;var be=F+(1-F)*c;var bd=y*z*cI+x*s;var bl=x*z*cI+y*s;var bc=y*z*cI-x*s;var bb=o+(1-o)*c;var bz=m[0];var bs=m[1];var bn=m[2];var ba=m[3];var bo=m[4];var by=m[5];var bE=m[6];var bA=m[7];var bB=m[8];var bC=m[9];var bD=m[10];var bF=m[11];bx[0]=bi*bz+bh*bo+bg*bB;bx[1]=bi*bs+bh*by+bg*bC;bx[2]=bi*bn+bh*bE+bg*bD;bx[3]=bi*ba+bh*bA+bg*bF;bx[4]=bf*bz+be*bo+bd*bB;bx[5]=bf*bs+be*by+bd*bC;bx[6]=bf*bn+be*bE+bd*bD;bx[7]=bf*ba+be*bA+bd*bF;bx[8]=bl*bz+bc*bo+bb*bB;bx[9]=bl*bs+bc*by+bb*bC;bx[10]=bl*bn+bc*bE+bb*bD;bx[11]=bl*ba+bc*bA+bb*bF;if(m!==bx){bx[12]=m[12];bx[13]=m[13];bx[14]=m[14];bx[15]=m[15]}};cs.scaling=function(O,P,Y,bx){bx[0]=O;bx[1]=0;bx[2]=0;bx[3]=0;bx[4]=0;bx[5]=P;bx[6]=0;bx[7]=0;bx[8]=0;bx[9]=0;bx[10]=Y;bx[11]=0;bx[12]=0;bx[13]=0;bx[14]=0;bx[15]=1};cs.scale=function(m,O,P,Y){m[0]=O*m[0];m[1]=O*m[1];m[2]=O*m[2];m[3]=O*m[3];m[4]=P*m[4];m[5]=P*m[5];m[6]=P*m[6];m[7]=P*m[7];m[8]=Y*m[8];m[9]=Y*m[9];m[10]=Y*m[10];m[11]=Y*m[11]};cs.scaleDst=function(m,O,P,Y,bx){bx[0]=O*m[0];bx[1]=O*m[1];bx[2]=O*m[2];bx[3]=O*m[3];bx[4]=P*m[4];bx[5]=P*m[5];bx[6]=P*m[6];bx[7]=P*m[7];bx[8]=Y*m[8];bx[9]=Y*m[9];bx[10]=Y*m[10];bx[11]=Y*m[11];bx[12]=m[12];bx[13]=m[13];bx[14]=m[14];bx[15]=m[15]};cs.inverse=function(m,bx){var bz=m[0];var bs=m[1];var bn=m[2];var ba=m[3];var bo=m[4];var by=m[5];var bE=m[6];var bA=m[7];var bB=m[8];var bC=m[9];var bD=m[10];var bF=m[11];var br=m[12];var bt=m[13];var bu=m[14];var bv=m[15];var bO=bD*bv;var bK=bu*bF;var bN=bE*bv;var bL=bu*bA;var bQ=bE*bF;var bR=bD*bA;var bP=bn*bv;var bS=bu*ba;var bT=bn*bF;var bU=bD*ba;var cx=bn*bA;var cu=bE*ba;var cw=bB*bt;var ct=br*bC;var co=bo*bt;var cr=br*by;var ch=bo*bC;var ci=bB*by;var cj=bz*bt;var ck=br*bs;var cg=bz*bC;var cm=bB*bs;var cn=bz*by;var cl=bo*bs;var G=(bO*by+bL*bC+bQ*bt)-(bK*by+bN*bC+bR*bt);var W=(bK*bs+bP*bC+bU*bt)-(bO*bs+bS*bC+bT*bt);var X=(bN*bs+bS*by+cx*bt)-(bL*bs+bP*by+cu*bt);var H=(bR*bs+bT*by+cu*bC)-(bQ*bs+bU*by+cx*bC);var d=1.0/(bz*G+bo*W+bB*X+br*H);bx[0]=d*G;bx[1]=d*W;bx[2]=d*X;bx[3]=d*H;bx[4]=d*((bK*bo+bN*bB+bR*br)-(bO*bo+bL*bB+bQ*br));bx[5]=d*((bO*bz+bS*bB+bT*br)-(bK*bz+bP*bB+bU*br));bx[6]=d*((bL*bz+bP*bo+cu*br)-(bN*bz+bS*bo+cx*br));bx[7]=d*((bQ*bz+bU*bo+cx*bB)-(bR*bz+bT*bo+cu*bB));bx[8]=d*((cw*bA+cr*bF+ch*bv)-(ct*bA+co*bF+ci*bv));bx[9]=d*((ct*ba+cj*bF+cm*bv)-(cw*ba+ck*bF+cg*bv));bx[10]=d*((co*ba+ck*bA+cn*bv)-(cr*ba+cj*bA+cl*bv));bx[11]=d*((ci*ba+cg*bA+cl*bF)-(ch*ba+cm*bA+cn*bF));bx[12]=d*((co*bD+ci*bu+ct*bE)-(ch*bu+cw*bE+cr*bD));bx[13]=d*((cg*bu+cw*bn+ck*bD)-(cj*bD+cm*bu+ct*bn));bx[14]=d*((cj*bE+cl*bu+cr*bn)-(cn*bu+co*bn+ck*bE));bx[15]=d*((cn*bD+ch*bn+cm*bE)-(cg*bE+cl*bD+ci*bn))};return cs})();c1(WebGl,"Utils",ASJS.BaseClass,function(e){var q={};e.new=function(){w()};get(e,"webGlInfo",function(){return q});function w(){q.maxTextureImageUnits=0;map(["webgl2"],function(a,d){var h=_d.createElement("canvas");var m;if(m=h.getContext(d)){q.maxTextureImageUnits=m.getParameter(m.MAX_TEXTURE_IMAGE_UNITS);q.maxTextureSize=m.getParameter(m.MAX_TEXTURE_SIZE)}})};e.bindTexture2DSource=function(b,t){b.activeTexture(b.TEXTURE0+q.maxTextureImageUnits+1);b.bindTexture(t.target,t.texture);b.texImage2D(t.target,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,t.source);b.texParameteri(t.target,b.TEXTURE_WRAP_S,t.wrapS);b.texParameteri(t.target,b.TEXTURE_WRAP_T,t.wrapT);b.texParameteri(t.target,b.TEXTURE_MIN_FILTER,t.minFilter);b.texParameteri(t.target,b.TEXTURE_MAG_FILTER,t.magFilter);b.generateMipmap(t.target)};e.loadShader=function(b,r,u){var f=b.createShader(b[r]);b.shaderSource(f,u);b.compileShader(f);var n=b.getShaderParameter(f,b.COMPILE_STATUS);if(!n){var o=b.getShaderInfoLog(f);trc("Error compiling shader '"+shader+"':"+o);b.deleteShader(f);return null};return f};e.createProgram=function(b,k,s,v){var j=b.createProgram();map(k,function(c,f){b.attachShader(j,f)});if(s){map(s,function(c,i){b.bindAttribLocation(j,v?v[c]:c,i)})};b.linkProgram(j);var g=b.getProgramParameter(j,b.LINK_STATUS);if(!g){var o=b.getProgramInfoLog(j);trc("Error in program linking:"+o);b.deleteProgram(j);return null};return j};e.getLocationsFor=function(b,j,y){var p={};map(y,function(c,x){p[c]=b[x](j,c)});return p};e.destroyTexture=function(b,l){b.bindTexture(l.target,null);b.deleteTexture(l.texture)}});cnst(WebGl.Utils,"ShaderType",{"VERTEX_SHADER":"VERTEX_SHADER","FRAGMENT_SHADER":"FRAGMENT_SHADER"});c0(WebGl,"Bitmap",ASJS.DisplayObject,function(b,c){b.clearColor=ASJS.Color.toFloat(ASJS.Color.create());var a;ASJS.CanvasApi.initBaseCanvas(b,c);ovrd(b,c,"new");b.new=function(e,f,g){c.new("canvas");if(!g)g={};g.premultipliedAlpha=!0;g.preserveDrawingBuffer=!0;g.stencil=!0;g.depth=!0;c.prot.contextAttributes=g;c.prot.contextType="webgl2";b.setBitmapSize(e,f);a=b.getContext();a.enable(a.BLEND);a.depthMask(!0);a.enable(a.DEPTH_TEST);a.depthFunc(a.ALWAYS);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);a.enable(a.SCISSOR_TEST);b.updateScissor()};b.clearRect=function(x,y,w,h){b.setDrawArea(x,y,w,h);var d=b.clearColor;a.clearColor(d[0],d[1],d[2],d[3]);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)};ovrd(b,c,"destruct");b.destruct=function(){b.clearColor=a=null;b.destructBaseCanvasApi();c.destruct()};b.setDrawArea=function(x,y,w,h){a.scissor(x,b.bitmapHeight-y-h,w,h);a.viewport(0,0,b.bitmapWidth,b.bitmapHeight)};b.updateScissor=function(){if(a)a.scissor(0,0,b.bitmapWidth,b.bitmapHeight);b[de](WebGl.Bitmap.RESIZE)};b.update=b.updateScissor});msg(WebGl.Bitmap,"RESIZE");c3(WebGl,"BlendModes");cnst(WebGl.BlendModes,"NORMAL",["SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","ONE_MINUS_SRC_ALPHA"]);cnst(WebGl.BlendModes,"ADD",["SRC_ALPHA","DST_ALPHA","ONE","DST_ALPHA"]);cnst(WebGl.BlendModes,"MULTIPLY",["DST_COLOR","ONE_MINUS_SRC_ALPHA"]);cnst(WebGl.BlendModes,"SCREEN",["SRC_ALPHA","ONE_MINUS_SRC_COLOR","ONE","ONE_MINUS_SRC_COLOR"]);cnst(WebGl.BlendModes,"OVERLAY",["ONE","ONE_MINUS_SRC_ALPHA"]);c0(WebGl,"Texture",ASJS.EventDispatcher,function(c,d){var j=WebGl.Utils.instance;var b;var f;var m;var g;var i;var h=!1;c.new=function(a,e){m=new ASJS.Image();b=a;c.wrapS=a.CLAMP_TO_EDGE;c.wrapT=a.CLAMP_TO_EDGE;c.minFilter=a.NEAREST;c.magFilter=a.NEAREST;c.source=e;f=b.TEXTURE_2D;i=b.createTexture()};get(c,"loaded",function(){return h});get(c,"target",function(){return f});get(c,"texture",function(){return i});prop(c,"source",{get:function(){return g},set:function(v){g=v;tis(g,"string")?l():k()}});ovrd(c,d,"destruct");c.destruct=function(){m[off](ASJS.LoaderEvent.LOAD,n);m.destruct();b=f=i=h=m=g=null;d.destruct()};function k(){j.bindTexture2DSource(b,c)};function l(){h=!1;m[off](ASJS.LoaderEvent.LOAD,n);m[on](ASJS.LoaderEvent.LOAD,n);m.src=g};function n(){m[off](ASJS.LoaderEvent.LOAD,n);g=m.el;k();h=!0;c[de](ASJS.LoaderEvent.LOAD)}});c0(WebGl,"Item",ASJS.BaseClass,function(f,g){f.props={x:0,y:0,z:0,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1,scaleZ:1,width:1,height:1,depth:1,anchorX:0,anchorY:0,anchorZ:0,};f.color={r:1,g:1,b:1,a:1};f.renderable=!0;f.enabled=!0;f.interactive=!1;f.matrixCache=m4.identity();f.colorCache=new Float32Array(4);f.parentMatrix=null;var h=null;prop(f,"parent",{get:function(){return h},set:function(v){if(emp(v)||v.getChildIndex(f)>-1)h=v}});get(f,"stage",function(){return f.parent?f.parent.stage:null});ovrd(f,g,"destruct");f.destruct=function(){f.props=f.color=f.renderable=f.enabled=f.colorCache=f.matrixCache=f.parentMatrix=f.parent=null;g.destruct()};f.preRender=function(){};f.postRender=function(){};f.updateProperties=function(i){var d=f.props;var a=d.scaleX;var b=d.scaleY;var c=d.scaleZ;i(f.parentMatrix,d.x,d.y,d.z,d.rotationX,d.rotationY,d.rotationZ,d.anchorX*a,d.anchorY*b,d.anchorZ*c,d.width*a,d.height*b,d.depth*c,f.matrixCache);f.updateColorCache()};f.updateColorCache=function(){var e=f.color;f.colorCache[0]=e.r;f.colorCache[1]=e.g;f.colorCache[2]=e.b;f.colorCache[3]=e.a}});c0(WebGl,"Light",WebGl.Item,function(a,b){a.effect={anchorX:0,anchorY:0,quadX:1,quadY:1};a.positionCache=new Float32Array(3);a.volumeCache=new Float32Array(3);a.effectCache=new Float32Array([0,0,1,1]);ovrd(a,b,"updateProperties");a.updateProperties=function(c){b.updateProperties(c);a.positionCache[0]=a.matrixCache[12];a.positionCache[1]=a.matrixCache[13];a.positionCache[2]=a.matrixCache[14];a.volumeCache[0]=a.matrixCache[0];a.volumeCache[1]=a.matrixCache[5];a.volumeCache[2]=a.matrixCache[10];a.effectCache[0]=a.effect.anchorX;a.effectCache[1]=a.effect.anchorY;a.effectCache[2]=a.effect.quadX;a.effectCache[3]=a.effect.quadY}});c0(WebGl,"Image",WebGl.Item,function(a,b){a.textureProps={x:0,y:0,rotationZ:0,width:1,height:1,anchorX:0,anchorY:0,crop:{x:0,y:0,width:1,height:1}};a.textureMatrixCache=m4.identity();a.texture;a.tintType=WebGl.Image.Tint.NORMAL;a.blendMode=WebGl.BlendModes.NORMAL;a.textureCropCache=new Float32Array(4);a.new=function(c){a.texture=c};ovrd(a,b,"destruct");a.destruct=function(){a.textureProps=a.textureCrop=a.textureMatrixCache=a.textureCropCache=a.tintType=a.texture=null;b.destruct()};a.updateTextureProps=function(){var e=a.textureProps;m4.transformTexture2D(e.x,e.y,e.rotationZ,e.anchorX,e.anchorY,e.width,e.height,a.textureMatrixCache);a.updateTextureCrop()};a.updateTextureCrop=function(){var d=a.textureProps.crop;a.textureCropCache[0]=d.x;a.textureCropCache[1]=d.y;a.textureCropCache[2]=d.width;a.textureCropCache[3]=d.height}});cnst(WebGl.Image,"Tint",{"NORMAL":0,"GRAYSCALE":1,"OVERRIDE":2,});c0(WebGl,"AnimatedImage",WebGl.Image,function(c,d){c.frameLength=120;c.frame=0;c.frames=[];c.isPlaying=!1;var g=-1;c.gotoAndStop=function(b){c.frame=b};c.gotoAndPlay=function(b){c.frame=b;c.play()};c.stop=function(){c.isPlaying=!1};c.play=function(){c.isPlaying=!0};c.preRender=function(){c.updateTextureCrop()};c.postRender=function(a){if(c.isPlaying){var f=a-g;if(f>=c.frameLength){g=a;c.frame+=_m.floor(f/c.frameLength);c.frame>=c.frames.length&&(c.frame=0)}}};ovrd(c,d,"destruct");c.destruct=function(){c.stop();c.frameLength=c.frame=c.frames=c.isPlaying=null;d.destruct()};c.updateTextureCrop=function(){var e=c.frames[c.frame];c.textureCropCache[0]=e.x;c.textureCropCache[1]=e.y;c.textureCropCache[2]=e.width;c.textureCropCache[3]=e.height}});c0(WebGl,"Container",WebGl.Item,function(d,e){var h=[];var m=!0;var l;prop(d,"mouseChildren",{get:function(){return m},set:function(v){m=v;var i=d.numChildren;while(i--)d.getChildAt(i).enabled=m}});get(d,"numChildren",function(){return h.length});d.clear=function(){while(d.numChildren)d.removeChildAt(0)};d.contains=function(a){return d.getChildIndex(a)>-1};d.addChild=function(a){return d.addChildAt(a,d.numChildren)};d.addChildAt=function(a,b){if(!a)return null;if(a.parent)a.parent.removeChild(a);a.enabled=a.enabled?m:a.enabled;h.push(a);d.setChildIndex(a,b);a.parent=d;if(is(a,WebGl.Container))a.setParentColor(d.colorCache);a.parentMatrix=d.matrixCache;return a};d.removeChild=function(a){if(!a||!d.contains(a))return null;h.remove(a);if(is(a,WebGl.Container))a.setParentColor(null);a.parentMatrix=null;a.parent=null;return a};d.removeChildAt=function(b){return d.removeChild(d.getChildAt(b))};d.getChildAt=function(b){return h[b]};d.setChildIndex=function(a,b){if(!a||b<0)return null;h.remove(a);h.splice(b,0,a);return a};d.getChildIndex=function(a){return h.indexOf(a)};d.swapChildren=function(f,g){var j=d.getChildIndex(f);var k=d.getChildIndex(g);if(j===-1||k===-1)return!1;d.setChildIndex(f,k);d.setChildIndex(g,j);return!0};d.setParentColor=function(v){l=v};ovrd(d,e,"destruct");d.destruct=function(){if(_parent&&_parent.removeChild)_parent.removeChild(d);h=m=l=_parent=null;e.destruct()};d.updateColorCache=function(){var c=d.color;d.colorCache[0]=l[0]*c.r;d.colorCache[1]=l[1]*c.g;d.colorCache[2]=l[2]*c.b;d.colorCache[3]=l[3]*c.a}});c0(WebGl,"Stage2D",WebGl.Container,function(p,o){var H=WebGl.Utils.instance;var h={};cnst(h,"DEFAULT_TRI",[0,0,0]);cnst(h,"DEFAULT_QUAD",[0,0,0,0]);cnst(h,"SHADER_LOCATIONS",{"a_position":"getAttribLocation","a_matrix":"getAttribLocation","a_textureMatrix":"getAttribLocation","a_textureCrop":"getAttribLocation","a_fillColor":"getAttribLocation","a_textureId":"getAttribLocation","a_tintColor":"getAttribLocation","a_tintType":"getAttribLocation","u_resolution":"getUniformLocation","u_textureIndices":"getUniformLocation","u_lightPositions":"getUniformLocation","u_lightVolumes":"getUniformLocation","u_lightColors":"getUniformLocation","u_lightEffects":"getUniformLocation","u_fog":"getUniformLocation","u_filters":"getUniformLocation",});p.fog={r:1,g:1,b:1,v:0};var bu=WebGl.BlendModes.NORMAL;var N=new Float32Array(10000*16);var bk=new Float32Array(10000);var bC=new Float32Array(10000*16);var bv=new Float32Array(10000*4);var J=new Float32Array(10000*4);var bi=new Float32Array(10000*4);var bc=new Float32Array(10000);var bb;var bw;var bD;var bB;var U;var bt;var bq;var R=0;var Q=[];var bo=[];var br=new Float32Array(16*3);var bf=new Float32Array(16*3);var V=new Float32Array(16*4);var be=new Float32Array(16*4);var c;var X;var B;var I;var ba=!0;var Z;var u;var w;var bs=[];var W=!1;var bx=new Float32Array([0,0,0,1]);var bA=new Float32Array(16);var O=new Float32Array(4);ovrd(p,o,"new");p.new=function(P,Y,bl){o.new();X=P;X[on](WebGl.Bitmap.RESIZE,D);c=X.getContext();B=H.createProgram(c,[H.loadShader(c,WebGl.Utils.ShaderType.VERTEX_SHADER,Y),H.loadShader(c,WebGl.Utils.ShaderType.FRAGMENT_SHADER,bl)]);I=H.getLocationsFor(c,B,h.SHADER_LOCATIONS);c.useProgram(B);T();var bj=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,bj);c.bufferData(c.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),c.STATIC_DRAW);c.enableVertexAttribArray(I["a_position"]);c.vertexAttribPointer(I["a_position"],2,c.FLOAT,!1,0,0);bb=bz(N,"a_matrix",16,4,4);bw=bz(bk,"a_textureId",1,1,1);bD=bz(bC,"a_textureMatrix",16,4,4);bB=bz(bv,"a_textureCrop",4,1,4);U=bz(J,"a_fillColor",4,1,4);bt=bz(bi,"a_tintColor",4,1,4);bq=bz(bc,"a_tintType",1,1,1);var bh=new Int8Array(H.webGlInfo.maxTextureImageUnits);var i=bh.length;while(i--)bh[i]=i;c.uniform1iv(I["u_textureIndices"],bh);t();p.setParentColor([1,1,1,1]);p.filters=WebGl.Stage2D.FILTERS.NONE};set(p,"filters",function(f){c.uniform1i(I["u_filters"],f)});get(p,"bitmap",function(){return X});get(p,"stage",function(){return p});get(p,"isComplete",function(){return _isComplete});get(p,"pickedElements",function(){return bs.clone()});p.render=function(){Z=Date.now();bs.length=0;t();G();bg();A(p);R>0&&F();W=!1};p.isLightAttached=function(m){return bo.has(m)};p.attachLight=function(m){!p.isLightAttached(m)&&bo.length<16&&bo.push(m)};p.detachLight=function(m){bo.remove(m)};p.setPickerPoint=function(x,y){W=!0;bx[0]=(x-(u*0.5))*p.parentMatrix[0];bx[1]=(y-(w*0.5))*p.parentMatrix[5]};ovrd(p,o,"destruct");p.destruct=function(){X[off](WebGl.Bitmap.RESIZE,D);h=Z=H=X=B=ba=I=N=bk=bC=bv=J=bi=bc=bb=bw=bD=bB=U=bt=bq=Q=R=bo=br=bf=V=be=u=w=bx=O=bA=bs=W=null;o.destruct()};function G(){c.uniform4fv(I["u_fog"],[p.fog.r,p.fog.g,p.fog.b,p.fog.v])};function bg(){var a;var q;for(var i=0;i<16;i++){a=i*3;q=i*4;if(i>=bo.length||!bo[i].renderable){br.set(h.DEFAULT_TRI,a);bf.set(h.DEFAULT_TRI,a);V.set(h.DEFAULT_QUAD,q);be.set(h.DEFAULT_QUAD,q)}else{var m=bo[i];br.set(m.positionCache,a);bf.set(m.volumeCache,a);V.set(m.colorCache,q);be.set(m.effectCache,q)}};c.uniform3fv(I["u_lightPositions"],br);c.uniform3fv(I["u_lightVolumes"],bf);c.uniform4fv(I["u_lightColors"],V);c.uniform4fv(I["u_lightEffects"],be)};function A(j){if(j.renderable){j.updateProperties(m4.transform2D);if(is(j,WebGl.Container))bd(j);else if(is(j,WebGl.Image))E(j)}};function bd(j){for(var i=0;i<j.numChildren;i++)A(j.getChildAt(i))};var b=[0,0];function E(j){j.preRender();if(bu!==j.blendMode){F();bu=j.blendMode};if(W&&j.interactive&&m4.isPointInMatrix(bx,j.matrixCache,bA,O)){bs.push(j)};var bm=S(j.texture);var q=R*4;var n=R*16;N.set(j.matrixCache,n);bk[R]=bm;bC.set(j.textureMatrixCache,n);bv.set(j.textureCropCache,q);J.set(j.parent.colorCache,q);bi.set(j.colorCache,q);bc[R]=j.tintType||0;R++;if(R===10000)F();j.postRender(Z)};function bz(g,K,r,d,k){var s=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,s);c.bufferData(c.ARRAY_BUFFER,g.byteLength,c.DYNAMIC_DRAW);by(I[K],s,g,r,d,k);return s};function by(C,s,g,r,d,k){bn(s,g);var l=4*r;var i=d+1;while(--i){var e=C+(d-i);c.enableVertexAttribArray(e);c.vertexAttribPointer(e,k,c.FLOAT,!1,l,(d-i)*r);c.vertexAttribDivisor(e,1)}};function bn(s,g){c.bindBuffer(c.ARRAY_BUFFER,s);c.bufferSubData(c.ARRAY_BUFFER,0,g)};function F(){bn(bb,N);bn(bw,bk);bn(bD,bC);bn(bB,bv);bn(U,J);bn(bt,bi);bn(bq,bc);T();c.drawArraysInstanced(c.TRIANGLE_FAN,0,4,R);Q.length=R=0};function S(M){var bm=Q.indexOf(M);if(bm===-1){Q.length===H.webGlInfo.maxTextureImageUnits&&F();Q.push(M);bm=Q.length-1;c.activeTexture(c.TEXTURE0+bm);c.bindTexture(M.target,M.texture)};return bm};function T(){bu.length===4?c.blendFuncSeparate(c[bu[0]],c[bu[1]],c[bu[2]],c[bu[3]]):c.blendFunc(c[bu[0]],c[bu[1]])};function t(){if(ba){ba=!1;u=X.bitmapWidth;w=X.bitmapHeight;p.parentMatrix=m4.orthographic(0,u,w,0,-1,1);c.uniform2f(I["u_resolution"],u/w,96/u)}};function D(){ba=!0}});cnst(WebGl.Stage2D,"MAX_LIGHT_SOURCES",16);rof(WebGl.Stage2D,"createVertexShader",function(){return"#version 300 es\nprecision lowp float;in vec4 a_position;in mat4 a_matrix;in mat4 a_textureMatrix;in vec4 a_textureCrop;in vec4 a_fillColor;in float a_textureId;in vec4 a_tintColor;in float a_tintType;out vec2 v_texcoord;out vec4 v_coord;out vec4 v_textureCrop;out vec4 v_fillColor;out vec4 v_tintColor;flat out int v_textureId;flat out int v_tintType;void main() {gl_Position   = a_matrix * a_position;v_texcoord    = (a_textureMatrix * a_position).xy;v_coord       = gl_Position;v_textureCrop = a_textureCrop;v_fillColor   = a_fillColor;v_textureId   = int(a_textureId);v_tintColor   = a_tintColor;v_tintType    = int(a_tintType);}"});rof(WebGl.Stage2D,"createFragmentShader",function(L,z){var bE=WebGl.Utils.instance.webGlInfo.maxTextureImageUnits;var bp=16;var v="#version 300 es\nprecision lowp float;in vec4 v_coord;in vec2 v_texcoord;in vec4 v_textureCrop;in vec4 v_fillColor;in vec4 v_tintColor;flat in int v_textureId;flat in int v_tintType;uniform vec2 u_resolution;uniform int u_filters;uniform sampler2D u_textureIndices["+bE+"];uniform vec4 u_fog;";if(L){v+="uniform vec3 u_lightPositions["+bp+"];uniform vec3 u_lightVolumes["+bp+"];uniform vec4 u_lightColors["+bp+"];uniform vec4 u_lightEffects["+bp+"];"};v+="out vec4 fragColor;";v+="vec2 coordLimit(vec2 coord, vec2 size, vec4 crop) {return crop.xy + mod(coord * size, size);}";if(L){v+="vec4 lightValue(vec3 lightPosition, vec3 lightVolume, vec4 lightColor, vec4 lightEffect) {vec2 dist = v_coord.xy - lightPosition.xy;return lightColor * lightColor.a * max(0.0, min(1.0, 1.0 - sqrt(pow(dist.x + (abs(dist.x) * lightEffect.x), 2.0 * lightEffect.z) * (lightVolume.x / u_resolution.y) + pow(dist.y + (abs(dist.y) * lightEffect.y), 2.0 * lightEffect.w) * (lightVolume.y / u_resolution.x / u_resolution.y))));}"};v+="void main() {int index = int(v_textureId);vec2 textureCropSize = v_textureCrop.zw - v_textureCrop.xy;vec2 coord = coordLimit(v_texcoord, textureCropSize, v_textureCrop);";for(var i=0;i<bE;i++){v+=(i>0?" else ":"")+"if (index == "+i+") fragColor = texture(u_textureIndices["+i+"], coord);"};v+="if (fragColor.a < 0.01) discard;if (v_tintType == 0) fragColor *= v_tintColor;else if (v_tintType == 1 && fragColor.r == fragColor.g && fragColor.r == fragColor.b) fragColor *= v_tintColor;else if (v_tintType == 2) fragColor = vec4((fragColor.rgb * (1.0 - v_tintColor.a)) + (v_tintColor.rgb * v_tintColor.a), fragColor.a);vec4 lightColor = vec4(0.0);";if(L){for(var i=0;i<bp;i++){v+="if (u_lightColors["+i+"].a > 0.0 && u_lightPositions["+i+"].z <= v_coord.z) {lightColor += lightValue(u_lightPositions["+i+"], 1.0 / abs(u_lightVolumes["+i+"]), u_lightColors["+i+"], u_lightEffects["+i+"]);}"}};v+="float colorLightMultiply = max(0.0, u_fog.a - lightColor.a);float colorMultiply = max(0.0, 1.0 - colorLightMultiply);vec4 fogColor = vec4(u_fog.rgb * colorLightMultiply, 0.0);vec4 finalColor = vec4(fragColor.rgb * colorMultiply, fragColor.a);fragColor = (finalColor * (v_fillColor + lightColor)) + fogColor;if (fragColor.a < 0.01) discard;";if(z&&z.length>0){v+="if (u_filters > 0) {";for(var i=0;i<z.length;i++){v+="if (("+z[i]+" & u_filters) > 0) {";switch(z[i]){case WebGl.Stage2D.FILTERS.GRAYSCALE:v+="fragColor = vec4(vec3(1.0) * ((fragColor.r + (fragColor.g + fragColor.b)) / 3.0), fragColor.a);";break;case WebGl.Stage2D.FILTERS.SEPIA:v+="fragColor = vec4(vec3(0.874, 0.514, 0.156) * ((fragColor.r + (fragColor.g + fragColor.b)) / 3.0), fragColor.a);";break;case WebGl.Stage2D.FILTERS.INVERT:v+="fragColor = abs(vec4(fragColor.rgb - 1.0, fragColor.a));";break;case WebGl.Stage2D.FILTERS.COLORLIMIT:v+="fragColor = vec4((floor((fragColor.rgb * 256.0) / 32.0) / 256.0) * 32.0, fragColor.a);";break;case WebGl.Stage2D.FILTERS.VIGNETTE:v+="fragColor = vec4(fragColor.rgb * (1.0 - sqrt(pow(v_coord.x, 4.0) + pow(v_coord.y, 4.0))), fragColor.a);";break;case WebGl.Stage2D.FILTERS.RAINBOW:v+="fragColor = vec4(fragColor.rgb + vec3(v_coord.x * 0.15, v_coord.y * 0.15, (v_coord.x - v_coord.y) * 0.15), fragColor.a);";break;case WebGl.Stage2D.FILTERS.LINES:v+="fragColor += vec4(sin(v_coord.y * 500.0) * 0.2);";break};v+="}"};v+="}"};v+="}";return v});cnst(WebGl.Stage2D,"FILTERS",{"NONE":0,"GRAYSCALE":1,"SEPIA":2,"INVERT":4,"COLORLIMIT":8,"VIGNETTE":16,"RAINBOW":32,"LINES":64,});