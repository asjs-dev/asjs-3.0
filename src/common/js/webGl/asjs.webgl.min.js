(function(){var $="updateId,_height,_width,BaseFilter,_currentAdditionalPropsUpdateId,_context,lightRenderer,_locations,config,_source,_currentUpdateId,BasePrototypeClass,matrixCache,destruct,propsUpdateId,locations,filterRenderer,_enableBuffers,_scaleUpdateId,_clearBeforeRenderFunc,_currentRenderTime,_currentParentColorUpdateId,_currentParentPropsUpdateId,_currentColorUpdateId,_dataBuffer,_rotationUpdateId,children,_extensionData,_filter,_parent,removeEventListener,arraySet,createVersion,_matrixBuffer,_renderTime,_batchItems,premultipliedAlpha,_emptyTextureSlots,textureProps,_uploadBuffers,clearColor,_lightData,_onTextureLoadedBound,_canvas,_currentTexturePropsUpdateId,_currenActivetId,_drawFunctionMap,_updateId,precision,updateAnimation,_loseContextExt,_rotation,_baseTexture,colorCache,initRendererConfig,_currentRotationUpdateId,_distortionBuffer,texture,_onContextRestoredBound,maxBatchItems,_currentAglId,activeTexture,texParameteri,_renderFilterFuncBound,_extensionBuffer,addEventListener,_currentPropsUpdateId,_currentScaleUpdateId,_updateAdditionalData,sinRotationB,sinRotationA,cosRotationA,cosRotationB,_framebuffer,removeFromArray,BasePositioningProps,maxTextureImageUnits,_inverseMatrixCache,_createBuffers,_textureMap,_resizeId,Framebuffer,_onContextLostBound,_elementArrayBuffer,_filterFramebuffer,FilterTextureProps,_attachFramebuffer,destructObjectFlat,textureMatrixCache,isContextLost,createElement,_framebuffers,colorUpdateId,textureIds,_container,_eventType,_currentContextId,_corners,scaledHeight,useTextureAt,_updateProps,renderSource,_currentResizeId,_MAX_BATCH_ITEMS,useActiveTexture,textureRepeatRandomCache,pickerPoint,_positionBuffer,_batchDrawBound,textureCrop,_attachFramebufferAlias,distortionProps,_castShadow,_resizeFunc,scaledWidth,removeChild,_blurFilter,bindTexture,FilterRenderer,_drawInstanced,useTexture,useProgram,webglcontextrestored,setChildIndex,getChildIndex,clearTextures,LightRenderer,emptyFunction,createProgram,BatchRenderer,distortionPropsCache,_restoreContextBound,createPrototypeClass,renderToFramebuffer,getProgramParameter,_isPickerSet,BaseRenderer,setBlendMode,BaseDrawable,_updateShadowProps,deactivateTexture,_parseTextureSize,clearBeforeRender,initContextConfig,_currentBlendMode,useRepeatTextures,contextAttributes,readystatechange,webglcontextlost,textureCropCache,_minMipmapFilter,_updateTransform,_updateAnimation,_useTextureFrame,_switchToProgram,getShaderInfoLog,_MAX_TEXTURE_NUM".split(",");var $n=null,$u=undefined,$c=console,$w=window,$d=document,$o=Object;"use strict";var helpers={};var _=helpers;_[$[74]]=function(c,b){var d=c.indexOf(b);d>-1&&c.splice(d,1)};_[$[31]]=function(c,d,b){var i=d.length;while(--i>-1)c[b+i]=d[i]};_[$[132]]=function(c,g,b){var d=c.prototype;var f=g.prototype;$o.setPrototypeOf(g,c);$o.setPrototypeOf(f,d);b&&b.call(f,f,d);return g};_.property=function(d,b,f){f.enumerable=!0;f.configurable=!0;$o.defineProperty(d,b,f)};_.get=function(d,b,c){_.property(d,b,{get:c})};_.set=function(d,b,c){_.property(d,b,{set:c})};_[$[127]]=function(){};_.deleteProperty=function(c,b){var d=$o.getOwnPropertyDescriptor(c,b);if(d&&(d.get||d.set))_.property(c,b,{set:_[$[127]],get:_[$[127]]});try{c[b]=$n}catch(e){};delete c[b]};_.isEmpty=function(b){try{return b===$u||b===$n||b===""||b.length===0}catch(e){return!0}};_.iterateOver=function(h,j,k){if(_.isEmpty(h))return c();var d=$o.keys(h);var b;var i=-1;function c(){k&&k()};function f(){i++;if(i===d.length){c();return};b=d[i];if(h.hasOwnProperty&&!h.hasOwnProperty(b))f();var g;try{g=h[b]}catch(e){};var v=j(b,g,f,c);if(!_.isEmpty(v))h[b]=v};f()};_[$[87]]=function(f){_.iterateOver(f,function(b,c,d){_.deleteProperty(f,b);d()});f=$n};_[$[11]]=_[$[132]]($o,function d(){},function(c,b){c[$[13]]=function(){_[$[87]](this);_[$[87]](b);this[$[13]]=$n}});const F32A=Float32Array;const $m=Math;const min=$m.min;const max=$m.max;const sin=$m.sin;const cos=$m.cos;const emptyFunction=()=>{};$c.log("AGL 2.0 211130141726");$w.AGL={};(function(){AGL.Utils={};AGL.Utils.THETA=Math.PI/180;AGL.Utils.GLSL_RANDOM="float rand(vec2 p,float s){p+=floor(p/10000.);p=mod(p,vec2(10000));return fract(sin(dot(p,vec2(sin(p.x+p.y),cos(p.y-p.x)))*s)*.5+.5);}";AGL.Utils.INFO={isWebGl2Supported:!1};AGL.Utils[$[143]]=(f)=>{f=f||{};return{canvas:f.canvas||$d[$[90]]("canvas"),contextAttributes:$o.assign({powerPreference:"high-performance",preserveDrawingBuffer:!0},f[$[146]]||{})}};AGL.Utils[$[54]]=(f)=>{f=f||{};return{locations:f[$[15]]||[],precision:f[$[48]]||"lowp",context:f.context||new AGL.Context()}};AGL.Utils[$[32]]=(k)=>"#version 300 es\nprecision "+k+" float;\n";AGL.Utils.initApplication=(j)=>{const n=(d)=>{if($d.readyState==="complete"){$d[$[30]]($[147],v);const b=$d[$[90]]("canvas").getContext("webgl2");if(b){AGL.Utils.INFO.isWebGl2Supported=!0;AGL.Utils.INFO[$[76]]=b.getParameter(34930)};j(AGL.Utils.INFO.isWebGl2Supported)}else if(!d)$d[$[65]]($[147],v)};const v=n.bind(this,!0);n()};const r=(b,m,p)=>{const g=b.createShader(m);b.shaderSource(g,p);b.compileShader(g);return g};AGL.Utils[$[128]]=(b,w,y)=>{const q=r(b,35633,w);const s=r(b,35632,y);const h=b[$[128]]();b.attachShader(h,q);b.attachShader(h,s);b.linkProgram(h);if(!b[$[134]](h,35714)){$c.error("Program info:",b.getProgramInfoLog(h),"\n","Validate status:",b[$[134]](h,35715),"\n","Vertex shader info:",b[$[155]](q),"\n","Fragment shader info:",b[$[155]](s));b.deleteShader(q);b.deleteShader(s);b.deleteProgram(h);throw"WebGL application stoped"};return h};const t={a:"Attrib",u:"Uniform"};AGL.Utils.getLocationsFor=(b,h,x)=>{const l={};x.forEach(function(c){l[c]=b["get"+t[c[0]]+"Location"](h,c)});return l}})();(function(){function d(c,b){return{funcName:"blendFunc"+(c.length<3?"":"Separate"),funcs:c,eqName:"blendEquation"+(!b||b.length<2?"":"Separate"),eqs:b||[32774]}};AGL.BlendMode={NONE:d([0,0]),SIMPLE:d([1,1]),NORMAL_PM:d([1,771]),ADD_PM:d([1,1]),MULTIPLY_PM:d([774,771,1,771]),SCREEN_PM:d([1,769,1,771]),ADD_NPM:d([770,1,1,1]),SRC_IN:d([772,0]),SRC_OUT:d([773,0]),SRC_ATOP:d([772,771]),DST_OVER:d([773,1]),DST_IN:d([0,770]),DST_OUT:d([0,771]),DST_ATOP:d([773,770]),XOR:d([773,771]),NORMAL:d([770,771,1,771]),ADD:d([770,772,1,772]),MULTIPLY:d([774,771]),SCREEN:d([770,769,1,769]),OVERLAY:d([1,771]),EXCLUSION:d([775,769])}})();AGL.BaseProps=class{constructor(){this[$[0]]=0}};AGL[$[75]]=class extends AGL.BaseProps{constructor(){super();this[$[25]]=this[$[55]]=this[$[70]]=this[$[69]]=this._x=this._y=this[$[51]]=this._anchorX=this._anchorY=this._skewX=this._skewY=0;this[$[71]]=this[$[72]]=1};get x(){return this._x};set x(v){if(this._x!==v){this._x=v;++this[$[0]]}};get y(){return this._y};set y(v){if(this._y!==v){this._y=v;++this[$[0]]}};get rotation(){return this[$[51]]};set rotation(v){if(this[$[51]]!==v){this[$[51]]=v;++this[$[25]]}};get anchorX(){return this._anchorX};set anchorX(v){if(this._anchorX!==v){this._anchorX=v;++this[$[0]]}};get anchorY(){return this._anchorY};set anchorY(v){if(this._anchorY!==v){this._anchorY=v;++this[$[0]]}};get skewX(){return this._skewX};set skewX(v){if(this._skewX!==v){this._skewX=v;++this[$[25]]}};get skewY(){return this._skewY};set skewY(v){if(this._skewY!==v){this._skewY=v;++this[$[25]]}};updateRotation(){if(this[$[55]]<this[$[25]]){this[$[55]]=this[$[25]];++this[$[0]];if(this._skewX===0&&this._skewY===0){this[$[70]]=this[$[69]]=sin(this[$[51]]);this[$[71]]=this[$[72]]=cos(this[$[51]])}else{const b=this[$[51]]-this._skewX;const c=this[$[51]]+this._skewY;this[$[70]]=sin(c);this[$[71]]=cos(c);this[$[69]]=sin(b);this[$[72]]=cos(b)}}}};AGL.ColorProps=class extends AGL.BaseProps{constructor(){super();this.items=[1,1,1,1]};get r(){return this.items[0]};set r(v){if(this.items[0]!==v){this.items[0]=v;++this[$[0]]}};get g(){return this.items[1]};set g(v){if(this.items[1]!==v){this.items[1]=v;++this[$[0]]}};get b(){return this.items[2]};set b(v){if(this.items[2]!==v){this.items[2]=v;++this[$[0]]}};get a(){return this.items[3]};set a(v){if(this.items[3]!==v){this.items[3]=v;++this[$[0]]}};set(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a}};AGL.ItemProps=class extends AGL[$[75]]{constructor(){super();this[$[18]]=this[$[67]]=0;this[$[114]]=this[$[98]]=this._scaleX=this._scaleY=this[$[2]]=this[$[1]]=this.alpha=1};get scaleX(){return this._scaleX};set scaleX(v){if(this._scaleX!==v){this._scaleX=v;++this[$[18]]}};get scaleY(){return this._scaleY};set scaleY(v){if(this._scaleY!==v){this._scaleY=v;++this[$[18]]}};get width(){return this[$[2]]};set width(v){if(this[$[2]]!==v){this[$[2]]=v;++this[$[18]]}};get height(){return this[$[1]]};set height(v){if(this[$[1]]!==v){this[$[1]]=v;++this[$[18]]}};updateScale(){if(this[$[67]]<this[$[18]]){this[$[67]]=this[$[18]];++this[$[0]];this[$[114]]=this[$[2]]*this._scaleX;this[$[98]]=this[$[1]]*this._scaleY}}};AGL.LightProps=class extends AGL.ItemProps{constructor(){super();this.z=0};get width(){return this[$[2]]};set width(v){if(this[$[2]]!==v){this[$[2]]=this[$[1]]=v;++this[$[18]]}};get height(){return this[$[1]]};set height(v){}};AGL.TextureCrop=class extends AGL.BaseProps{constructor(){super();this[$[10]]=0;this.items=[0,0,1,1];this[$[2]]=this[$[1]]=1};get x(){return this.items[0]};set x(v){if(this.items[0]!==v){this.items[0]=v;++this[$[0]]}};get y(){return this.items[1]};set y(v){if(this.items[1]!==v){this.items[1]=v;++this[$[0]]}};get width(){return this[$[2]]};set width(v){if(this[$[2]]!==v){this[$[2]]=v;++this[$[0]]}};get height(){return this[$[1]]};set height(v){if(this[$[1]]!==v){this[$[1]]=v;++this[$[0]]}};updateCrop(){if(this[$[10]]<this[$[0]]){this[$[10]]=this[$[0]];this.items[2]=this[$[2]]-this.items[0];this.items[3]=this[$[1]]-this.items[1]}};setRect(b){this.x=b.x;this.y=b.y;this.width=b.width;this.height=b.height}};AGL.TextureProps=class extends AGL[$[75]]{constructor(){super();this._repeatX=this._repeatY=1;this.items=[0,0,0]};get scaledWidth(){return this._repeatX};get scaledHeight(){return this._repeatY};get repeatX(){return this._repeatX};set repeatX(v){if(this._repeatX!==v){this._repeatX=v;++this[$[0]]}};get repeatY(){return this._repeatY};set repeatY(v){if(this._repeatY!==v){this._repeatY=v;++this[$[0]]}};get repeatRandomRotation(){return this.items[0]};set repeatRandomRotation(v){this.items[0]=v};get repeatRandomColorization(){return this.items[1]};set repeatRandomColorization(v){this.items[1]=v};get repeatRandomBlur(){return this.items[2]};set repeatRandomBlur(v){this.items[2]=v}};AGL.DistortionProps=class{constructor(){this.distortTexture=!0;this.items=[0,0,1,0,1,1,0,1]};get topLeftX(){return this.items[0]};set topLeftX(v){this.items[0]=v};get topLeftY(){return this.items[1]};set topLeftY(v){this.items[1]=v};get topRightX(){return this.items[2]};set topRightX(v){this.items[2]=v};get topRightY(){return this.items[3]};set topRightY(v){this.items[3]=v};get bottomRightX(){return this.items[4]};set bottomRightX(v){this.items[4]=v};get bottomRightY(){return this.items[5]};set bottomRightY(v){this.items[5]=v};get bottomLeftX(){return this.items[6]};set bottomLeftX(v){this.items[6]=v};get bottomLeftY(){return this.items[7]};set bottomLeftY(v){this.items[7]=v}};AGL[$[85]]=class{constructor(d,f,h,j,b,c,g,k){this[$[28]]=d;this[$[57]]=f;this.translateX=h||0;this.translateY=j||0;this.cropX=b||0;this.cropY=c||0;this.cropWidth=g||1;this.cropHeight=k||1};get translateX(){return this[$[28]].v[1]};set translateX(v){this[$[28]].v[1]=v};get translateY(){return this[$[28]].v[2]};set translateY(v){this[$[28]].v[2]=v};get cropX(){return this[$[28]].v[3]};set cropX(v){this[$[28]].v[3]=v};get cropY(){return this[$[28]].v[4]};set cropY(v){this[$[28]].v[4]=v};get cropWidth(){return this[$[28]].v[5]};set cropWidth(v){this[$[28]].v[5]=v};get cropHeight(){return this[$[28]].v[6]};set cropHeight(v){this[$[28]].v[6]=v}};AGL.TextureInfo=class extends _[$[11]]{constructor(){super();this.target=3553;this[$[45]]=-1;this[$[60]]=this[$[47]]=this[$[10]]=0;this[$[101]]=$n;this.wrapS=this.wrapT=33071;this.internalFormat=this.format=6408;this.minFilter=this.magFilter=9728;this[$[2]]=this[$[1]]=1;this.type=5121};get width(){return this[$[2]]};get height(){return this[$[1]]};get minMipmapFilter(){return this[$[150]]};get minFilter(){return this._minFilter};set minFilter(v){if(this._minFilter!==v){this._minFilter=v;this[$[150]]=v===9729?9987:9984}};useActiveTexture(b,c){this[$[61]](b,c);this[$[120]](b)};unbindTexture(b,c){this[$[61]](b,c);this[$[45]]=-1;b[$[117]](this.target,$n)};activeTexture(b,c){this[$[45]]=c;b[$[61]](33984+c)};bindActiveTexture(b,c){this[$[61]](b,c);b[$[117]](this.target,this[$[52]])};useTexture(b){b[$[117]](this.target,this[$[52]]);this.uploadTexture(b)};uploadTexture(b){b.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this[$[101]]);b[$[62]](this.target,33085,0);b.generateMipmap(this.target);b[$[62]](this.target,10242,this.wrapS);b[$[62]](this.target,10243,this.wrapT);b[$[62]](this.target,10241,this.minMipmapFilter);b[$[62]](this.target,10240,this.magFilter)}};AGL.Texture=class extends AGL.TextureInfo{constructor(j,n){super();this[$[42]]=this[$[141]].bind(this);this.source=j;this.shouldUpdate=n;this[$[20]]=0;this[$[95]]};get loaded(){return this._loaded};get width(){return this._sourceWidth||1};get height(){return this._sourceHeight||1};get source(){return this[$[9]]};set source(f){if(f){this._loaded=!1;this[$[9]]&&this[$[9]][$[30]](this[$[95]],this[$[42]]);this[$[9]]=f;this.isVideo=this[$[9]].tagName?this[$[9]].tagName.toLowerCase()==="video":!1;this[$[95]]=this.isVideo?"canplay":"load";this[$[141]]();f[$[65]](this[$[95]],this[$[42]])}};use(b,c,m,l){if(this._isNeedToDraw(b,m))this[$[104]](b,c);else if(this[$[45]]!==c||l)this.bindActiveTexture(b,c)};destruct(){this[$[9]]&&this[$[9]][$[30]](this[$[95]],this[$[42]]);super[$[13]]()};_isNeedToDraw(b,m){if(this[$[60]]<b.agl_id){this[$[60]]=b.agl_id;this[$[52]]=b.createTexture();return!0};if(this.shouldUpdate&&this[$[20]]<m){this[$[20]]=m;return!0};if(this[$[10]]<this[$[47]]){this[$[10]]=this[$[47]];return!0};if(this.isVideo&&!this[$[9]].paused)return!0;return!1};get _sourceWidth(){return this[$[9]]?this[$[9]].naturalWidth||this[$[9]].videoWidth||this[$[9]].width:0};get _sourceHeight(){return this[$[9]]?this[$[9]].naturalHeight||this[$[9]].videoHeight||this[$[9]].height:0};_parseTextureSize(){this._loaded=this._sourceWidth>0&&this._sourceHeight>0;if(this._loaded){this[$[101]]=this[$[9]];++this[$[47]]}else this[$[101]]=$n}};AGL.Texture.loadImage=function(d,n){const g=$d[$[90]]("img");const k=new AGL.Texture(g,n);g.src=d;return k};AGL.Texture.loadVideo=function(d,n){const h=$d[$[90]]("video");const k=new AGL.Texture(h,n);h.src=d;return k};AGL[$[81]]=class extends AGL.TextureInfo{get width(){return this[$[2]]};set width(v){if(this[$[2]]!==v&&v>0){this[$[2]]=v;++this[$[47]]}};get height(){return this[$[1]]};set height(v){if(this[$[1]]!==v&&v>0){this[$[1]]=v;++this[$[47]]}};setSize(w,h){this.width=w;this.height=h};bind(b){b.bindFramebuffer(36160,this[$[73]])};unbind(b){b.bindFramebuffer(36160,$n)};use(b,c){!this._update(b,c)&&this[$[45]]!==c&&this._use(b,c)};_use(b,c){this[$[61]](b,c);b[$[117]](this.target,this[$[52]])};_update(b,c){let d=!1;if(this[$[60]]<b.agl_id){this[$[60]]=b.agl_id;this[$[73]]=b.createFramebuffer();this[$[52]]=b.createTexture();this[$[104]](b,c);this.bind(b);b.framebufferTexture2D(36160,36064,3553,this[$[52]],0);this.unbind(b);d=!0};if(this[$[10]]<this[$[47]]){this[$[10]]=this[$[47]];this[$[104]](b,c);d=!0};return d}};AGL.Context=class extends _[$[11]]{constructor(g){super();this.contextId=0;this._config=AGL.Utils[$[143]](g||{});this[$[43]]=this._config.canvas;this[$[156]]=AGL.Utils.INFO[$[76]];this[$[82]]=this._onContextLost.bind(this);this[$[58]]=this._initContext.bind(this);this[$[131]]=this._restoreContext.bind(this);this[$[43]][$[65]]($[148],this[$[82]]);this[$[43]][$[65]]($[122],this[$[58]]);this._initContext()};get canvas(){return this[$[43]]};get isContextLost(){return this.gl&&this.gl[$[89]]&&this.gl[$[89]]()};useBlendMode(l){this[$[144]]=l;this.gl[l.eqName].apply(this.gl,l.eqs);this.gl[l.funcName].apply(this.gl,l.funcs)};setBlendMode(l,r){if(this[$[144]]!==l){r&&r();this.useBlendMode(l)}};destruct(){this.gl[$[121]]($n);this[$[43]][$[30]]($[148],this[$[82]]);this[$[43]][$[30]]($[122],this[$[58]]);this[$[50]]&&this[$[50]].loseContext();super[$[13]]()};clearTextures(){for(let i=0;i<this[$[156]];++i){this[$[79]][i]=$n;this[$[37]][i]=i};this[$[93]].length=0};useTexture(q,p,m,k){if(!q)return-1;let n=this[$[79]].indexOf(q);if(n<0){n=this[$[37]][0];m=!0};if(this[$[37]].length<1){k&&k();this[$[125]]();n=0;m=!0};return this[$[99]](q,n,p,m)};useTextureAt(q,n,p,m){q.use(this.gl,n,p,m);this[$[79]][n]=q;this[$[93]].indexOf(n)<0&&this[$[93]].push(n);_[$[74]](this[$[37]],n);return n};deactivateTexture(q){const n=q?this[$[79]].indexOf(q):-1;n>-1&&q.unbindTexture(this.gl,n)};useProgram(j,c){if(this._currentProgram!==j){this._currentProgram=j;this[$[125]]();const b=this.gl;b.bindVertexArray($n);b[$[121]](j);b.bindVertexArray(c);return!0};return!1};setCanvasSize(d,h){this[$[43]].width!==d&&(this[$[43]].width=d);this[$[43]].height!==h&&(this[$[43]].height=h)};setSize(d,h){if(this.width!==d||this.height!==h){this.width=d;this.height=h;this.gl.scissor(0,0,d,h);this.gl.viewport(0,0,d,h);return!0};return!1};_onContextLost(f){f.preventDefault();this[$[50]]&&setTimeout(this[$[131]],1)};_restoreContext(){this[$[50]].restoreContext()};_initContext(){++this.contextId;const b=this.gl=this[$[43]].getContext("webgl2",this._config[$[146]]);b.agl_id=this.contextId;this[$[50]]=b.getExtension('WEBGL_lose_context');b.pixelStorei(37441,!0);b.enable(3042);b.enable(3089);this[$[79]]=[];this[$[37]]=[];this[$[93]]=[];this[$[125]]()}};AGL.Buffer=class extends _[$[11]]{constructor(q,d,f,g,j,h,m){super();const k=f*g;this.data=typeof d==="number"?new F32A(d*k):d;this._locationName=q;this._rows=f;this._cols=g;this._target=j||34962;this._type=h||35048;this._length=k*4;this._offset=g*4;this._divisor=typeof m==="number"?m:1;if(this._type===35044){this._length=this._offset=0}};create(b){this._buffer=b.createBuffer();this.bind(b)};bind(b){b.bindBuffer(this._target,this._buffer)};upload(b,l,p){this.bind(b);l&&this._enable(b,p);b.bufferData(this._target,this.data,this._type)};l(b,p){this.bind(b);this._enable(b,p)};_enable(b,p){const n=p[this._locationName];let i=-1;while(++i<this._rows){const c=n+i;b.enableVertexAttribArray(c);b.vertexAttribPointer(c,this._cols,5126,!1,this._length,i*this._offset);b.vertexAttribDivisor(c,this._divisor)}}};AGL.FPS={start:function(c){this._targetMS=this._then=this._frames=this._prevTime=this.fps=this.delay=0;this._then=Date.now();this._targetMS=1000/(c||60)},update:function(){this._frames++;const b=Date.now();this.delay=(b-this._then)/this._targetMS;if(b>=this._prevTime+1000){this.fps=(this._frames*1000)/(b-this._prevTime);this._prevTime=b;this._frames=0};this._then=b}};AGL.Matrix3={identity:()=>new F32A([1,0,0,1,0,0]),projection:(d,h,z)=>{z[0]=2/d;z[1]=z[2]=0;z[3]=-2/h;z[4]=-1;z[5]=1},transformLocal:(f,z)=>{const k=f.anchorX;const j=f.anchorY;const q=f[$[114]];const r=f[$[98]];z[0]=f[$[71]]*q;z[1]=f[$[70]]*q;z[2]=-f[$[69]]*r;z[3]=f[$[72]]*r;z[4]=f.x-k*z[0]-j*z[2];z[5]=f.y-k*z[1]-j*z[3]},transform:(g,f,z)=>{const x=f.x;const y=f.y;const k=f.anchorX;const j=f.anchorY;const s=f[$[70]];const t=f[$[69]];const v=f[$[71]];const w=f[$[72]];const q=f[$[114]];const r=f[$[98]];z[0]=(v*g[0]+s*g[2])*q;z[1]=(v*g[1]+s*g[3])*q;z[2]=(w*g[2]-t*g[0])*r;z[3]=(w*g[3]-t*g[1])*r;z[4]=-k*z[0]-j*z[2]+x*g[0]+y*g[2]+g[4];z[5]=-k*z[1]-j*z[3]+x*g[1]+y*g[3]+g[5]},inverse:(g,z)=>{const b=1/(g[0]*g[3]-g[2]*g[1]);z[0]=b*g[3];z[1]=-b*g[1];z[2]=-b*g[2];z[3]=b*g[0];z[4]=b*(g[2]*g[5]-g[3]*g[4]);z[5]=-b*(g[0]*g[5]-g[1]*g[4])},isPointInMatrix:(g,c)=>{const x=c.x*g[0]+c.y*g[2]+g[4];const y=c.x*g[1]+c.y*g[3]+g[5];return x>=0&&x<=1&&y>=0&&y<=1},calcCorners:(g,l,n)=>{const m=n.widthHalf;const p=n.heightHalf;l[0].x=m+g[4]*m;l[0].y=n.height-(p+g[5]*p);l[1].x=l[0].x+(g[0]+g[2])*m;l[1].y=l[0].y-(g[1]+g[3])*p;l[2].x=l[0].x+(g[0]+m*g[2]);l[2].y=l[0].y-(g[1]+p*g[3]);l[3].x=l[0].x+(m*g[0]+g[2]);l[3].y=l[0].y-(p*g[1]+g[3])}};AGL.Point={create:(x,y)=>({x:x||0,y:y||0})};AGL.Rect={create:(x,y,c,d)=>({x:x||0,y:y||0,width:c||0,height:d||0}),toRelativeSize:(b,c,d)=>({x:b.x/c,y:b.y/d,width:b.width/c,height:b.height/d})};AGL.BaseItem=class extends _[$[11]]{constructor(){super();this[$[12]]=AGL.Matrix3.identity();this[$[92]]=this[$[14]]=0;this[$[53]]=[1,1,1,1]}};AGL.Item=class extends AGL.BaseItem{constructor(){super();this.TYPE=AGL.Item.TYPE;this.renderable=!0;this.props=new AGL.ItemProps();this.color=new AGL.ColorProps();this[$[66]]=this[$[23]]=this[$[22]]=this[$[21]]=this[$[4]]=0;this.callback=emptyFunction;this._bounds=AGL.Rect.create()};get stage(){return this[$[29]]?this[$[29]].stage:$n};get parent(){return this[$[29]]};set parent(v){if(this[$[29]]!==v){this[$[29]]=v;this[$[22]]=this[$[21]]=this[$[4]]=0}};get callback(){return this._callback};set callback(v){this._callback=v||emptyFunction};getBounds(){return this._bounds};destruct(){this[$[29]]&&this[$[29]][$[115]]&&this[$[29]][$[115]](this);super[$[13]]()};update(){this[$[100]]()};_updateProps(){const b=this.props;b.updateRotation();b.updateScale();const c=this[$[29]];(this[$[22]]<c[$[14]]||this[$[66]]<b[$[0]])&&this[$[151]](b,c)};_updateTransform(b,c){this[$[22]]=c[$[14]];this[$[66]]=b[$[0]];++this[$[14]];AGL.Matrix3.transform(c[$[12]],b,this[$[12]])}};AGL.Item.TYPE="item";AGL[$[138]]=class extends AGL.Item{constructor(g){super();this[$[77]]=new F32A(6);this[$[97]]=[AGL.Point.create(),AGL.Point.create(),AGL.Point.create(),AGL.Point.create()]};getCorners(){this[$[68]]();return this[$[97]]};getBounds(){this[$[68]]();return this._bounds};_calcCorners(){AGL.Matrix3.calcCorners(this[$[12]],this[$[97]],this.stage.renderer)};_calcBounds(){this._calcCorners();const h=this[$[97]];const f=this._bounds;const a=h[0];const b=h[1];const c=h[2];const d=h[3];f.x=min(a.x,b.x,c.x,d.x);f.y=min(a.y,b.y,c.y,d.y);f.width=max(a.x,b.x,c.x,d.x);f.height=max(a.y,b.y,c.y,d.y)};_updateAdditionalData(){if(this[$[4]]<this[$[14]]){this[$[4]]=this[$[14]];AGL.Matrix3.inverse(this[$[12]],this[$[77]]);this._calcBounds()}}};AGL.Light=class extends AGL[$[138]]{constructor(f,n,p){super();this.props=new AGL.LightProps();this.color.a=0;this._id=f;this._matId=f*16;this._colId=this._matId+8;this._datId=this._matId+12;this._extId=f*4;this[$[41]]=n;this[$[27]]=p;this[$[112]]=this._gouraud=!0;this.angle=0;this.spotAngle=180*AGL.Utils.THETA;this.castShadow=this.gouraud=!0;this.type=AGL.Light.Type.SPOT;this[$[48]]=this.diffuse=1};get type(){return this[$[27]][this._extId]};set type(v){this[$[27]][this._extId]=v};get castShadow(){return this[$[112]]};set castShadow(v){this[$[112]]=v;this[$[139]]()};get gouraud(){return this._gouraud};set gouraud(v){this._gouraud=v;this[$[139]]()};get precision(){return this[$[27]][this._extId+3]};set precision(v){this[$[27]][this._extId+3]=max(1,v)};get angle(){return this[$[41]][this._datId+3]};set angle(v){this[$[41]][this._datId+3]=v};get spotAngle(){return this[$[41]][this._matId+7]};set spotAngle(v){this[$[41]][this._matId+7]=v};isOn(){return this.renderable&&this.stage!==$n};update(){const n=this[$[41]];const g=this._datId;if(this.isOn()){this[$[100]]();this._updateColor();n[g]=n[g-1]>0?1:0;n[g+1]=this.diffuse;n[g+2]=this.props.alpha;n[this._matId+6]=this.props.width;this[$[27]][this._extId+2]=this.props.z}else n[g]=0};_updateShadowProps(){this[$[27]][this._extId+1]=this[$[112]]*1|this._gouraud*2};_updateAdditionalData(){if(this.isOn()&&this[$[4]]<this[$[14]]){this[$[4]]=this[$[14]];this._calcBounds()}};_calcCorners(){AGL.Matrix3.calcCorners(this[$[12]],this[$[97]],this.stage.renderer);const m=this[$[97]];const a=m[0];const b=m[1];const c=m[2];const d=m[3];a.x+=(a.x-d.x)+(a.x-c.x);a.y+=(a.y-d.y)+(a.y-c.y);c.x+=(c.x-b.x);c.y+=(c.y-b.y);d.x+=(d.x-b.x);d.y+=(d.y-b.y)};_updateTransform(h,l){super[$[151]](h,l);_[$[31]](this[$[41]],this[$[12]],this._matId)};_updateColor(){const j=this.color;if(this[$[23]]<j[$[0]]){this[$[23]]=j[$[0]];const n=this[$[41]];const q=this[$[29]][$[53]];const k=this._colId;n[k]=q[0]*j.r;n[k+1]=q[1]*j.g;n[k+2]=q[2]*j.b;n[k+3]=q[3]*j.a}}};AGL.Light.Type={SPOT:0,AMBIENT:1};AGL.Image=class extends AGL[$[138]]{constructor(d){super();this.TYPE=AGL.Image.TYPE;this[$[88]]=AGL.Matrix3.identity();this.tintType=AGL.Image.TintType.NONE;this.blendMode=AGL.BlendMode.NORMAL;this[$[38]]=new AGL.TextureProps();this[$[109]]=new AGL.TextureCrop();this[$[111]]=new AGL.DistortionProps();this[$[44]]=0;this[$[149]]=this[$[109]].items;this[$[105]]=this[$[38]].items;this[$[130]]=this[$[111]].items;this[$[53]]=this.color.items;this[$[57]]=d};update(){this[$[100]]();this._updateTexture();this[$[109]].updateCrop()};isContainsPoint(c){this[$[68]]();return AGL.Matrix3.isPointInMatrix(this[$[77]],c)};_updateTexture(){const b=this[$[38]];b.updateRotation();if(this[$[44]]<b[$[0]]){this[$[44]]=b[$[0]];AGL.Matrix3.transformLocal(b,this[$[88]])}}};AGL.Image.TYPE="drawable";AGL.Image.TintType={NONE:0,NORMAL:1,GRAYSCALE:2,OVERRIDE:3};AGL.AnimatedImage=class extends AGL.Image{constructor(c){super(c);this.frameLength=120;this.frames=[];this.frame=this[$[20]]=0;this[$[49]];this.stop()};get isPlaying(){return this[$[49]]===this[$[152]]};gotoAndStop(b){this.stop();this.frame=b;this[$[153]]()};gotoAndPlay(b){this.frame=b;this.play()};stop(){this[$[49]]=emptyFunction};play(){this[$[49]]=this[$[152]]};update(d){super.update();this[$[49]](d)};destruct(){this.stop();super[$[13]]()};_updateAnimation(d){const f=d-this[$[20]];if(f>this.frameLength){this[$[20]]=d;this.frame+=~~(f/this.frameLength);this.frame>=this.frames.length&&(this.frame=0);this[$[153]]()}};_useTextureFrame(){this[$[109]].setRect(this.frames[this.frame])}};AGL.Container=class extends AGL.Item{constructor(){super();this.TYPE=AGL.Container.TYPE;this[$[36]]=1;this[$[26]]=[]};destruct(){this.empty();super[$[13]]()};empty(){while(this[$[26]].length)this.removeChildAt(0)};contains(b){return this[$[124]](b)>-1};addChild(b){return this.addChildAt(b,this[$[26]].length)};addChildAt(b,c){if(b){b.parent&&b.parent[$[115]](b);this[$[26]].push(b);this[$[123]](b,c);b.parent=this};return b};removeChild(b){if(b){_[$[74]](this[$[26]],b);b.parent=$n};return b};removeChildAt(c){return this[$[115]](this.getChildAt(c))};getChildAt(c){return this[$[26]][c]};setChildIndex(b,c){_[$[74]](this[$[26]],b);this[$[26]].splice(c,0,b);return b};getChildIndex(b){return this[$[26]].indexOf(b)};swapChildren(f,g){const l=this[$[124]](f);const m=this[$[124]](g);if(l<0||m<0)return!1;this[$[123]](f,m);this[$[123]](g,l);return!0};getBounds(){const h=this._bounds;h.x=h.y=1/0;h.width=h.height=-1/0;for(let i=0,l=this[$[26]].length;i<l;++i){const n=this[$[26]][i].getBounds();h.x=min(h.x,n.x);h.y=min(h.y,n.y);h.width=max(h.width,n.width);h.height=max(h.height,n.height)};return h};update(){this[$[100]]();this._updateColor()};_updatePremultipliedAlpha(){this[$[36]]=this.props.alpha*this.parent[$[36]]};_updateColor(){const j=this[$[29]];const d=this.color;this._updatePremultipliedAlpha();if(this[$[21]]<j[$[92]]||this[$[23]]<d[$[0]]){this[$[23]]=d[$[0]];this[$[21]]=j[$[92]];++this[$[92]];const k=this[$[53]];const p=j[$[53]];k[0]=p[0]*d.r;k[1]=p[1]*d.g;k[2]=p[2]*d.b;k[3]=p[3]*d.a}}};AGL.Container.TYPE="container";AGL.StageContainer=class extends AGL.Container{constructor(b){super();this.renderer=b;this[$[29]]=new AGL.BaseItem()};get stage(){return this};get parent(){return this[$[29]]};_updatePremultipliedAlpha(){this[$[36]]=this.props.alpha}};AGL.SmoothLight=class extends _[$[11]]{constructor(b){super();b=b||{};this[$[73]]=new AGL[$[81]]();this[$[6]]=new AGL[$[126]](b);this[$[6]][$[40]].set(0,0,0,1);this[$[6]][$[142]]=!0;this[$[116]]=new AGL.BlurFilter();this[$[16]]=new AGL[$[118]]({config:{context:this[$[6]].context},texture:this[$[73]],filters:[this[$[116]]]});this[$[16]][$[40]].set(0,0,0,0);this[$[16]][$[142]]=!0;this.image=new AGL.Image();this.image.blendMode=AGL.BlendMode.MULTIPLY;if(!b[$[8]].context){this.image[$[57]]=new AGL.Texture(this[$[16]].context.canvas,!0);this[$[63]]=this._renderFilter.bind(this)}else{this[$[84]]=new AGL[$[81]]();this.image[$[57]]=this[$[84]];this[$[63]]=this._renderFilterToFramebuffer.bind(this)};this.blur=typeof b.blur==="number"?b.blur:1};get scale(){return this[$[6]].scale};set scale(v){if(this[$[6]].scale!==v){this[$[6]].scale=v;this[$[113]]=this._resize}};get blur(){return this._blur};set blur(v){this._blur=this[$[116]].intensityX=this[$[116]].intensityY=v};render(){this[$[113]]();this[$[6]][$[133]](this[$[73]]);this[$[63]]()};setSize(w,h){this[$[2]]=w;this[$[1]]=h;this[$[113]]=this._resize};destruct(){this[$[6]][$[13]]();this[$[16]][$[13]]();this.image[$[13]]();super[$[13]]()};_renderFilter(){this[$[16]].render()};_renderFilterToFramebuffer(){this[$[16]][$[133]](this[$[84]])};_resize(){this[$[113]]=emptyFunction;const c=this[$[2]]*this[$[6]].scale;const d=this[$[1]]*this[$[6]].scale;this.image.props.width=this[$[2]];this.image.props.height=this[$[1]];this[$[6]].setSize(c,d);this[$[16]].setSize(c,d)}};AGL[$[136]]=class extends _[$[11]]{constructor(f){super();this[$[110]]=this[$[86]];this[$[19]]=emptyFunction;this[$[40]]=new AGL.ColorProps();this[$[96]]=this[$[34]]=this[$[80]]=this[$[102]]=0;this._options=f;this._config=this._options[$[8]];this[$[5]]=this._config.context;this._config[$[15]]=this._config[$[15]].concat(["uFlpY","aPos","uTex"]);this._vao=this[$[5]].gl.createVertexArray();this[$[17]]=!1;this[$[83]]=new AGL.Buffer("",new Uint16Array([0,1,3,2]),0,0,34963,35044);this[$[107]]=new AGL.Buffer("aPos",new F32A([0,0,1,0,1,1,0,1]),1,2,34962,35044,0)};get context(){return this[$[5]]};get width(){return this[$[2]]};set width(v){if(this[$[2]]!==v){this[$[2]]=v;this.widthHalf=v*.5;++this[$[80]]}};get height(){return this[$[1]]};set height(v){if(this[$[1]]!==v){this[$[1]]=v;this.heightHalf=v*.5;++this[$[80]]}};get clearBeforeRender(){return this[$[19]]===this._clear};set clearBeforeRender(v){this[$[19]]=v?this._clear:emptyFunction};setSize(b,d){this.width=b;this.height=d};renderToFramebuffer(h){if(!this[$[5]][$[89]]){this[$[154]]();this[$[110]](h);this._renderBatch(h);h.unbind(this._gl)}};render(){if(!this[$[5]][$[89]]){this[$[154]]();this._gl.uniform1f(this[$[7]].uFlpY,1);this._renderBatch()}};_renderBatch(h){this[$[34]]=Date.now();this[$[19]]();this._render(h);this._gl.flush()};_switchToProgram(){this._gl=this[$[5]].gl;if(this[$[96]]<this[$[5]].contextId){this[$[96]]=this[$[5]].contextId;this._buildProgram();this[$[17]]=!0}else if(this[$[5]][$[121]](this._program,this._vao))this[$[17]]=!0;this._resize()};_attachFramebuffer(h){h.setSize(this[$[2]],this[$[1]]);this[$[5]][$[120]](h,this[$[34]]);this[$[5]][$[140]](h);h.bind(this._gl);this[$[19]]();this._gl.uniform1f(this[$[7]].uFlpY,-1)};_clear(){this._gl[$[40]](this[$[40]].r,this[$[40]].g,this[$[40]].b,this[$[40]].a);this._gl.clear(16384)};_resize(){if(this[$[5]].setSize(this[$[2]],this[$[1]]))++this[$[80]];if(this[$[102]]<this[$[80]]){this[$[102]]=this[$[80]];this._customResize()}};_customResize(){};_drawInstanced(c){this._gl.drawElementsInstanced(5,4,5123,0,c)};_buildProgram(){const f=this._options;const g=AGL.Utils[$[128]](this._gl,this._createVertexShader(f),this._createFragmentShader(f));this._program=g;this[$[7]]=AGL.Utils.getLocationsFor(this._gl,g,this._config[$[15]]);this[$[5]][$[121]](g,this._vao);this[$[78]]()};_uploadBuffers(){this[$[107]].upload(this._gl,!0,this[$[7]]);this[$[83]].upload(this._gl);this[$[17]]=!1};_createBuffers(){this[$[83]].create(this._gl);this[$[107]].create(this._gl)}};var ASJSUtils=ASJSUtils||{};AGL[$[129]]=class extends AGL[$[136]]{constructor(b){b[$[8]][$[15]]=b[$[8]][$[15]].concat(["aMt"]);super(b);this[$[103]]=b[$[59]]||1;this[$[33]]=new AGL.Buffer("aMt",this[$[103]],4,4)};_uploadBuffers(){this[$[33]].upload(this._gl,this[$[17]],this[$[7]]);super[$[39]]()};_createBuffers(){super[$[78]]();this[$[33]].create(this._gl)}};AGL[$[118]]=class extends AGL[$[136]]{constructor(g){g=g||{};g[$[8]]=AGL.Utils[$[54]](g[$[8]],AGL[$[118]]);g[$[8]][$[15]]=g[$[8]][$[15]].concat(["uFTex","uFtrT","uFtrV","uFtrK"]);g[$[59]]=1;super(g);this.filters=g.filters||[];this[$[57]]=g[$[57]];this[$[91]]=[new AGL[$[81]](),new AGL[$[81]]()]};destruct(){this[$[91]][0][$[13]]();this[$[91]][1][$[13]]();super[$[13]]()};_attachFramebufferAlias(){};_render(n){const h=this[$[5]];const b=this._gl;const m=this[$[34]];const j=this[$[7]];h[$[137]](AGL.BlendMode.NORMAL);this[$[39]]();h[$[99]](this[$[57]],0,m,!0);b.uniform1i(j.uTex,0);const l=this.filters.length||1;const c=l-2;for(let i=0;i<l;++i){let q;const d=this.filters[i];const k=d&&d.on;const f=i>c;const p=k&&d[$[38]]&&d[$[38]][$[57]];if(p){h[$[99]](p,1,m,!0);b.uniform1i(j.uFTex,1)};if(f){if(n)this[$[86]](n);else b.uniform1f(j.uFlpY,1)}else if(k){q=this[$[91]][i&1];this[$[86]](q)};if(k){b.uniform1fv(j.uFtrV,d.v);b.uniformMatrix4fv(j.uFtrK,!1,d.kernels);b.uniform2i(j.uFtrT,d.TYPE,d.SUB_TYPE)};(k||f)&&this[$[119]](1);p&&h[$[140]](p);if(q){q.unbind(b);h[$[99]](q,0,m,!0)}}};_createVertexShader(g){return AGL.Utils[$[32]](g[$[8]][$[48]])+"in vec2 aPos;uniform float uFlpY;out vec2 vCrd,vTCrd;void main(void){vec4 pos=vec4(aPos*2.-1.,1,1);gl_Position=pos;gl_Position.y*=uFlpY;vCrd=pos.xy;vTCrd=vec2(aPos.x,1.-aPos.y);}"};_createFragmentShader(g){return AGL.Utils[$[32]](g[$[8]][$[48]])+"uniform sampler2D uTex,uFTex;uniform ivec2 uFtrT;uniform float uFtrV[9];uniform mat4 uFtrK;in vec2 vCrd,vTCrd;out vec4 oCl;void main(void){oCl=texture(uTex,vTCrd);if(uFtrT.x>0){float[] vl=uFtrV;float v=vl[0];vec2 oPx=1./vec2(textureSize(uTex,0)),vol=v*oPx;if(uFtrT.x<2){mat4 kr=uFtrK*v;oCl=vec4((texture(uTex,vTCrd-oPx)*kr[0].x+texture(uTex,vTCrd+oPx*vec2(0,-1))*kr[0].y+texture(uTex,vTCrd+oPx*vec2(1,-1))*kr[0].z+texture(uTex,vTCrd+oPx*vec2(-1,0))*kr[0].w+oCl*kr[1].x+texture(uTex,vTCrd+oPx*vec2(1,0))*kr[1].y+texture(uTex,vTCrd+oPx*vec2(-1,1))*kr[1].z+texture(uTex,vTCrd+oPx*vec2(0,1))*kr[1].w+texture(uTex,vTCrd+oPx)*kr[2].x).rgb,oCl.a);}else if(uFtrT.x<3){mat4 kr=uFtrK;oCl.rgb=vec3(kr[0].r*oCl.r+kr[0].g*oCl.g+kr[0].b*oCl.b+kr[0].a,kr[1].r*oCl.r+kr[1].g*oCl.g+kr[1].b*oCl.b+kr[1].a,kr[2].r*oCl.r+kr[2].g*oCl.g+kr[2].b*oCl.b+kr[2].a);}else if(uFtrT.x<4){vec4 oClVl=oCl*(1.-v);if(uFtrT.y<2)oCl=oClVl+vec4(vec3((oCl.r+oCl.g+oCl.b)/3.),oCl.a)*v;else if(uFtrT.y<3)oCl=oClVl+vec4(vec3(.874,.514,.156)*((oCl.r+oCl.g+oCl.b)/3.),oCl.a)*v;else if(uFtrT.y<4)oCl=oClVl+vec4(1.-oCl.rgb,oCl.a)*v;else if(uFtrT.y<5)oCl.rgb*=vec3(vl[2],vl[3],vl[4])*v;else if(uFtrT.y<6)oCl=vec4((round((oCl.rgb*256.)/v)/256.)*v,oCl.a);else if(uFtrT.y<7){vec2 pv=pow(abs(vCrd*v),vec2(vl[1]));float cv=clamp(min(1.,(1.-length(pv))*vl[5]),0.,1.);oCl.rgb=oCl.rgb*vec3(cv)+vec3(vl[2],vl[3],vl[4])*(1.-cv);}else if(uFtrT.y<8)oCl.rgb+=vec3(vCrd.xy*.15,(vCrd.x*vCrd.y)*.15)*v;else if(uFtrT.y<9)oCl.rgb=vec3((oCl.rgb-.5)*vl[1]+.5+v);else if(uFtrT.y<10)oCl.rgb=vec3(pow(oCl.rgb,vec3(v)));}else if(uFtrT.x<5){vec2 wh=oPx*vec2(v,vl[1]);vec4 cl,tCl;float c,m,im;if(uFtrT.y<2)for(float i=-2.;i<3.;++i){for(float j=-2.;j<3.;++j){m=abs(i)+abs(j);im=1.-(m*.25);tCl=i==0.&&j==0.?oCl:texture(uTex,vTCrd+(wh*vec2(i,j)));cl+=tCl*im;c+=im;}}else{float oAvg=uFtrT.y==2?(oCl.r+oCl.g+oCl.b+oCl.a)/4.:0.;for(float i=-2.;i<3.;++i){for(float j=-2.;j<3.;++j){m=abs(i)+abs(j);im=1.-(m*.25);tCl=i==0.&&j==0.?oCl:texture(uTex,vTCrd+(wh*vec2(i,j)));float avg=(tCl.r+tCl.g+tCl.b+tCl.a)/4.;if(avg-oAvg>=vl[3]*m){cl+=tCl*im*(2.-vl[3]);c+=im;}}}}oCl=cl/c;}else if(uFtrT.x<6)oCl=texture(uTex,floor(vTCrd/vol)*vol);else if(uFtrT.x<7){vec2 dspMd=vec2(1,-1)*(texture(uFTex,mod(vec2(vl[1],vl[2])+vTCrd,1.)*vec2(vl[5]-vl[3],vl[6]-vl[4])).rg-.5)*2.*vol;oCl=texture(uTex,vTCrd+dspMd);}else if(uFtrT.x<8){vec4 mskCl=texture(uFTex,mod(vec2(vl[1],vl[2])+vTCrd,1.)*vec2(vl[5]-vl[3],vl[6]-vl[4]));oCl.a*=v<4.?mskCl[int(v)]:(mskCl.r+mskCl.g+mskCl.b+mskCl.a)/4.;}}}"}};AGL[$[126]]=class extends AGL[$[129]]{constructor(c){c=c||{};c[$[8]]=AGL.Utils[$[54]](c[$[8]],AGL[$[126]]);c[$[8]][$[15]]=c[$[8]][$[15]].concat(["aExt","uS","uSC"]);const d=c[$[59]]=c.lightNum||1;super(c);this.heightMap=c.heightMap;this.scale=c.scale||1;this[$[64]]=new AGL.Buffer("aExt",d,1,4);this._lights=[];for(let i=0;i<d;++i)this._lights.push(new AGL.Light(i,this[$[33]].data,this[$[64]].data))};getLight(b){return this._lights[b]};_render(){this[$[5]][$[137]](AGL.BlendMode.ADD);this.heightMap&&this._gl.uniform1i(this[$[7]].uTex,this[$[5]][$[120]](this.heightMap,this[$[34]],!0));this._gl.uniform1f(this[$[7]].uSC,this.scale);this[$[39]]();this[$[119]](this._lights.length)};_customResize(){this._gl.uniform4f(this[$[7]].uS,this[$[2]],this[$[1]],1/this[$[2]],1/this[$[1]])};_uploadBuffers(){this[$[64]].upload(this._gl,this[$[17]],this[$[7]]);super[$[39]]()};_createBuffers(){super[$[78]]();this[$[64]].create(this._gl)};_createVertexShader(c){return AGL.Utils[$[32]](c[$[8]][$[48]])+"#define H vec4(1,-1,2,-2)\n#define PI radians(180.)\nin vec2 aPos;in vec4 aExt;in mat4 aMt;uniform float uFlpY,uSC;out float vHS,vD,vSpt,vSC;out vec2 vTCrd,vSln;out vec4 vCrd,vCl,vDt,vExt;void main(void){vExt=aExt;vCl=aMt[2];vDt=aMt[3];vSC=uSC;vec3 pos=vec3(aPos*2.-1.,1);vCrd.xy=pos.xy*vSC;vHS=vExt.z*vSC;mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1);vExt.w*=vSC;vDt.y*=vSC;vD=aMt[1].z*vSC;if(vExt.x<1.){gl_Position=vec4(mt*pos,1);vTCrd=(gl_Position.xy+H.xy)/H.zw;vCrd.zw=(aMt[1].xy+H.xy)/H.zw;vSpt=PI-aMt[1].w;vSln=vec2(sin(vDt.w),cos(vDt.w));}else{mt[2].xy=vec2(-1,1);gl_Position=vec4(pos,1);vTCrd=vec2(aPos.x,1.-aPos.y);vCrd.zw=vTCrd+((mt*vec3(1)).xy+H.xy)/H.zw;}gl_Position.y*=uFlpY;vSC*=100.;}"};_createFragmentShader(c){return AGL.Utils[$[32]](c[$[8]][$[48]])+"#define PI radians(180.)\n#define PIH radians(90.)\nin float vHS,vD,vSpt,vSC;in vec2 vTCrd,vSln;in vec4 vCrd,vCl,vDt,vExt;uniform sampler2D uTex;uniform vec4 uS;out vec4 oCl;void main(void){if(vDt.x>0.){bool isl=vExt.x<1.;vec4 tc=texture(uTex,vTCrd);vec2 tCrd=vTCrd*uS.xy,tCnt=vCrd.zw*uS.xy;float alp=tc.a,shn=1.+tc.b,ph=tc.g*vSC,pxDst=distance(vec3(tCnt,vHS),vec3(tCrd,ph)),dst=pxDst/vD,vol=1.-(isl?dst:0.);if(!isl||dst<1.){float shl=vD/vDt.y;if(isl&&vSpt>0.&&vSpt<PI){float slh=(vHS-ph)/100.;vec2 sl=vec2(slh*vSln.y-vCrd.x*vSln.x,slh*vSln.x+vCrd.x*vSln.y);vol*=(atan(sl.x,length(vec2(sl.y,vCrd.y)))+PIH)-vSpt;}int flg=int(vExt.y);float fltDst=distance(tCnt,tCrd),mh=ph-vHS,pc;vec2 dsth=vec2(tCrd.x-tCnt.x,tCrd.y-tCnt.y)/fltDst,p;float dsthL=length(dsth);if((flg&2)>0&&alp>0.&&vol>0.){p=tCrd-dsth;float pl=fltDst-dsthL;pc=vHS+(pl/fltDst)*mh;tc=texture(uTex,p*uS.zw);float h=tc.g*vSC,mtp=clamp(0.,1.,pc-h);shn+=1.-mtp;vol*=((atan(vHS-h,pl)+atan(ph-h,dsthL))/PI)+mtp;}vol*=shn;if((flg&1)>0&&vol>0.){float st=max(ceil(fltDst/128.),vExt.w),hst=mh/fltDst,l=fltDst-2.*st,s=max(0.,l-shl)+st;for(float i=l;i>s;i-=st){p=tCnt+i*dsth;pc=vHS+i*hst;tc=texture(uTex,p*uS.zw);tc.rg*=vSC;if(tc.r<=pc&&tc.g>=pc){vol*=clamp(0.,1.,distance(tCrd,p)/shl);break;}}}}oCl=vec4(vCl.rgb*vol*vDt.z*vCl.a,1);}}"}};AGL.Stage2D=class extends AGL[$[129]]{constructor(h){h=$o.assign({useTint:!0},h||{});h[$[8]]=AGL.Utils[$[54]](h[$[8]],AGL.Stage2D);h[$[8]][$[15]]=h[$[8]][$[15]].concat(["aDt","aDst","uWCl","uWA"]);const n=h[$[59]]=h[$[59]]||1e4;super(h);this[$[94]]=new AGL.StageContainer(this);this[$[35]]=0;this[$[46]]={};this[$[46]][AGL.Item.TYPE]=emptyFunction;this[$[46]][AGL.Image.TYPE]=this._drawImage.bind(this);this[$[46]][AGL.Container.TYPE]=this._drawContainer.bind(this);this[$[108]]=this._batchDraw.bind(this);this._drawItemBound=this._drawItem.bind(this);this[$[106]]=AGL.Point.create();this[$[24]]=new AGL.Buffer("aDt",n,3,4);this[$[56]]=new AGL.Buffer("aDst",n,4,2)};get container(){return this[$[94]]};render(){this.picked=$n;super.render();this[$[135]]=!1};setPickerPoint(f){this[$[135]]=!0;this[$[106]].x=(f.x-this.widthHalf)*this[$[12]][0];this[$[106]].y=(f.y-this.heightHalf)*this[$[12]][4]};_render(){this._drawItem(this[$[94]]);this._batchDraw()};_drawItem(b){b.update(this[$[34]]);b.callback(b,this[$[34]]);b.renderable&&this[$[46]][b.TYPE](b)};_drawContainer(l){this._gl.uniform4fv(this[$[7]].uWCl,l[$[53]]);this._gl.uniform1f(this[$[7]].uWA,l[$[36]]);const k=l[$[26]];for(let i=0,l=k.length;i<l;++i)this._drawItem(k[i])};_drawImage(b){this[$[5]][$[137]](b.blendMode,this[$[108]]);if(this[$[135]]&&b.interactive&&b.isContainsPoint(this[$[106]]))this.picked=b;const c=this[$[35]]*12;const g=this[$[35]]*16;_[$[31]](this[$[24]].data,b[$[53]],c);_[$[31]](this[$[24]].data,b[$[105]],c+8);this[$[24]].data[c+4]=b.props.alpha;this[$[24]].data[c+5]=b.tintType;this[$[24]].data[c+6]=this[$[5]][$[120]](b[$[57]],this[$[34]],!1,this[$[108]]);this[$[24]].data[c+7]=b[$[111]].distortTexture;_[$[31]](this[$[33]].data,b[$[12]],g);_[$[31]](this[$[33]].data,b[$[88]],g+6);_[$[31]](this[$[33]].data,b[$[149]],g+12);_[$[31]](this[$[56]].data,b[$[130]],this[$[35]]*8);++this[$[35]]===this[$[103]]&&this._batchDraw()};_batchDraw(){if(this[$[35]]>0){this[$[39]]();this._gl.uniform1iv(this[$[7]].uTex,this[$[5]][$[93]]);this[$[119]](this[$[35]]);this[$[35]]=0}};_customResize(){AGL.Matrix3.projection(this[$[2]],this[$[1]],this[$[94]].parent[$[12]]);++this[$[94]].parent[$[14]]};_uploadBuffers(){this[$[24]].upload(this._gl,this[$[17]],this[$[7]]);this[$[56]].upload(this._gl,this[$[17]],this[$[7]]);super[$[39]]()};_createBuffers(){super[$[78]]();this[$[24]].create(this._gl);this[$[56]].create(this._gl)};_createVertexShader(h){const p=h[$[145]];return AGL.Utils[$[32]](h[$[8]][$[48]])+"in vec2 aPos;in mat4x2 aDst;in mat3x4 aDt;in mat4 aMt;uniform float uFlpY,uWA;uniform vec4 uWCl;out float vACl,vTexId,vTTp;out vec2 vTCrd;out vec4 vTexCrop;out mat2x4 vCl;"+(p?"out vec4 vRR;":"")+"vec2 clcQd(vec2 p){vec2 o=1.-p;vec4 cmt=vec4(o.y*aDst[0].x+p.y*aDst[3].x,o.x*aDst[0].y+p.x*aDst[1].y,o.y*aDst[1].x+p.y*aDst[2].x,o.x*aDst[3].y+p.x*aDst[2].y);return vec2(o.x*cmt.x+p.x*cmt.z,o.y*cmt.y+p.y*cmt.w);}void main(void){mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1),tMt=mat3(aMt[1].zw,0,aMt[2].xy,0,aMt[2].zw,1);vec3 tPos=vec3(clcQd(aPos),1);gl_Position=vec4(mt*tPos,1);gl_Position.y*=uFlpY;float dt=aDt[1].w;vTCrd=(tMt*((dt*vec3(aPos,1))+((1.-dt)*tPos))).xy;vTexCrop=aMt[3];vCl=mat2x4(uWCl,aDt[0].rgb*aDt[0].a,1.-aDt[0].a);vACl=uWA*aDt[1].x;vTTp=aDt[1].y;vTexId=aDt[1].z;"+(p?"vRR=aDt[2].xyzw;vRR.w=vRR.x+vRR.y;":"")+"}"};_createFragmentShader(h){const r=AGL.Utils.INFO[$[76]];const p=h[$[145]];const j=h.useTint;const s=(r)=>{let d="vec4 gtTexCl(float i,vec2 c){";for(let i=0;i<r;++i)d+="if(i<"+(i+1)+".)return texture(uTex["+i+"],c);";d+="return vec4(1);}";return d};const q=(m)=>"gtTexCl(vTexId,vTexCrop.xy+vTexCrop.zw*"+m+")";return AGL.Utils[$[32]](h[$[8]][$[48]])+"in float vACl,vTexId,vTTp;in vec2 vTCrd;in vec4 vTexCrop;in mat2x4 vCl;"+(p?"in vec4 vRR;":"")+"uniform sampler2D uTex["+r+"];out vec4 oCl;"+s(r)+(p?AGL.Utils.GLSL_RANDOM+"vec4 gtClBCrd(vec2 st){vec2 tCrd=vTCrd;float rnd=rand(floor(tCrd+st),1.),rndDg=rnd*360.*vRR.x;if(rndDg>0.){vec2 rt=vec2(sin(rndDg),cos(rndDg));tCrd=vec2(tCrd.x*rt.y-tCrd.y*rt.x,tCrd.x*rt.x+tCrd.y*rt.y);}return "+q("mod(tCrd,1.)")+";}float gtRClBCrd(vec2 st,vec2 crd){float rnd=rand(floor(vTCrd+st),1.);return (1.-(2.*rnd-1.)*vRR.y)*abs((1.-st.x-crd.x)*(1.-st.y-crd.y));}":"")+"void main(void){if(vTexId>-1.){vec2 crd=mod(vTCrd,1.);"+(p?"if(vRR.w>0.){vec2 zr=vec2(0,1);oCl=vRR.z>0.?(gtClBCrd(zr.xx)+gtClBCrd(zr.yx)+gtClBCrd(zr.xy)+gtClBCrd(zr.yy))/vec4(4):gtClBCrd(zr);if(vRR.y>0.)oCl.rgb*=(gtRClBCrd(zr.xx,crd)+gtRClBCrd(zr.yx,crd)+gtRClBCrd(zr.xy,crd)+gtRClBCrd(zr.yy,crd));}else oCl="+q("crd")+";":"oCl="+q("crd")+";")+"}else oCl+=1.;oCl.a*=vACl;if(oCl.a<=0.)discard;"+(j?"if(vTTp>0.){vec3 cl=vCl[1].rgb+oCl.rgb*vCl[1].a;if(vTTp<2.||(vTTp<3.&&oCl.r==oCl.g&&oCl.r==oCl.b))oCl.rgb*=cl;else if(vTTp<4.)oCl.rgb=cl;}":"")+"oCl*=vCl[0];}"}};AGL[$[3]]=class{constructor(b,c,d){this.TYPE=b;this.SUB_TYPE=c;this.on=!0;this.v=new F32A(9);this.kernels=new F32A(16);this.intensity=d||0};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v};get intensityX(){return this.v[0]};set intensityX(v){this.v[0]=v};get intensityY(){return this.v[1]};set intensityY(v){this.v[1]=v};get r(){return this.v[2]};set r(v){this.v[2]=v};get g(){return this.v[3]};set g(v){this.v[3]=v};get b(){return this.v[4]};set b(v){this.v[4]=v}};AGL.DisplacementFilter=class extends AGL[$[3]]{constructor(d,f,h,j,b,c,g,k){super(6,0,f);this[$[38]]=new AGL[$[85]](this,d,h,j,b,c,g,k)}};AGL.MaskFilter=class extends AGL[$[3]]{constructor(f,b,h,j,c,d,g,k){super(7,0,b);this[$[38]]=new AGL[$[85]](this,f,h,j,c,d,g,k)};get type(){return this.v[0]};set type(v){this.v[0]=v}};AGL.MaskFilter.Type={RED:0,GREEN:1,BLUE:2,ALPHA:3,AVG:4};AGL.PixelateFilter=AGL[$[3]].bind({},5,0);AGL.EdgeDetectFilter=class extends AGL[$[3]]{constructor(b){super(1,0,b);_[$[31]](this.kernels,[-1,-1,-1,-1,8,-1,-1,-1,-1],0)}};AGL.SharpenFilter=class extends AGL[$[3]]{constructor(b){super(1,0,b);_[$[31]](this.kernels,[-1,-1,-1,-1,16,-1,-1,-1,-1],0)}};AGL.SaturateFilter=class extends AGL[$[3]]{constructor(b){super(2,0,b)};set intensity(v){this.v[0]=v;const x=(v*2/3)+1;const y=((x-1)*-.5);_[$[31]](this.kernels,[x,y,y,0,y,x,y,0,y,y,x,0],0)}};AGL.GrayscaleFilter=AGL[$[3]].bind({},3,1);AGL.SepiaFilter=AGL[$[3]].bind({},3,2);AGL.InvertFilter=AGL[$[3]].bind({},3,3);AGL.TintFilter=class extends AGL[$[3]]{constructor(c,r,g,b){super(3,4,c);this.r=r;this.g=g;this.b=b}};AGL.ColorLimitFilter=AGL[$[3]].bind({},3,5);AGL.VignetteFilter=class extends AGL[$[3]]{constructor(c,d,f,r,g,b){super(3,6,c);this.roundness=d;this.transition=f;this.r=r;this.g=g;this.b=b};get roundness(){return this.v[1]};set roundness(v){this.v[1]=v};get transition(){return 1/this.v[5]};set transition(v){this.v[5]=1/v}};AGL.RainbowFilter=AGL[$[3]].bind({},3,7);AGL.BrightnessContrastFilter=class extends AGL[$[3]]{constructor(c,b){super(3,8,c);this.contrast=b};get brightness(){return this.v[0]};set brightness(v){this.v[0]=v};get contrast(){return this.v[1]};set contrast(v){this.v[1]=v}};AGL.GammaFilter=AGL[$[3]].bind({},3,9);AGL.BlurFilter=class extends AGL[$[3]]{constructor(b,c){super(4,1,b);this.intensityY=c}};AGL.GlowFilter=class extends AGL[$[3]]{constructor(c,d,b){super(4,2,c);this.intensityY=d;this.volume=b};get volume(){return this.v[3]};set volume(v){this.v[3]=v}};}).call({});