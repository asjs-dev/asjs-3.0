(function(){var $=['_currentScaledHeightUpdateId','_currentSinRotationUpdateId','_currentScaledWidthUpdateId','_currentCosRotationUpdateId','_currentWorldColorUpdateId','_currentWorldPropsUpdateId','_textureIdBufferUpdated','enableVertexAttribArray','_clearBeforeRenderFunc','_currentResizeUpdateId','_sourceHeightProperty','_scaledHeightUpdateId','maxTextureImageUnits','ELEMENT_ARRAY_BUFFER','ONE_MINUS_SRC_ALPHA','createFragmentShader','_textureMatrixBuffer','_scaledWidthUpdateId','_onTextureLoadedBind','_sourceWidthProperty','ONE_MINUS_SRC_COLOR','AbstractColorFilter','_updateTextureProps','_framebufferTexture','getUniformLocation','vertexAttribPointer','createFunctionality','removeEventListener','_collectLightsFunc','_tempInverseMatrix','createVertexShader','getAttribLocation','_createArrayBuffer','worldColorUpdateId','_attachArrayBuffer','worldPropsUpdateId','_currentRenderTime','_clearBeforeRender','_textureCropBuffer','_textureMatrixData','loadFragmentShader','TEXTURE_MIN_FILTER','_worldMatrixBuffer','textureMatrixCache','TEXTURE_MAG_FILTER','_rotationUpdateId','_parseTextureSize','_tempPickerVector','contextAttributes','_currentBlendMode','updateFramebuffer','_onTextureLoaded','loadVertexShader','addEventListener','COLOR_BUFFER_BIT','_tintColorBuffer','_textureIdBuffer','_bindArrayBuffer','_setMaskDataFunc','textureCropCache','_textureCropData','_worldMatrixData','_drawFunctionMap','_currentUpdateId','LightEffectProps','_lightPositions','_generateMipmap','getLocationsFor','bindFramebuffer','_resizeUpdateId','_checkBlendMode','SimpleRenderer','_textureIdData','_setBufferData','generateMipmap','_transformItem','_lightZIndices','_drawContainer','RendererHelper','fragmentShader','_getSourceType','PostProcessing','AbstractFilter','_zIndexCounter','_tintColorData','isLightEnabled','hasOwnProperty','_effectLength','AbstractProps','isMaskEnabled','_scaledHeight','_setBlendMode','createElement','_resizeCanvas','_lightVolumes','_lightEffects','createProgram','texParameteri','getChildIndex','CLAMP_TO_EDGE','setChildIndex','_drawTexture','_updateColor','ARRAY_BUFFER','_lightColors','_updateProps','_bindBuffers','_framebuffer','_isPickerSet','createBuffer','_sinRotation','vertexShader','_cosRotation','BaseRenderer','TRIANGLE_FAN','getParameter','MaskRenderer','_effectData','bindTexture','_matrixData','_renderTime','FRAMEBUFFER','STATIC_DRAW','matrixCache','_batchItems','removeChild','_textureMap','_textureIds','_batchDraw','_locations','clearColor','textureNum','colorCache','bindBuffer','bufferData','TEXTURE_2D','_eventType','isUpdated','_rotation','locations','uniform1i','lightNum'];"use strict";var addUniqueToArray=function(array,item){array.indexOf(item)==-1&&array.push(item)};var inArray=function(array,item){return array.indexOf(item)>-1};var removeFromArray=function(array,item){var a=array.indexOf(item);a>-1&&array.splice(a,1)};var cloneArray=function(array){return array.slice(0)};var areArraysEqual=function(arrayA,arrayB){if(!arrayA||arrayA.length!==arrayB.length)return!1;for(var i=0;i<arrayB.length;i++){if(arrayB[i]!==arr[i])return!1};return!0};var arraySet=function(target,source,from){var i=0;var l=source.length;while(i<l){target[from+i]=source[i];++i}};var property=function(t,n,v){v.enumerable=!0;v.configurable=!0;Object.defineProperty(t,n,v)};var prop=property;var get=function(t,n,v){prop(t,n,{get:v})};var set=function(t,n,v){prop(t,n,{set:v})};var constant=function(t,n,v){prop(t,n,{value:v})};var cnst=constant;var empty=function(a){try{return a===undefined||a===null||a===""||a.length===0}catch(e){return!0}};var emp=empty;var map=function(o,cb){for(var k in o){if(!o[$[86]](k))continue;var v=cb(k,o[k]);if(!emp(v))o[k]=v}};var emptyFunction=function(){};var empfu=emptyFunction;var iterateOver=function(o,cb,ccb){if(emp(o))return b();var a=Object.keys(o);var k;var i=-1;function b(){ccb&&ccb()};function n(){i++;if(i===a.length){b();return};k=a[i];if(o[$[86]]&&!o[$[86]](k))n();var c;try{c=o[k]}catch(e){};var v=cb(k,c,n,b);if(!emp(v))o[k]=v};n()};var ito=iterateOver;var createPrototypeClass=function(parent,construct,body){var a=parent.prototype;var b=construct.prototype;Object.setPrototypeOf(construct,parent);Object.setPrototypeOf(b,a);b.constructor=construct;body&&body.call(b,a);return construct};var c4=createPrototypeClass;var deleteProperty=function(t,p){var a=Object.getOwnPropertyDescriptor(t,p);if(a&&(a.get||a.set))prop(t,p,{set:empfu,get:empfu});else{try{t[p]=null}catch(e){}};delete t[p]};var del=deleteProperty;var destructObjectFlat=function(t,stack){ito(t,function(a,b,c){del(t,a);c()});t=null};var destObjFlat=destructObjectFlat;var BasePrototypeClass=c4(Object,function a(){},function(){this.destruct=function(){destObjFlat(this)};this.toObject=function(){return JSON.parse(JSON.stringify(this))}});console.log("AGL 1.0");window.AGL={};AGL.CreateConfig=function(options){var b="Maximum of ";if(options[$[131]]===undefined||options[$[131]]>AGL.Utils.info[$[12]])options[$[131]]=AGL.Utils.info[$[12]];if(options[$[141]]===undefined)options[$[141]]=0;else if(options[$[141]]>16)options[$[141]]=16;var a=options[$[48]]||{};return{"canvas":options.canvas,"locations":options[$[139]]||{},"textureNum":options[$[131]],"lightNum":options[$[141]],"isLightEnabled":options[$[141]]>0,"isMaskEnabled":options[$[89]],"vertexShader":options[$[111]],"fragmentShader":options[$[79]],"contextAttributes":{"alpha":a.alpha||!1,"antialias":a.antialias||!1,"depth":a.depth||!1,"stencil":a.stencil||!1,"premultipliedAlpha":a.premultipliedAlpha||!1,"powerPreference":a.powerPreference||"high-performance"}}};(function(){function b(a){return{"funcName":"blendFunc"+(a.length===2?"":"Separate"),"funcs":a}};AGL.BlendModes={"NORMAL":b(["SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","ONE_MINUS_SRC_ALPHA"]),"ADD":b(["SRC_ALPHA","DST_ALPHA","ONE","DST_ALPHA"]),"MULTIPLY":b(["DST_COLOR","ONE_MINUS_SRC_ALPHA"]),"SCREEN":b(["SRC_ALPHA","ONE_MINUS_SRC_COLOR","ONE","ONE_MINUS_SRC_COLOR"]),"OVERLAY":b(["ONE","ONE_MINUS_SRC_ALPHA"])};Object.freeze(AGL.BlendModes)})();AGL[$[88]]=c4(BasePrototypeClass,function b(){BasePrototypeClass.call(this);this._id=this[$[63]]=-1},function(){this[$[137]]=function(){var a=this[$[63]]<this._id;this[$[63]]=this._id;return a}});AGL.ColorProps=c4(AGL[$[88]],function a(){AGL[$[88]].call(this);this.items=[1,1,1,1]},function(){prop(this,"r",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;++this._id}}});prop(this,"g",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;++this._id}}});prop(this,"b",{get:function(){return this.items[2]},set:function(v){if(this.items[2]!==v){this.items[2]=v;++this._id}}});prop(this,"a",{get:function(){return this.items[3]},set:function(v){if(this.items[3]!==v){this.items[3]=v;++this._id}}})});AGL.ItemProps=c4(AGL[$[88]],function a(){AGL[$[88]].call(this);this[$[17]]=this[$[2]]=this[$[11]]=this[$[0]]=this[$[45]]=this[$[1]]=this[$[3]]=0;this._scaledWidth=this[$[90]]=1;this[$[110]]=0;this[$[112]]=1;this._x=this._y=this._zIndex=this[$[138]]=this._anchorX=this._anchorY=0;this._scaleX=this._scaleY=this._width=this._height=1},function(){get(this,"scaledWidth",function(){if(this[$[2]]!==this[$[17]]){this[$[2]]=this[$[17]];this._scaledWidth=this._width*this._scaleX};return this._scaledWidth});get(this,"scaledHeight",function(){if(this[$[0]]!==this[$[11]]){this[$[0]]=this[$[11]];this[$[90]]=this._height*this._scaleY};return this[$[90]]});get(this,"sinR",function(){if(this[$[1]]!==this[$[45]]){this[$[1]]=this[$[45]];this[$[110]]=Math.sin(this[$[138]])};return this[$[110]]});get(this,"cosR",function(){if(this[$[3]]!==this[$[45]]){this[$[3]]=this[$[45]];this[$[112]]=Math.cos(this[$[138]])};return this[$[112]]});prop(this,"x",{get:function(){return this._x},set:function(v){if(this._x!==v){this._x=v;++this._id}}});prop(this,"y",{get:function(){return this._y},set:function(v){if(this._y!==v){this._y=v;++this._id}}});prop(this,"zIndex",{get:function(){return this._zIndex},set:function(v){this._zIndex!==v&&(this._zIndex=v)}});prop(this,"rotation",{get:function(){return this[$[138]]},set:function(v){if(this[$[138]]!==v){this[$[138]]=v;++this[$[45]];++this._id}}});prop(this,"scaleX",{get:function(){return this._scaleX},set:function(v){if(this._scaleX!==v){this._scaleX=v;++this[$[17]];++this._id}}});prop(this,"scaleY",{get:function(){return this._scaleY},set:function(v){if(this._scaleY!==v){this._scaleY=v;++this[$[11]];++this._id}}});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;++this[$[17]];++this._id}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;++this[$[11]];++this._id}}});prop(this,"anchorX",{get:function(){return this._anchorX},set:function(v){if(this._anchorX!==v){this._anchorX=v;++this._id}}});prop(this,"anchorY",{get:function(){return this._anchorY},set:function(v){if(this._anchorY!==v){this._anchorY=v;++this._id}}})});AGL[$[64]]=c4(AGL[$[88]],function a(){AGL[$[88]].call(this);this.items=[0,0,2,2]},function(){prop(this,"anchorX",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;++this._id}}});prop(this,"anchorY",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;++this._id}}});prop(this,"quadX",{get:function(){return this.items[2]},set:function(v){if(this.items[2]!==v){this.items[2]=v;++this._id}}});prop(this,"quadY",{get:function(){return this.items[3]},set:function(v){if(this.items[3]!==v){this.items[3]=v;++this._id}}})});AGL.TextureCrop=c4(AGL[$[88]],function a(){AGL[$[88]].call(this);this.items=[0,0,1,1];this._width=this._height=1},function(){prop(this,"x",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;this._calcWidth();++this._id}}});prop(this,"y",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;this._calcHeight();++this._id}}});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;this._calcWidth();++this._id}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;this._calcHeight();++this._id}}});this._calcWidth=function(){this.items[2]=this._width-this.items[0]};this._calcHeight=function(){this.items[3]=this._height-this.items[1]}});AGL.TextureProps=c4(AGL[$[88]],function a(){AGL[$[88]].call(this);this[$[45]]=this[$[1]]=this[$[3]]=0;this[$[110]]=0;this[$[112]]=1;this._x=this._y=this[$[138]]=this._anchorX=this._anchorY=0;this._width=this._height=1},function(){get(this,"scaledWidth",function(){return this._width});get(this,"scaledHeight",function(){return this._height});get(this,"sinR",function(){if(this[$[1]]!==this[$[45]]){this[$[1]]=this[$[45]];this[$[110]]=Math.sin(this[$[138]])};return this[$[110]]});get(this,"cosR",function(){if(this[$[3]]!==this[$[45]]){this[$[3]]=this[$[45]];this[$[112]]=Math.cos(this[$[138]])};return this[$[112]]});prop(this,"x",{get:function(){return this._x},set:function(v){if(this._x!==v){this._x=v;++this._id}}});prop(this,"y",{get:function(){return this._y},set:function(v){if(this._y!==v){this._y=v;++this._id}}});prop(this,"rotation",{get:function(){return this[$[138]]},set:function(v){if(this[$[138]]!==v){this[$[138]]=v;++this[$[45]];++this._id}}});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;++this._id}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;++this._id}}});prop(this,"anchorX",{get:function(){return this._anchorX},set:function(v){if(this._anchorX!==v){this._anchorX=v;++this._id}}});prop(this,"anchorY",{get:function(){return this._anchorY},set:function(v){if(this._anchorY!==v){this._anchorY=v;++this._id}}})});AGL.Matrix3={isPointInMatrix:function(j,b,a,l,o){l[0]=b[0]*a[0]+b[3]*a[1];l[1]=b[1]*a[0]+b[4]*a[1];l[2]=b[0]*a[3]+b[3]*a[4];l[3]=b[1]*a[3]+b[4]*a[4];l[4]=b[0]*a[6]+b[3]*a[7]+b[6];l[5]=b[1]*a[6]+b[4]*a[7]+b[7];var d=1/(l[0]*l[3]-l[2]*l[1]);o[0]=d*l[3];o[1]=-d*l[1];o[2]=-d*l[2];o[3]=d*l[0];o[4]=d*(l[2]*l[5]-l[3]*l[4]);o[5]=-d*(l[0]*l[5]-l[1]*l[4]);var x=j[0]*o[0]+j[1]*o[2]+o[4];var y=j[0]*o[1]+j[1]*o[3]+o[5];return x>=0&&y>=0&&x<=1&&y<=1},identity:function(){return new Float32Array([1,0,0,0,1,0,0,0,1,])},projection:function(n,p,k){k[0]=2/n;k[1]=0;k[2]=0;k[3]=0;k[4]=-2/p;k[5]=0;k[6]=-1;k[7]=1;k[8]=1},transformLocal:function(x,y,c,e,f,g,h,i,k){k[0]=e*h;k[1]=c*h;k[3]=-c*i;k[4]=e*i;k[6]=x-(f*k[0])-(g*k[3]);k[7]=y-(f*k[1])-(g*k[4])},transform:function(m,x,y,c,e,f,g,h,i,k){k[0]=(e*m[0])+(c*m[3]);k[1]=(e*m[1])+(c*m[4]);k[3]=(e*m[3])-(c*m[0]);k[4]=(e*m[4])-(c*m[1]);k[6]=-(f*k[0])-(g*k[3])+(x*m[0])+(y*m[3])+m[6];k[7]=-(f*k[1])-(g*k[4])+(x*m[1])+(y*m[4])+m[7];k[0]*=h;k[1]*=h;k[3]*=i;k[4]*=i}};Object.freeze(AGL.Matrix3);(function(){var c=c4(BasePrototypeClass,function c(){BasePrototypeClass.call(this);this.info={"isWebGl2Supported":!1};var h=document[$[92]]("canvas");var a;if(a=h.getContext("webgl2")){this.info.isWebGl2Supported=!0;this.info[$[12]]=a[$[115]](a.MAX_TEXTURE_IMAGE_UNITS);this.info.maxTextureSize=a[$[115]](a.MAX_TEXTURE_SIZE);this.info.maxVertexAttributes=a[$[115]](a.MAX_VERTEX_ATTRIBS);this.info.maxVaryingVectors=a[$[115]](a.MAX_VARYING_VECTORS);this.info.maxVertexUniformVectors=a[$[115]](a.MAX_VERTEX_UNIFORM_VECTORS);this.info.maxFragmentUniformComponents=a[$[115]](a.MAX_FRAGMENT_UNIFORM_COMPONENTS);this.info.maxFragmentUniformVectors=a[$[115]](a.MAX_FRAGMENT_UNIFORM_VECTORS);this.info.maxVaryingComponents=a[$[115]](a.MAX_VARYING_COMPONENTS)}},function(){this.useTexture=function(a,e,q){a.activeTexture(a.TEXTURE0+e);a[$[118]](q.target,q.texture);a.texImage2D(q.target,0,a.RGBA,q.width,q.height,0,a.RGBA,a.UNSIGNED_BYTE,q.source);a[$[97]](q.target,a.TEXTURE_MAX_LEVEL,q.maxLevel);if(q[$[74]]){a[$[74]](q.target);a.flush()};a[$[97]](q.target,a.TEXTURE_WRAP_S,q.wrapS);a[$[97]](q.target,a.TEXTURE_WRAP_T,q.wrapT);if(q[$[74]]){a[$[97]](q.target,a[$[41]],q.minFilter===a.LINEAR?a.LINEAR_MIPMAP_LINEAR:a.NEAREST_MIPMAP_NEAREST)}else{a[$[97]](q.target,a[$[41]],q.minFilter)};a[$[97]](q.target,a[$[41]],q.minFilter);a[$[97]](q.target,a[$[44]],q.magFilter)};this.loadShader=function(p,a,s){var g=a.createShader(a[p]);a.shaderSource(g,s);a.compileShader(g);var m=a.getShaderParameter(g,a.COMPILE_STATUS);if(!m){var n=a.getShaderInfoLog(g);console.log("Error compiling shader "+p+":"+n);a.deleteShader(g);return null};return g};this[$[52]]=this.loadShader.bind(this,"VERTEX_SHADER");this[$[40]]=this.loadShader.bind(this,"FRAGMENT_SHADER");this[$[96]]=function(a,l,r,t){var j=a[$[96]]();map(l,function(b,g){a.attachShader(j,g)});if(r){map(r,function(b,i){a.bindAttribLocation(j,t?t[b]:b,i)})};a.linkProgram(j);var f=a.getProgramParameter(j,a.LINK_STATUS);if(!f){var n=a.getProgramInfoLog(j);console.log("Error in program linking:"+n);a.deleteProgram(j);return null};a.flush();return j};this[$[67]]=function(a,j,v){var o={};map(v,function(b,u){o[b]=a[u](j,b)});return o};this.unbindTexture=function(a,k){a[$[118]](k.target,null)};this.destroyTexture=function(a,k){a[$[118]](k.target,null);a.deleteTexture(k.texture)};this.isPowerOf2=function(d){return(d&(d-1))==0}});AGL.Utils=new c();Object.freeze(AGL.Utils)})();AGL.Texture=c4(BasePrototypeClass,function f(a,d){BasePrototypeClass.call(this);this._source;this[$[18]]=this[$[51]].bind(this);this[$[66]]=!1;this._loaded=!1;this.isVideo=!1;this.shouldUpdate=!1;this.texture=a.createTexture();this.maxLevel=10;this.target=a[$[135]];this.wrapS=a[$[99]];this.wrapT=a[$[99]];this.minFilter=a.NEAREST;this.magFilter=a.NEAREST;this.source=d;this[$[19]]="width";this[$[10]]="height";this[$[36]]=-1;this[$[136]]},function(e){get(this,"generateMipmap",function(){return this[$[66]]});get(this,"loaded",function(){return this._loaded});get(this,"width",function(){return this._source[this[$[19]]]});get(this,"height",function(){return this._source[this[$[10]]]});prop(this,"source",{get:function(){return this._source},set:function(v){this._source&&this._source[$[27]](this[$[136]],this[$[18]]);this._source=v;this.isVideo=this[$[80]]()==="video";this[$[136]]=this.isVideo?"canplay":"load";this[$[46]]();this._source[$[53]](this[$[136]],this[$[18]])}});this.autoUpdate=function(h){var i=this[$[36]]<h;this[$[36]]=h;return i&&(this.shouldUpdate||(this.isVideo&&!this._source.paused))};this.destruct=function(){this._source&&this._source[$[27]](this[$[136]],this[$[18]]);e.destruct.call(this)};this[$[46]]=function(){this[$[19]]="naturalWidth";this[$[10]]="naturalHeight";if(!this._source[this[$[19]]]){this[$[19]]="videoWidth";this[$[10]]="videoHeight"};if(!this._source[this[$[19]]]){this[$[19]]="width";this[$[10]]="height"};this[$[66]]=AGL.Utils.isPowerOf2(this.width)&&AGL.Utils.isPowerOf2(this.height);this._loaded=this[$[80]]()==="canvas"||this.width>0&&this.height>0};this[$[80]]=function(){return this._source.tagName.toLowerCase()};this[$[51]]=this[$[46]]});AGL.Texture.loadImage=function(a,src){var b=document[$[92]]("img");var g=new AGL.Texture(a,b);b.src=src;return g};AGL.Texture.loadVideo=function(a,src){var c=document[$[92]]("video");var g=new AGL.Texture(a,c);c.src=src;return g};AGL.Item=c4(BasePrototypeClass,function a(){BasePrototypeClass.call(this);cnst(this,"type","item");this.renderable=!0;this.interactive=!1;this[$[123]]=AGL.Matrix3.identity();this.props=new AGL.ItemProps();this.color=new AGL.ColorProps();this[$[132]]=this.color.items;this.parent=null},function(c){get(this,"stage",function(){return this.parent?this.parent.stage:null});this.destruct=function(){this.parent&&this.parent[$[125]]&&this.parent[$[125]](this);c.destruct.call(this)};this.update=function(e,d){this[$[105]](d)};this[$[105]]=function(d){var b=this.props;b[$[137]]()&&this[$[75]](b,d)};this[$[75]]=function(b,d){AGL.Matrix3.transform(d[$[123]],b.x,b.y,b.sinR,b.cosR,b.anchorX,b.anchorY,b.scaledWidth,b.scaledHeight,this[$[123]])}});cnst(AGL.Item,"TYPE","item");AGL.Light=c4(AGL.Item,function b(a,i,f,e,g,h){AGL.Item.call(this);this.effect=new AGL[$[64]]();this.effectCache=this.effect.items;this.color.a=0;this._on=!1;this[$[5]]=-1;this._id=a;this._duoId=a*2;this._quadId=a*4;this[$[65]]=i;this[$[94]]=f;this[$[104]]=e;this[$[95]]=g;this[$[76]]=h},function(){prop(this,"on",{get:function(){return this._on&&this.stage},set:function(v){this._on=v}});this[$[105]]=function(d){var c=this.props;if(this[$[5]]<d[$[35]]||c[$[137]]()){if(this.on){this[$[5]]=d[$[35]];this[$[75]](c,d);this[$[65]][this._duoId]=this[$[123]][6];this[$[65]][this._duoId+1]=this[$[123]][7];this[$[94]][this._duoId]=1/Math.abs(this[$[123]][0]);this[$[94]][this._duoId+1]=1/Math.abs(this[$[123]][4]);this[$[76]][this._id]=this.props.zIndex;arraySet(this[$[104]],this[$[132]],this._quadId);arraySet(this[$[95]],this.effectCache,this._quadId)}else this[$[104]][this._quadId+3]=0}}});AGL.Image=c4(AGL.Item,function a(d){AGL.Item.call(this);cnst(this,"type","drawable");this[$[43]]=AGL.Matrix3.identity();this.mask=null;this.tintType=AGL.Image.Tint.NORMAL;this.blendMode=AGL.BlendModes.NORMAL;this.textureProps=new AGL.TextureProps();this.textureCrop=new AGL.TextureCrop();this[$[59]]=this.textureCrop.items;this.texture=d},function(){this.mouseOver=function(){};this.update=function(){this[$[105]]();this[$[22]]()};this[$[105]]=function(){var b=this.props;b[$[137]]()&&this[$[75]](b,this[$[123]])};this[$[22]]=function(){var e=this.textureProps;e[$[137]]()&&this[$[75]](e,this[$[43]])};this[$[75]]=function(b,c){AGL.Matrix3.transformLocal(b.x,b.y,b.sinR,b.cosR,b.anchorX,b.anchorY,b.scaledWidth,b.scaledHeight,c)}});cnst(AGL.Image,"TYPE","drawable");cnst(AGL.Image,"Tint",{"NORMAL":0,"GRAYSCALE":1,"OVERRIDE":2,});AGL.AnimatedImage=c4(AGL.Image,function g(c){AGL.Image.call(this,c);this.frameLength=120;this.frame=0;this.frames=[];this.isPlaying=!1;this[$[36]]=0},function(b){this.gotoAndStop=function(a){this.frame=a};this.gotoAndPlay=function(a){this.frame=a;this.play()};this.stop=function(){this.isPlaying=!1};this.play=function(){this.isPlaying=!0};this.update=function(d){this.updateAnimation(d);b.update.call(this)};this.updateAnimation=function(d){if(this.isPlaying){var f=d-this[$[36]];if(f>=this.frameLength){this[$[36]]=d;this.frame+=Math.floor(f/this.frameLength);this.frame>=this.frames.length&&(this.frame=0);var h=this.frames[this.frame];var e=this.textureCrop;e.x=h.x;e.y=h.y;e.width=h.width;e.height=h.height}}};this.destruct=function(){this.stop();b.destruct.call(this)}});AGL.Container=c4(AGL.Item,function h(){AGL.Item.call(this);cnst(this,"type","container");this.children=[];this[$[35]]=this[$[33]]=0;this[$[132]]=[1,1,1,1];this[$[5]]=this[$[4]]=0},function(){get(this,"numChildren",function(){return this.children.length});this.clear=function(){while(this.numChildren)this.removeChildAt(0)};this.contains=function(a){return this[$[98]](a)>-1};this.addChild=function(a){return this.addChildAt(a,this.numChildren)};this.addChildAt=function(a,b){if(!a)return null;if(a.parent)a.parent[$[125]](a);this.children.push(a);this[$[100]](a,b);a.parent=this;return a};this[$[125]]=function(a){if(!a||!this.contains(a))return null;removeFromArray(this.children,a);a.parent=null;return a};this.removeChildAt=function(b){return this[$[125]](this.getChildAt(b))};this.getChildAt=function(b){return this.children[b]};this[$[100]]=function(a,b){if(!a||b<0)return null;removeFromArray(this.children,a);this.children.splice(b,0,a);return a};this[$[98]]=function(a){return this.children.indexOf(a)};this.swapChildren=function(e,f){var j=this[$[98]](e);var k=this[$[98]](f);if(j===-1||k===-1)return!1;this[$[100]](e,k);this[$[100]](f,j);return!0};this.update=function(i,g){this[$[105]](g);this[$[102]](g)};this[$[105]]=function(g){var c=this.props;if(this[$[5]]<g[$[35]]||c[$[137]]()){this[$[5]]=g[$[35]];this[$[35]]++;this[$[75]](c,g)}};this[$[102]]=function(g){var d=this.color;if(this[$[4]]<g[$[33]]||d[$[137]]()){this[$[4]]=g[$[33]];this[$[33]]++;var l=g[$[132]];this[$[132]][0]=l[0]*d.r;this[$[132]][1]=l[1]*d.g;this[$[132]][2]=l[2]*d.b;this[$[132]][3]=l[3]*d.a}}});cnst(AGL.Container,"TYPE","container");AGL[$[78]]={"init":function(c){this._width=this._height=0;this[$[69]]=this[$[9]]=0;this._canvas=c;this[$[120]]=0;this._context=null;this._gl=this.context;this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);this._gl.enable(this._gl.BLEND)},"createFunctionality":function(c){get(this,"canvas",function(){return this._canvas});get(this,"context",function(){if(!this._context||(this._context.isContextLost&&this._context.isContextLost())){this._canvas[$[53]]("webglcontextlost",function(a){console.log(a)});this._canvas[$[53]]("webglcontextrestored",function(a){console.log(a)});this._canvas[$[53]]("webglcontextcreationerror",function(a){console.log(a)});this._context=this._canvas.getContext("webgl2",this._config[$[48]])};return this._context});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;this[$[69]]++}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;this[$[69]]++}}});this.setSize=function(b,d){this.width=b;this.height=d};this.render=function(){this._preRender();this._render()};this._preRender=function(){this[$[120]]=Date.now();this._resize()};this._render=function(){};this[$[93]]=function(){if(this[$[69]]===this[$[9]])return!1;this[$[9]]=this[$[69]];this._canvas.width=this._width;this._canvas.height=this._height;this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight);return!0};this._resize=this[$[93]]}};AGL[$[113]]=c4(AGL.Container,function z(k){k[$[111]]=k[$[111]]||AGL[$[113]][$[30]];k[$[79]]=k[$[79]]||AGL[$[113]][$[15]];Object.freeze(k);AGL.Container.call(this);this[$[130]]=new AGL.ColorProps();cnst(this,"_MAX_BATCH_ITEMS",10000);this[$[37]]=!0;this[$[8]]=this.clear.bind(this);this[$[49]]=AGL.BlendModes.NORMAL;this[$[124]]=0;this[$[126]]=[];this[$[127]]=[];this[$[6]]=!1;this._config=k;AGL[$[78]].init.call(this,k.canvas);var q=AGL.Utils[$[96]](this._gl,[AGL.Utils[$[52]](this._gl,k[$[111]](k)),AGL.Utils[$[40]](this._gl,k[$[79]](k))]);this[$[129]]=AGL.Utils[$[67]](this._gl,q,Object.assign(k[$[139]],{"aPos":"getAttribLocation","aMat":"getAttribLocation","aWorldMat":"getAttribLocation","aTexMat":"getAttribLocation","aTexCrop":"getAttribLocation","uTex":"getUniformLocation",}));this._gl.useProgram(q);this[$[91]]();var A=this._gl[$[109]]();this._gl[$[133]](this._gl[$[103]],A);this._gl[$[134]](this._gl[$[103]],new Float32Array([0,0,1,0,1,1,0,1]),this._gl[$[122]]);this._gl[$[25]](this[$[129]]["aPos"],2,this._gl.FLOAT,!1,0,0);this._gl[$[7]](this[$[129]]["aPos"]);var y=this._gl[$[109]]();this._gl[$[133]](this._gl[$[13]],y);this._gl[$[134]](this._gl[$[13]],new Uint16Array([0,1,2,0,2,3]),this._gl[$[122]]);this[$[119]]=new Float32Array(10000*9);this._matrixBuffer=this[$[32]](this[$[119]],"aMat",9,3,3,this._gl.FLOAT,4);this[$[61]]=new Float32Array(10000*9);this[$[42]]=this[$[32]](this[$[119]],"aWorldMat",9,3,3,this._gl.FLOAT,4);this[$[39]]=new Float32Array(10000*9);this[$[16]]=this[$[32]](this[$[39]],"aTexMat",9,3,3,this._gl.FLOAT,4);this[$[60]]=new Float32Array(10000*4);this[$[38]]=this[$[32]](this[$[60]],"aTexCrop",4,1,4,this._gl.FLOAT,4);this[$[62]]={};this[$[62]]["item"]=emptyFunction;this[$[62]]["drawable"]=this._drawImage.bind(this);this[$[62]]["container"]=this[$[77]].bind(this);this._update=this[$[105]]=emptyFunction;this._resize()},function(){AGL[$[78]][$[26]].call(this);prop(this,"clearBeforeRender",{get:function(){return this[$[37]]},set:function(v){this[$[37]]=v;this[$[8]]=v?this.clear.bind(this):emptyFunction}});get(this,"stage",function(){return this});this.clear=function(){var w=this[$[130]];w[$[137]]()&&this._gl[$[130]](w.r,w.g,w.b,w.a);this._gl.clear(this._gl[$[54]])};this._render=function(){this[$[8]]();this[$[77]](this);this[$[124]]>0&&this[$[128]]()};this._drawItem=function(e,n){if(!e.renderable)return;e.update(this[$[120]],n);e.type!=="item"&&this[$[62]][e.type](e,n)};this[$[77]]=function(t){var r=t.children;var i;var l;for(i=0,l=r.length;i<l;++i)this._drawItem(r[i],t)};this[$[70]]=function(e){if(this[$[49]]!==e.blendMode){this[$[128]]();this[$[49]]=e.blendMode;this[$[91]]()}};this[$[73]]=function(e,n,B,g,m){arraySet(this[$[61]],n[$[123]],g);arraySet(this[$[119]],e[$[123]],g);arraySet(this[$[39]],e[$[43]],g);arraySet(this[$[60]],e[$[59]],m)};this._drawImage=function(e,n){this[$[70]](e);var B=this[$[101]](e.texture);this[$[73]](e,n,B,this[$[124]]*9,this[$[124]]*4);++this[$[124]]===10000&&this[$[128]]()};this[$[32]]=function(f,u,o,b,d,c,h){var j=this._gl[$[109]]();this._gl[$[133]](this._gl[$[103]],j);this._gl[$[134]](this._gl[$[103]],f.byteLength,this._gl.DYNAMIC_DRAW);this[$[34]](this[$[129]][u],j,f,o,b,d,c,h);return j};this[$[34]]=function(s,j,f,o,b,d,c,h){this[$[57]](j,f);var p=h*o;var i=b+1;while(--i){var a=s+(b-i);this._gl[$[7]](a);this._gl["vertexAttrib"+(c===this._gl.FLOAT?"":"I")+"Pointer"](a,d,c,!1,p,(b-i)*h*d);this._gl.vertexAttribDivisor(a,1)}};this[$[57]]=function(j,f){this._gl[$[133]](this._gl[$[103]],j);this._gl.bufferSubData(this._gl[$[103]],0,f)};this[$[106]]=function(){this[$[57]](this._matrixBuffer,this[$[119]]);this[$[57]](this[$[42]],this[$[61]]);this[$[57]](this[$[16]],this[$[39]]);this[$[57]](this[$[38]],this[$[60]])};this[$[128]]=function(){if(this[$[6]]){this[$[6]]=!1;var C=new Uint16Array(this[$[127]]);this._gl.uniform1iv(this[$[129]]["uTex"],C)};this[$[106]]();this._gl.drawElementsInstanced(this._gl[$[114]],6,this._gl.UNSIGNED_SHORT,0,this[$[124]]);this[$[124]]=0};this[$[101]]=function(x){if(!x.loaded)return 0;var B=this[$[126]].indexOf(x);if(B===-1||x.autoUpdate(this[$[120]])){if(B===-1){if(this[$[126]].length===this._config[$[131]]){this[$[128]]();this[$[127]].length=this[$[126]].length=0};this[$[126]].push(x);B=this[$[126]].length-1;this[$[127]].push(B);this[$[6]]=!0};AGL.Utils.useTexture(this._gl,B,x)};return B+1};this[$[91]]=function(){this._gl[this[$[49]].funcName](this._gl[this[$[49]].funcs[0]],this._gl[this[$[49]].funcs[1]],this._gl[this[$[49]].funcs[2]],this._gl[this[$[49]].funcs[3]])};this._resize=function(){if(!this[$[93]]())return!1;AGL.Matrix3.projection(this._width,this._height,this[$[123]]);this[$[35]]++;return!0}});AGL[$[113]][$[30]]=function(){return"#version 300 es\nin vec2 aPos;in mat3 aMat;in mat3 aWorldMat;in mat3 aTexMat;in vec4 aTexCrop;out vec2 vTexCrd;out vec2 vTexCrop;out vec2 vTexCropSize;void main(void){vec3 pos=vec3(aPos,1);gl_Position=vec4((aWorldMat*aMat*pos).xy,0,1);vTexCrd=(aTexMat*pos).xy;vTexCrop=aTexCrop.xy;vTexCropSize=aTexCrop.zw;}"};AGL[$[113]][$[15]]=function(){return"#version 300 es\nprecision lowp float;in vec2 vTexCrd;in vec2 vTexCrop;in vec2 vTexCropSize;out vec4 fgCol;void main(void){fgCol=vec4(1);}"};AGL[$[81]]=c4(BasePrototypeClass,function e(a){BasePrototypeClass.call(this);a[$[111]]=a[$[111]]||AGL[$[81]][$[30]];a[$[79]]=a[$[79]]||AGL[$[81]][$[15]];Object.freeze(a);this.texture=null;this.filters=[];this._config=a;AGL[$[78]].init.call(this,a.canvas);var d=AGL.Utils[$[96]](this._gl,[AGL.Utils[$[52]](this._gl,a[$[111]](a)),AGL.Utils[$[40]](this._gl,a[$[79]](a))]);this[$[129]]=AGL.Utils[$[67]](this._gl,d,Object.assign(a[$[139]],{"aPos":"getAttribLocation","uTex":"getUniformLocation","uDspTex":"getUniformLocation","uFlpY":"getUniformLocation","uFtrT":"getUniformLocation","uFtrST":"getUniformLocation","uFtrVal":"getUniformLocation","uTm":"getUniformLocation",}));this._gl.useProgram(d);var f=this._gl[$[109]]();this._gl[$[133]](this._gl[$[103]],f);this._gl[$[134]](this._gl[$[103]],new Float32Array([0,0,1,0,1,1,0,1]),this._gl[$[122]]);this._gl[$[25]](this[$[129]]["aPos"],2,this._gl.FLOAT,!1,0,0);this._gl[$[7]](this[$[129]]["aPos"]);this._gl[$[134]](this._gl[$[103]],new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,1,1,-1]),this._gl[$[122]]);this._gl[$[140]](this[$[129]]["uTex"],0);this._gl[$[140]](this[$[129]]["uDspTex"],2);this._resize()},function(){AGL[$[78]][$[26]].call(this);this._render=function(){if(!this.texture.loaded)return;this._gl.clear(this._gl[$[54]]);AGL.Utils.useTexture(this._gl,0,this.texture);this._gl.uniform1f(this[$[129]]["uFlpY"],1);this._gl[$[140]](this[$[129]]["uFtrT"],0);this._gl.uniform1f(this[$[129]]["uTm"],(this[$[120]]/10000)%10000);this._gl.drawArrays(this._gl[$[114]],0,6);var i;var l=this.filters.length;for(i=0;i<l;++i){var b=this.filters[i];this._gl[$[140]](this[$[129]]["uTex"],0);this._gl[$[140]](this[$[129]]["uDspTex"],2);b.texture&&b.texture.loaded&&AGL.Utils.useTexture(this._gl,2,b.texture);b[$[50]](this._gl,this._width,this._height);this._gl[$[68]](this._gl[$[121]],b.framebuffer);this._gl.uniform1f(this[$[129]]["uFlpY"],-1);this._gl.uniform1fv(this[$[129]]["uFtrVal"],b.values);this._gl[$[140]](this[$[129]]["uFtrT"],b.type);this._gl[$[140]](this[$[129]]["uFtrST"],b.subType);this._gl.drawArrays(this._gl[$[114]],0,6);b[$[118]](this._gl,0)};this._gl[$[68]](this._gl[$[121]],null);this._gl.uniform1f(this[$[129]]["uFlpY"],1);this._gl[$[140]](this[$[129]]["uFtrT"],0);this._gl.drawArrays(this._gl[$[114]],0,6)}});AGL[$[81]][$[30]]=function(){return"#version 300 es\nin vec2 aPos;uniform float uFlpY;out vec2 vCrd;out vec2 vTexCrd;void main(void){gl_Position=vec4(aPos.xy,0,1);gl_Position.y*=uFlpY;vCrd=aPos;vTexCrd=(aPos+vec2(1,-1))/vec2(2,-2);}"};AGL[$[81]][$[15]]=function(){var c="#version 300 es\nprecision lowp float;\nuniform sampler2D uTex;uniform sampler2D uDspTex;uniform int uFtrT;uniform int uFtrST;uniform float uFtrVal[9];uniform float uTm;in vec2 vCrd;in vec2 vTexCrd;out vec4 fgCol;vec4 blur(vec4 oCol,float bx, float by,vec2 crd,vec2 oPx){vec4 col=oCol;float w=oPx.x*bx;float h=oPx.y*by;for(float i=-2.;i<3.;++i){for(float j=-2.;j<3.;++j){if(i!=0.&&j!=0.)col+=texture(uTex,crd+vec2(i*w,j*h));}}return col/25.;}vec4 glw(vec4 oCol,float bx, float by,vec2 crd,vec2 oPx){float oAvg=(oCol.r+oCol.g+oCol.b)/3.;vec4 col=oCol;float w=oPx.x*bx;float h=oPx.y*by;float c=1.;for(float i=-3.;i<4.;++i){for(float j=-3.;j<4.;++j){vec4 tCol=texture(uTex,crd+vec2(i*w,j*h));float avg=(tCol.r+tCol.g+tCol.b)/3.;if(avg>oAvg){col+=tCol;c++;}}}return col/c;}vec4 convMat(vec4 oCol,float v[9],vec2 crd,vec2 oPx){return (texture(uTex,crd-oPx)*v[0]+texture(uTex,crd+vec2(0,-oPx.y))*v[1]+texture(uTex,crd+vec2(oPx.x,-oPx.y))*v[2]+texture(uTex,crd+vec2(-oPx.x,0))*v[3]+oCol*v[4]+texture(uTex,crd+vec2(oPx.x,0))*v[5]+texture(uTex,crd+vec2(-oPx.x,oPx.y))*v[6]+texture(uTex,crd+vec2(0,oPx.y))*v[7]+texture(uTex,crd+oPx)*v[8])/9.;}vec4 pxlt(float v,vec2 crd,vec2 oPx){vec2 vol=v*oPx;return texture(uTex,floor(crd/vol)*vol);}void main(void){float[] fvl=uFtrVal;vec2 oSz=vec2(textureSize(uTex,0));vec2 oPx=vec2(1)/oSz;fgCol=texture(uTex,vTexCrd);if(uFtrT>0){if(uFtrT<2)fgCol=convMat(fgCol,fvl,vTexCrd,oPx);else if(uFtrT<3){if(uFtrST<2)fgCol=vec4(vec3((fgCol.r+fgCol.g+fgCol.b)/3.),fgCol.a);else if(uFtrST<3)fgCol=vec4(vec3(.874,.514,.156)*((fgCol.r+fgCol.g+fgCol.b)/3.),fgCol.a);else if(uFtrST<4)fgCol=abs(vec4(fgCol.rgb-1.,fgCol.a));else if(uFtrST<5)fgCol=vec4(fgCol.rgb*vec3(fvl[0],fvl[1],fvl[2]),fgCol.a);else if(uFtrST<6)fgCol=vec4((round((fgCol.rgb*256.)/fvl[0])/256.)*fvl[0],fgCol.a);else if(uFtrST<7)fgCol*=vec4(vec3((1.-sqrt(pow(vCrd.x,4.)+pow(vCrd.y,4.)))),1);else if(uFtrST<8)fgCol+=vec4(vCrd.xy*.15,(vCrd.x-vCrd.y)*.15,0);else if(uFtrST<9)fgCol*=vec4(.2+sin(vCrd.y*500.)*.5);else if(uFtrST<10)fgCol=vec4((fgCol.rgb-.5)*fvl[1]+.5+fvl[0],fgCol.a);else if(uFtrST<11)fgCol=vec4(pow(fgCol.rgb,vec3(fvl[0])),fgCol.a);}else if(uFtrT<4)fgCol=blur(fgCol,fvl[0],fvl[1],vTexCrd,oPx);else if(uFtrT<5)fgCol=pxlt(fvl[0],vTexCrd,oPx);else if(uFtrT<6)fgCol=glw(fgCol,fvl[0],fvl[1],vTexCrd,oPx);else if(uFtrT<7){vec2 dspMd=vec2(1,-1)*(texture(uDspTex,fract(vec2(1,-1)*vCrd*.5+vec2(.5)+uTm*vec2(fvl[1],fvl[2]))).rg-.5)*2.*oPx*fvl[0];vec2 mdPs=vTexCrd+dspMd;if(mdPs.x>=.0&&mdPs.y>=.0&&mdPs.x<=1.&&mdPs.y<=1.)fgCol=texture(uTex,mdPs);}}}";return c};AGL[$[71]]=c4(AGL[$[113]],function h(c){c[$[111]]=c[$[111]]||AGL[$[71]][$[30]];c[$[79]]=c[$[79]]||AGL[$[71]][$[15]];c[$[139]]=Object.assign(c[$[139]],{"aTexId":"getAttribLocation",});AGL[$[113]].call(this,c);this[$[72]]=new Float32Array(10000);this[$[56]]=this[$[32]](this[$[72]],"aTexId",1,1,1,this._gl.FLOAT,4)},function(d){this[$[73]]=function(a,e,j,b,f){d[$[73]].call(this,a,e,j,b,f);this[$[72]][this[$[124]]]=j};this[$[106]]=function(){d[$[106]].call(this);this[$[57]](this[$[56]],this[$[72]])}});AGL[$[71]][$[30]]=function(){var g="#version 300 es\nin vec2 aPos;in mat3 aMat;in mat3 aWorldMat;in mat3 aTexMat;in vec4 aTexCrop;in float aTexId;out vec2 vTexCrd;out vec2 vTexCrop;out vec2 vTexCropSize;out float vTexId;void main(void){vec3 pos=vec3(aPos,1);gl_Position=vec4((aWorldMat*aMat*pos).xy,0,1);vTexCrd=(aTexMat*pos).xy;vTexCrop=aTexCrop.xy;vTexCropSize=aTexCrop.zw;vTexId=aTexId;}";return g};AGL[$[71]][$[15]]=function(c){var k=c[$[131]];var g="#version 300 es\nprecision lowp float;in vec2 vTexCrd;in vec2 vTexCrop;in vec2 vTexCropSize;in float vTexId;uniform sampler2D uTex["+k+"];out vec4 fgCol;";g+="void main(void){";for(var i=-1;i<k;i++){g+=(i>-1?" else ":"")+"if(vTexId<"+(i+1)+".5){";g+="fgCol="+(i<0?"vec4(0);":"texture(uTex["+i+"],vTexCrop+vTexCropSize*fract(vTexCrd));");g+="}"};g+="}";return g};AGL[$[116]]=c4(AGL[$[71]],function c(a){a[$[111]]=a[$[111]]||AGL[$[116]][$[30]];a[$[79]]=a[$[79]]||AGL[$[116]][$[15]];AGL[$[71]].call(this,a);this[$[130]].r=this[$[130]].g=this[$[130]].b=this[$[130]].a=0});AGL[$[116]][$[30]]=AGL[$[71]][$[30]];AGL[$[116]][$[15]]=function(a){var d=a[$[131]];var b="#version 300 es\nprecision lowp float;in vec2 vTexCrd;in vec2 vTexCrop;in vec2 vTexCropSize;in float vTexId;uniform sampler2D uTex["+d+"];out vec4 fgCol;";b+="void main(void){";for(var i=-1;i<d;i++){b+=(i>-1?" else ":"")+"if(vTexId<"+(i+1)+".5){";b+=i<0?"fgCol=vec4(0);":"vec4 col=texture(uTex["+i+"],vTexCrop+vTexCropSize*fract(vTexCrd));fgCol=vec4(1)*((col.r+col.g+col.b+col.a)/4.);";b+="}"};b+="}";return b};AGL.Stage2D=c4(AGL[$[113]],function k(d){d[$[111]]=d[$[111]]||AGL.Stage2D[$[30]];d[$[79]]=d[$[79]]||AGL.Stage2D[$[15]];d[$[139]]=Object.assign(d[$[139]],{"aFillCol":"getAttribLocation","aTintCol":"getAttribLocation","aFx":"getAttribLocation","uRes":"getUniformLocation","uLghtPos":"getUniformLocation","uLghtVol":"getUniformLocation","uLghtCol":"getUniformLocation","uLghtFX":"getUniformLocation","uLghtZIndices":"getUniformLocation","uFog":"getUniformLocation",});AGL[$[113]].call(this,d);this.fog=new AGL.ColorProps();this.fog.a=0;this[$[132]]=this.color.items;this._DEFAULT_DUO=[0,0];this._DEFAULT_QUAD=[0,0,0,0];this._widthHalf=this._heightHalf=0;this._lights=[];this._picked;this[$[108]]=!1;this[$[47]]=new Float32Array([0,0,1]);this._tempMatrix=new Float32Array(6);this[$[29]]=new Float32Array(6);this[$[28]]=emptyFunction;if(this._config[$[85]]){this[$[65]]=new Float32Array(this._config[$[141]]*2);this[$[94]]=new Float32Array(this._config[$[141]]*2);this[$[104]]=new Float32Array(this._config[$[141]]*4);this[$[95]]=new Float32Array(this._config[$[141]]*4);this[$[76]]=new Int32Array(this._config[$[141]]);for(var i=0,l=this._config[$[141]];i<l;++i){this._lights.push(new AGL.Light(i,this[$[65]],this[$[94]],this[$[104]],this[$[95]],this[$[76]]))};this[$[28]]=this._collectLights.bind(this)};this._colorData=new Float32Array(10000*4);this._colorBuffer=this[$[32]](this._colorData,"aFillCol",4,1,4,this._gl.FLOAT,4);this[$[84]]=new Float32Array(10000*4);this[$[55]]=this[$[32]](this[$[84]],"aTintCol",4,1,4,this._gl.FLOAT,4);this[$[87]]=(this._config[$[89]]?4:3);this[$[117]]=new Float32Array(10000*this[$[87]]);this._effectBuffer=this[$[32]](this[$[117]],"aFx",this[$[87]],1,this[$[87]],this._gl.FLOAT,4);this[$[58]]=this._config[$[89]]?this._setMaskData.bind(this):emptyFunction;this[$[83]]=0;this._resize()},function(e){get(this,"picked",function(){return this._picked});this.render=function(){this._preRender();this._picked=null;this[$[83]]=0;this[$[102]]();this._updateFog();this[$[28]]();this._render();this[$[108]]=!1};this.getLight=function(a){return this._lights[a]};this.setPickerPoint=function(x,y){this[$[108]]=!0;this[$[47]][0]=(x-this._widthHalf)*this[$[123]][0];this[$[47]][1]=(y-this._heightHalf)*this[$[123]][4]};this._updateFog=function(){this.fog[$[137]]()&&this._gl.uniform4fv(this[$[129]]["uFog"],this.fog.items)};this._collectLights=function(){this._gl.uniform2fv(this[$[129]]["uLghtPos"],this[$[65]]);this._gl.uniform2fv(this[$[129]]["uLghtVol"],this[$[94]]);this._gl.uniform4fv(this[$[129]]["uLghtCol"],this[$[104]]);this._gl.uniform4fv(this[$[129]]["uLghtFX"],this[$[95]]);this._gl.uniform1fv(this[$[129]]["uLghtZIndices"],this[$[76]])};this._drawItem=function(b,f){if(!b.renderable)return;b.props.zIndex=++this[$[83]];b.update(this[$[120]],f);b.type!=="item"&&this[$[62]][b.type](b,f)};this._setMaskData=function(b){b.mask&&(this[$[117]][this[$[124]]*this[$[87]]+3]=this[$[101]](b.mask))};this[$[73]]=function(b,f,l,c,g,j){e[$[73]].call(this,b,f,l,c,g);arraySet(this._colorData,f[$[132]],g);arraySet(this[$[84]],b[$[132]],g);this[$[117]][j]=l;this[$[117]][j+1]=b.tintType;this[$[117]][j+2]=b.props.zIndex};this._drawImage=function(b,f){this[$[70]](b);if(this[$[108]]&&b.interactive&&AGL.Matrix3.isPointInMatrix(this[$[47]],f[$[123]],b[$[123]],this._tempMatrix,this[$[29]]))this._picked=b;this[$[58]](b);var l=this[$[101]](b.texture);this[$[73]](b,f,l,this[$[124]]*9,this[$[124]]*4,this[$[124]]*this[$[87]]);++this[$[124]]===10000&&this[$[128]]()};this[$[106]]=function(){e[$[106]].call(this);this[$[57]](this._colorBuffer,this._colorData);this[$[57]](this[$[55]],this[$[84]]);this[$[57]](this._effectBuffer,this[$[117]])};this._resize=function(){if(!e._resize.call(this))return;this._widthHalf=this._width*0.5;this._heightHalf=this._height*0.5;this._gl.uniform2f(this[$[129]]["uRes"],this._width/this._height,100/this._width)};this[$[102]]=function(){this.color[$[137]]()&&this[$[33]]++}});cnst(AGL.Stage2D,"MAX_LIGHT_SOURCES",16);AGL.Stage2D[$[30]]=function(d){var m=d[$[141]];var h="#version 300 es\n";h+="in vec2 aPos;in mat3 aMat;in mat3 aWorldMat;in mat3 aTexMat;in vec4 aTexCrop;in vec4 aFillCol;in vec4 aTintCol;in vec"+(d[$[89]]?"4":"3")+" aFx;";h+="uniform vec2 uRes;uniform vec4 uFog;";if(d[$[85]]){h+="uniform vec2 uLghtPos["+m+"];uniform vec2 uLghtVol["+m+"];uniform vec4 uLghtCol["+m+"];uniform vec4 uLghtFX["+m+"];uniform float uLghtZIndices["+m+"];"};h+="out vec2 vTexCrd;out vec4 vCrd;out vec2 vMskCrd;out vec2 vTexCrop;out vec2 vTexCropSize;out vec4 vFillCol;out vec4 vTintCol;out float vTexId;out float vTintType;out float vColMult;out vec4 vFogCol;";if(d[$[89]])h+="out float vMskTexId;";if(d[$[85]]){h+="vec4 lghtVal(vec4 pos,vec2 lghtPos,vec2 lghtVol,vec4 lghtCol,vec4 lghtFX){vec2 dist=pos.xy-lghtPos;return lghtCol*lghtCol.a*max(0.,min(1.,1.-sqrt(pow(abs(dist.x+(abs(dist.x)*lghtFX.x)),lghtFX.z)*(lghtVol.x/uRes.y)+pow(abs(dist.y+(abs(dist.y)*lghtFX.y)),lghtFX.w)*(lghtVol.y/uRes.x/uRes.y))));}"};h+="void main(void){vec3 pos=vec3(aPos,1);gl_Position=vec4((aWorldMat*aMat*pos).xy,0,1);vTexCrd=(aTexMat*pos).xy;vCrd=gl_Position;vMskCrd=(vCrd.xy+vec2(1,-1))/vec2(2,-2);vTexCrop=aTexCrop.xy;vTexCropSize=aTexCrop.zw;vFillCol=aFillCol;vTintCol=aTintCol;vTexId=aFx.x;vTintType=aFx.y;";h+="vec4 lghtCol=vec4(0);";if(d[$[85]]){for(var i=0;i<m;i++){h+="if(uLghtCol["+i+"].a>0. && uLghtZIndices["+i+"]>aFx.z){lghtCol+=lghtVal(vCrd,uLghtPos["+i+"],uLghtVol["+i+"],uLghtCol["+i+"],uLghtFX["+i+"]);}"}};h+="float colLghtMult=max(0.,uFog.a-lghtCol.a);vColMult=max(0.,1.-colLghtMult);vFogCol=vec4(uFog.rgb*colLghtMult,0);vFillCol+=lghtCol;";if(d[$[89]])h+="vMskTexId=aFx.w;";h+="}";return h};AGL.Stage2D[$[15]]=function(d){var n=d[$[131]];var h="#version 300 es\nprecision lowp float;in vec4 vCrd;in vec2 vMskCrd;in vec2 vTexCrd;in vec2 vTexCrop;in vec2 vTexCropSize;in vec4 vFillCol;in vec4 vTintCol;in float vTexId;in float vTintType;in float vColMult;in vec4 vFogCol;";if(d[$[89]])h+="in float vMskTexId;";h+="uniform sampler2D uTex["+n+"];";h+="out vec4 fgCol;";h+="void main(void){";if(d[$[89]]){h+="float mskAlpha=1.;if(vMskTexId>0.){";for(var i=0;i<n;i++){h+=(i>0?" else ":"")+"if(vMskTexId<"+(i+1)+".5){mskAlpha=texture(uTex["+i+"],vMskCrd).r;if(mskAlpha==0.)discard;}"};h+="}"};for(var i=-1;i<n;i++){h+=(i>-1?" else ":"")+"if(vTexId<"+(i+1)+".5){";h+="fgCol="+(i<0?"vec4(0);":"texture(uTex["+i+"],vTexCrop+vTexCropSize*fract(vTexCrd));");h+="if(fgCol.a==0.) discard;}"};h+="if(fgCol.a>.0){if(vTintType<.5) fgCol*=vTintCol;else if(vTintType<1.5 && fgCol.r==fgCol.g && fgCol.r==fgCol.b) fgCol*=vTintCol;else if(vTintType<2.5) fgCol=vec4((fgCol.rgb*(1.-vTintCol.a))+(vTintCol.rgb*vTintCol.a),fgCol.a);";h+="vec4 finalCol=vec4(fgCol.rgb*vColMult,fgCol.a);fgCol=(finalCol*vFillCol)+vFogCol;";if(d[$[89]])h+="fgCol.a*=mskAlpha;";h+="}}";return h};AGL[$[82]]=c4(BasePrototypeClass,function e(){BasePrototypeClass.call(this);this.type=this.subType=0;this._values=new Float32Array(9);this._width=this._height=0;this._gl=this[$[23]]=this[$[107]]=null},function(){get(this,"framebufferTexture",function(){return this[$[23]]});get(this,"framebuffer",function(){return this[$[107]]});get(this,"values",function(){return this._values});prop(this,"intensity",{get:function(){return this._values[0]},set:function(v){this._values[0]=v},});this[$[50]]=function(a,b,d){if(b>0&&d>0&&(!this[$[107]]||this._gl!==a||this._width!==b||this._height!==d)){this[$[23]]&&this._gl.deleteTexture(this[$[23]]);this[$[107]]&&this._gl.deleteFramebuffer(this[$[107]]);this._width=b;this._height=d;this._gl=a;this[$[23]]=a.createTexture();this[$[118]](a,0);a.texImage2D(a[$[135]],0,a.RGBA,this._width,this._height,0,a.RGBA,a.UNSIGNED_BYTE,null);this[$[107]]=a.createFramebuffer();a[$[68]](a[$[121]],this[$[107]]);a.framebufferTexture2D(a[$[121]],a.COLOR_ATTACHMENT0,a[$[135]],this[$[23]],0)}};this[$[118]]=function(a,c){a.activeTexture(a.TEXTURE0+c);a[$[118]](a[$[135]],this[$[23]]);a[$[97]](a[$[135]],a.TEXTURE_WRAP_S,a[$[99]]);a[$[97]](a[$[135]],a.TEXTURE_WRAP_T,a[$[99]]);a[$[97]](a[$[135]],a[$[41]],a.NEAREST);a[$[97]](a[$[135]],a[$[44]],a.NEAREST)}});cnst(AGL[$[82]],"CONVOLUTE_TYPE",1);cnst(AGL[$[82]],"COLOR_MANIPULATION_TYPE",2);AGL.BlurFilter=c4(AGL[$[82]],function c(b,a){AGL[$[82]].call(this);this.type=3;this.blurX=b;this.blurY=a},function(){prop(this,"blurX",{get:function(){return this._values[0]},set:function(v){this._values[0]=v},});prop(this,"blurY",{get:function(){return this._values[1]},set:function(v){this._values[1]=v},})});AGL.EdgeDetectFilter=c4(AGL[$[82]],function a(){AGL[$[82]].call(this);this.type=1;this._values.set([-1,-1,-1,-1,8,-1,-1,-1,-1],0)});AGL.SharpenFilter=c4(AGL[$[82]],function a(){AGL[$[82]].call(this);this.type=1;this._values.set([-1,-1,-1,-1,16,-1,-1,-1,-1],0)});AGL.PixelateFilter=c4(AGL[$[82]],function b(a){AGL[$[82]].call(this);this.type=4;this.intensity=a});AGL.GlowFilter=c4(AGL[$[82]],function a(b,c){AGL[$[82]].call(this);this.type=5;this.intensityX=b;this.intensityY=c},function(){prop(this,"intensityX",{get:function(){return this._values[0]},set:function(v){this._values[0]=v},});prop(this,"intensityY",{get:function(){return this._values[1]},set:function(v){this._values[1]=v},})});AGL[$[21]]=c4(AGL[$[82]],function b(a){AGL[$[82]].call(this);this.type=2;this.subType=a});AGL.GrayscaleFilter=c4(AGL[$[21]],function a(){AGL[$[21]].call(this,1)});AGL.SepiaFilter=c4(AGL[$[21]],function a(){AGL[$[21]].call(this,2)});AGL.InvertFilter=c4(AGL[$[21]],function a(){AGL[$[21]].call(this,3)});AGL.TintFilter=c4(AGL[$[21]],function a(r,g,b){AGL[$[21]].call(this,4);this.r=r;this.g=g;this.b=b},function(){prop(this,"r",{get:function(){return this._values[0]},set:function(v){this._values[0]=v}});prop(this,"g",{get:function(){return this._values[1]},set:function(v){this._values[1]=v}});prop(this,"b",{get:function(){return this._values[2]},set:function(v){this._values[2]=v}})});AGL.ColorLimitFilter=c4(AGL[$[21]],function b(a){AGL[$[21]].call(this,5);this.intensity=a});AGL.VignetteFilter=c4(AGL[$[21]],function a(){AGL[$[21]].call(this,6)});AGL.RainbowFilter=c4(AGL[$[21]],function a(){AGL[$[21]].call(this,7)});AGL.LinesFilter=c4(AGL[$[21]],function a(){AGL[$[21]].call(this,8)});AGL.BrightnessContrastFilter=c4(AGL[$[21]],function c(b,a){AGL[$[21]].call(this,9);this.brightness=b;this.contrast=a},function(){prop(this,"brightness",{get:function(){return this._values[0]},set:function(v){this._values[0]=v}});prop(this,"contrast",{get:function(){return this._values[1]},set:function(v){this._values[1]=v}})});AGL.GammaFilter=c4(AGL[$[21]],function b(a){AGL[$[21]].call(this,10);this.intensity=a});AGL.DisplacementFilter=c4(AGL[$[82]],function c(a,b,x,y){AGL[$[82]].call(this);this.type=6;this.texture=a;this.intensity=b;this.x=x;this.y=y},function(){prop(this,"x",{get:function(){return this._values[1]},set:function(v){this._values[1]=v||0},});prop(this,"y",{get:function(){return this._values[2]},set:function(v){this._values[2]=v||0},})});}).call({});