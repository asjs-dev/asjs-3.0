(function(){"use strict";Array.prototype.addUnique=function(item){this.indexOf(item)==-1&&this.push(item)};Array.prototype.has=function(item){return this.indexOf(item)>-1};Array.prototype.remove=function(item){var a=this.indexOf(item);a>-1&&this.splice(a,1)};Array.prototype.clone=function(){return this.slice(0)};Array.prototype.equal=function(arr){if(!arr||arr.length!==this.length)return!1;for(var i=0;i<this.length;i++){if(this[i]!==arr[i])return!1};return!0};var arraySet=function(target,source,from){var i=0;var l=source.length;while(i<l){target[from+i]=source[i];++i}};var trace=console.log;var trc=trace;try{trc("")}catch(e){console.log(e);trace=function(){}};trc=trace;console.clear();var _d=document;var _w=window;var _m=Math;var _crel=_d.createElement;var property=function(t,n,v){v.enumerable=!0;v.configurable=!0;Object.defineProperty(t,n,v)};var prop=property;var get=function(t,n,v){prop(t,n,{get:v})};var set=function(t,n,v){prop(t,n,{set:v})};var constant=function(t,n,v){prop(t,n,{value:v})};var cnst=constant;cnst(_w,"on","addEventListener");cnst(_w,"off","removeEventListener");cnst(_w,"offAll","removeEventListeners");cnst(_w,"de","dispatchEvent");cnst(_w,"has","hasEventListener");var empty=function(a){try{return a===undefined||a===null||a===""||a.length===0}catch(e){return!0}};var emp=empty;var map=function(o,cb){for(var k in o){if(!o.hasOwnProperty(k))continue;var v=cb(k,o[k]);if(!emp(v))o[k]=v}};var emptyFunction=function(){};var ef=emptyFunction;var createPrototypeClass=function(parent,construct,body){var a=parent.prototype;var b=construct.prototype;Object.setPrototypeOf(construct,parent);Object.setPrototypeOf(b,a);b.constructor=construct;body&&body.call(b,a);return construct};var c4=createPrototypeClass;var deleteProperty=function(t,p){var a=Object.getOwnPropertyDescriptor(t,p);if(a&&(a.get||a.set))prop(t,p,{set:ef,get:ef});else{try{t[p]=null}catch(e){}};delete t[p]};var del=deleteProperty;var destructObjectFlat=function(t,stack){ito(t,function(a,b,c){del(t,a);c()});t=null};var destObjFlat=destructObjectFlat;var BasePrototypeClass=c4(Object,function a(){},function(){this.destruct=function(){destObjFlat(this)};this.toObject=function(){return JSON.parse(JSON.stringify(this))}});trc("AGL 1.0");_w.AGL={};AGL.CreateConfig=function(options){var c="Maximum of ";if(options.textureNum===undefined||options.textureNum>AGL.Utils.info.maxTextureImageUnits){console.warn(c+"texture units is "+AGL.Stage2D.MAX_LIGHT_SOURCES);options.textureNum=AGL.Utils.info.maxTextureImageUnits};if(options.lightNum===undefined)options.lightNum=0;else if(options.lightNum>AGL.Stage2D.MAX_LIGHT_SOURCES){console.warn(c+"lights is "+AGL.Stage2D.MAX_LIGHT_SOURCES);options.lightNum=AGL.Stage2D.MAX_LIGHT_SOURCES};var b=options.contextAttributes||{};var a={"textureNum":options.textureNum,"lightNum":options.lightNum,"isLightEnabled":options.lightNum>0,"isMaskEnabled":options.isMaskEnabled,"filters":options.filters,"isFilterEnabled":options.filters&&options.filters.length>0,"contextAttributes":{"alpha":b.alpha||!1,"antialias":b.antialias||!1,"depth":b.depth||!1,"stencil":b.stencil||!1,"premultipliedAlpha":b.premultipliedAlpha||!1,"powerPreference":b.powerPreference||"high-performance"}};Object.freeze(a);return a};(function(){var f="ONE_MINUS_SRC_ALPHA";var g="ONE_MINUS_SRC_COLOR";var c="SRC_ALPHA";var d="DST_ALPHA";var a="ONE";function e(b){return{"funcName":b.length===2?"blendFunc":"blendFuncSeparate","funcs":b}};AGL.BlendModes={"NORMAL":e([c,f,a,f]),"ADD":e([c,d,a,d]),"MULTIPLY":e(["DST_COLOR",f]),"SCREEN":e([c,g,a,g]),"OVERLAY":e([a,f])};Object.freeze(AGL.BlendModes)})();AGL.AbstractProps=c4(BasePrototypeClass,function b(){BasePrototypeClass.call(this);this.id=-1;this._99=-1},function(){this.isUpdated=function(){var a=this._99!==this.id;this._99=this.id;return a}});AGL.ColorProps=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this.items=[1,1,1,1]},function(){prop(this,"r",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;++this.id}}});prop(this,"g",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;++this.id}}});prop(this,"b",{get:function(){return this.items[2]},set:function(v){if(this.items[2]!==v){this.items[2]=v;++this.id}}});prop(this,"a",{get:function(){return this.items[3]},set:function(v){if(this.items[3]!==v){this.items[3]=v;++this.id}}})});AGL.ItemProps=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this._101=0;this._102=0;this._96=0;this._77=0;this._97=1;this._90=1;this._98=1;this._92=1;this._82=0;this._84=0;this._55=1;this._40=1},function(){get(this,"scaledWidth",function(){return this._55});get(this,"scaledHeight",function(){return this._40});prop(this,"x",{get:function(){return this._101},set:function(v){if(this._101!==v){this._101=v;++this.id}}});prop(this,"y",{get:function(){return this._102},set:function(v){if(this._102!==v){this._102=v;++this.id}}});prop(this,"zIndex",{get:function(){return this._96},set:function(v){this._96!==v&&(this._96=v)}});prop(this,"rotation",{get:function(){return this._77},set:function(v){if(this._77!==v){this._77=v;++this.id}}});prop(this,"scaleX",{get:function(){return this._97},set:function(v){if(this._97!==v){this._97=v;this._7();++this.id}}});prop(this,"scaleY",{get:function(){return this._90},set:function(v){if(this._90!==v){this._90=v;this._4();++this.id}}});prop(this,"width",{get:function(){return this._98},set:function(v){if(this._98!==v){this._98=v;this._7();++this.id}}});prop(this,"height",{get:function(){return this._92},set:function(v){if(this._92!==v){this._92=v;this._4();++this.id}}});prop(this,"anchorX",{get:function(){return this._82},set:function(v){if(this._82!==v){this._82=v;++this.id}}});prop(this,"anchorY",{get:function(){return this._84},set:function(v){if(this._84!==v){this._84=v;++this.id}}});this._7=function(){this._55=this._98*this._97};this._4=function(){this._40=this._92*this._90}});AGL.LightEffectProps=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this.items=[0,0,2,2]},function(){prop(this,"anchorX",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;++this.id}}});prop(this,"anchorY",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;++this.id}}});prop(this,"quadX",{get:function(){return this.items[2]},set:function(v){if(this.items[2]!==v){this.items[2]=v;++this.id}}});prop(this,"quadY",{get:function(){return this.items[3]},set:function(v){if(this.items[3]!==v){this.items[3]=v;++this.id}}})});AGL.TextureCrop=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this.items=[0,0,1,1]},function(){prop(this,"x",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;++this.id}}});prop(this,"y",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;++this.id}}});prop(this,"width",{get:function(){return this.items[2]},set:function(v){if(this.items[2]!==v){this.items[2]=v;++this.id}}});prop(this,"height",{get:function(){return this.items[3]},set:function(v){if(this.items[3]!==v){this.items[3]=v;++this.id}}})});AGL.TextureProps=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this._101=0;this._102=0;this._77=0;this._98=1;this._92=1;this._82=0;this._84=0},function(){prop(this,"x",{get:function(){return this._101},set:function(v){if(this._101!==v){this._101=v;++this.id}}});prop(this,"y",{get:function(){return this._102},set:function(v){if(this._102!==v){this._102=v;++this.id}}});prop(this,"rotation",{get:function(){return this._77},set:function(v){if(this._77!==v){this._77=v;++this.id}}});prop(this,"width",{get:function(){return this._98},set:function(v){if(this._98!==v){this._98=v;++this.id}}});prop(this,"height",{get:function(){return this._92},set:function(v){if(this._92!==v){this._92=v;++this.id}}});prop(this,"anchorX",{get:function(){return this._82},set:function(v){if(this._82!==v){this._82=v;++this.id}}});prop(this,"anchorY",{get:function(){return this._84},set:function(v){if(this._84!==v){this._84=v;++this.id}}})});AGL.Matrix3={isPointInMatrix:function(j,a,b,l,o){l[0]=a[0]*b[0]+a[3]*b[1];l[1]=a[1]*b[0]+a[4]*b[1];l[2]=a[0]*b[3]+a[3]*b[4];l[3]=a[1]*b[3]+a[4]*b[4];l[4]=a[0]*b[6]+a[3]*b[7]+a[6];l[5]=a[1]*b[6]+a[4]*b[7]+a[7];var d=1/(l[0]*l[3]-l[2]*l[1]);o[0]=d*l[3];o[1]=-d*l[1];o[2]=-d*l[2];o[3]=d*l[0];o[4]=d*(l[2]*l[5]-l[3]*l[4]);o[5]=-d*(l[0]*l[5]-l[1]*l[4]);var x=j[0]*o[0]+j[1]*o[2]+o[4];var y=j[0]*o[1]+j[1]*o[3]+o[5];return x>=0&&y>=0&&x<=1&&y<=1},identity:function(){return new Float32Array([1,0,0,0,1,0,0,0,1,])},projection:function(n,p,k){k[0]=2/n;k[1]=0;k[2]=0;k[3]=0;k[4]=-2/p;k[5]=0;k[6]=-1;k[7]=1;k[8]=1},transformLocal:function(x,y,r,c,e,f,g,k){var h=_m.sin(r);var i=_m.cos(r);k[0]=i*f;k[1]=h*f;k[3]=-h*g;k[4]=i*g;k[6]=x-(c*k[0])-(e*k[3]);k[7]=y-(c*k[1])-(e*k[4])},transform:function(m,x,y,r,c,e,f,g,k){var h=_m.sin(r);var i=_m.cos(r);k[0]=(i*m[0])+(h*m[3]);k[1]=(i*m[1])+(h*m[4]);k[3]=(i*m[3])-(h*m[0]);k[4]=(i*m[4])-(h*m[1]);k[6]=-(c*k[0])-(e*k[3])+(x*m[0])+(y*m[3])+m[6];k[7]=-(c*k[1])-(e*k[4])+(x*m[1])+(y*m[4])+m[7];k[0]*=f;k[1]*=f;k[3]*=g;k[4]*=g}};Object.freeze(AGL.Matrix3);(function(){var c=c4(BasePrototypeClass,function c(){BasePrototypeClass.call(this);this.info={"isWebGl2Supported":!1};var h=_crel.call(_d,"canvas");var a;if(a=h.getContext("webgl2")){this.info.isWebGl2Supported=!0;this.info.maxTextureImageUnits=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.info.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.info.maxVertexAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.info.maxVaryingVectors=a.getParameter(a.MAX_VARYING_VECTORS);this.info.maxVertexUniformVectors=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.info.maxFragmentUniformComponents=a.getParameter(a.MAX_FRAGMENT_UNIFORM_COMPONENTS);this.info.maxFragmentUniformVectors=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.info.maxVaryingComponents=a.getParameter(a.MAX_VARYING_COMPONENTS)}},function(){this.useTexture=function(a,e,q){a.activeTexture(a.TEXTURE0+e);a.bindTexture(q.target,q.texture);a.texImage2D(q.target,0,a.RGBA,q.width,q.height,0,a.RGBA,a.UNSIGNED_BYTE,q.source);a.texParameteri(q.target,a.TEXTURE_MAX_LEVEL,q.maxLevel);if(q.generateMipmap){a.generateMipmap(q.target);a.flush()};a.texParameteri(q.target,a.TEXTURE_WRAP_S,q.wrapS);a.texParameteri(q.target,a.TEXTURE_WRAP_T,q.wrapT);if(q.generateMipmap){a.texParameteri(q.target,a.TEXTURE_MIN_FILTER,q.minFilter===a.LINEAR?a.LINEAR_MIPMAP_LINEAR:a.NEAREST_MIPMAP_NEAREST)}else{a.texParameteri(q.target,a.TEXTURE_MIN_FILTER,q.minFilter)};a.texParameteri(q.target,a.TEXTURE_MIN_FILTER,q.minFilter);a.texParameteri(q.target,a.TEXTURE_MAG_FILTER,q.magFilter)};this.loadShader=function(p,a,s){var g=a.createShader(a[p]);a.shaderSource(g,s);a.compileShader(g);var m=a.getShaderParameter(g,a.COMPILE_STATUS);if(!m){var n=a.getShaderInfoLog(g);trc("Error compiling shader "+p+":"+n);a.deleteShader(g);return null};return g};this.loadVertexShader=this.loadShader.bind(this,"VERTEX_SHADER");this.loadFragmentShader=this.loadShader.bind(this,"FRAGMENT_SHADER");this.createProgram=function(a,l,r,t){var j=a.createProgram();map(l,function(b,g){a.attachShader(j,g)});if(r){map(r,function(b,i){a.bindAttribLocation(j,t?t[b]:b,i)})};a.linkProgram(j);var f=a.getProgramParameter(j,a.LINK_STATUS);if(!f){var n=a.getProgramInfoLog(j);trc("Error in program linking:"+n);a.deleteProgram(j);return null};a.flush();return j};this.getLocationsFor=function(a,j,v){var o={};map(v,function(b,u){o[b]=a[u](j,b)});return o};this.destroyTexture=function(a,k){a.bindTexture(k.target,null);a.deleteTexture(k.texture)};this.isPowerOf2=function(d){return(d&(d-1))==0}});AGL.Utils=new c();Object.freeze(AGL.Utils)})();AGL.Texture=c4(BasePrototypeClass,function f(a,d){BasePrototypeClass.call(this);this._93;this._2=this._12.bind(this);this._24=!1;this._91=!1;this.isVideo=!1;this.shouldUpdate=!1;this.texture=a.createTexture();this.maxLevel=10;this.target=a.TEXTURE_2D;this.wrapS=a.CLAMP_TO_EDGE;this.wrapT=a.CLAMP_TO_EDGE;this.minFilter=a.NEAREST;this.magFilter=a.NEAREST;this.source=d;this._74="width";this._79="height";this._69;this._56=-1},function(e){get(this,"generateMipmap",function(){return this._24});get(this,"loaded",function(){return this._91});get(this,"width",function(){return this._93[this._74]});get(this,"height",function(){return this._93[this._79]});prop(this,"source",{get:function(){return this._93},set:function(v){this._93&&this._93[off](this._69,this._2);this._93=v;this.isVideo=this._29()==="video";this._69=this.isVideo?"canplay":"load";this._10();this._93[on](this._69,this._2)}});this.autoUpdate=function(h){var i=h!==this._56;this._56=h;return i&&(this.shouldUpdate||(this.isVideo&&!this._93.paused))};this.destruct=function(){this._93&&this._93[off](this._69,this._2);e.destruct.call(this)};this._10=function(){this._74="naturalWidth";this._79="naturalHeight";if(!this._93[this._74]){this._74="videoWidth";this._79="videoHeight"};if(!this._93[this._74]){this._74="width";this._79="height"};this._24=AGL.Utils.isPowerOf2(this.width)&&AGL.Utils.isPowerOf2(this.height);this._91=this._29()==="canvas"||this.width>0&&this.height>0};this._29=function(){return this._93.tagName.toLowerCase()};this._12=this._10});AGL.Texture.loadImage=function(a,src){var b=_crel.call(_d,"img");var g=new AGL.Texture(a,b);b.src=src;return g};AGL.Texture.loadVideo=function(a,src){var c=_crel.call(_d,"video");var g=new AGL.Texture(a,c);c.src=src;return g};AGL.Item=c4(BasePrototypeClass,function a(){BasePrototypeClass.call(this);cnst(this,"type","item");this.renderable=!0;this.interactive=!1;this.matrixCache=AGL.Matrix3.identity();this.props=new AGL.ItemProps();this.color=new AGL.ColorProps();this.colorCache=this.color.items;this.parent=null},function(c){get(this,"stage",function(){return this.parent?this.parent.stage:null});this.destruct=function(){this.parent&&this.parent.removeChild&&this.parent.removeChild(this);c.destruct.call(this)};this.update=function(e,d){this._49(d)};this._49=function(d){var b=this.props;b.isUpdated()&&this._28(b,d)};this._28=function(b,d){AGL.Matrix3.transform(d.matrixCache,b.x,b.y,b.rotation,b.anchorX,b.anchorY,b.scaledWidth,b.scaledHeight,this.matrixCache)}});cnst(AGL.Item,"TYPE","item");AGL.Light=c4(AGL.Item,function a(){AGL.Item.call(this);this._21=-1;this.positionCache=[];this.volumeCache=[];this.effect=new AGL.LightEffectProps();this.effectCache=this.effect.items;this.color.a=0},function(){this._49=function(c){var b=this.props;if(this._21!==c.worldPropsUpdateId||b.isUpdated()){this._21=c.worldPropsUpdateId;this._28(b,c);this.positionCache[0]=this.matrixCache[6];this.positionCache[1]=this.matrixCache[7];this.volumeCache[0]=1/_m.abs(this.matrixCache[0]);this.volumeCache[1]=1/_m.abs(this.matrixCache[4])}}});AGL.Image=c4(AGL.Item,function a(d){AGL.Item.call(this);cnst(this,"type","drawable");this.textureMatrixCache=AGL.Matrix3.identity();this.mask=null;this.tintType=AGL.Image.Tint.NORMAL;this.blendMode=AGL.BlendModes.NORMAL;this.textureProps=new AGL.TextureProps();this.textureCrop=new AGL.TextureCrop();this.textureCropCache=this.textureCrop.items;this.texture=d},function(){this.mouseOver=function(){};this.update=function(){this._49();this._3()};this._49=function(){var b=this.props;b.isUpdated()&&this._28(b,this.matrixCache)};this._3=function(){var e=this.textureProps;e.isUpdated()&&this._28(e,this.textureMatrixCache)};this._28=function(b,c){AGL.Matrix3.transformLocal(b.x,b.y,b.rotation,b.anchorX,b.anchorY,b.scaledWidth,b.scaledHeight,c)}});cnst(AGL.Image,"TYPE","drawable");cnst(AGL.Image,"Tint",{"NORMAL":0,"GRAYSCALE":1,"OVERRIDE":2,});AGL.AnimatedImage=c4(AGL.Image,function g(c){AGL.Image.call(this,c);this.frameLength=120;this.frame=0;this.frames=[];this.isPlaying=!1;this._35=-1},function(b){this.gotoAndStop=function(a){this.frame=a};this.gotoAndPlay=function(a){this.frame=a;this.play()};this.stop=function(){this.isPlaying=!1};this.play=function(){this.isPlaying=!0};this.update=function(d){this.updateAnimation(d);b.update.call(this)};this.updateAnimation=function(d){if(this.isPlaying){var f=d-this._35;if(f>=this.frameLength){this._35=d;this.frame+=_m.floor(f/this.frameLength);this.frame>=this.frames.length&&(this.frame=0);var h=this.frames[this.frame];var e=this.textureCrop;e.x=h.x;e.y=h.y;e.width=h.width;e.height=h.height}}};this.destruct=function(){this.stop();b.destruct.call(this)}});AGL.Container=c4(AGL.Item,function h(){AGL.Item.call(this);cnst(this,"type","container");this._21=-1;this._31=-1;this._81=[];this.worldPropsUpdateId=this.worldColorUpdateId=0;this.colorCache=[1,1,1,1]},function(){get(this,"children",function(){return this._81});get(this,"numChildren",function(){return this._81.length});this.clear=function(){while(this.numChildren)this.removeChildAt(0)};this.contains=function(a){return this.getChildIndex(a)>-1};this.addChild=function(a){return this.addChildAt(a,this.numChildren)};this.addChildAt=function(a,b){if(!a)return null;if(a.parent)a.parent.removeChild(a);this._81.push(a);this.setChildIndex(a,b);a.parent=this;return a};this.removeChild=function(a){if(!a||!this.contains(a))return null;_children.remove(a);a.parent=null;return a};this.removeChildAt=function(b){return this.removeChild(this.getChildAt(b))};this.getChildAt=function(b){return this._81[b]};this.setChildIndex=function(a,b){if(!a||b<0)return null;this._81.remove(a);this._81.splice(b,0,a);return a};this.getChildIndex=function(a){return this._81.indexOf(a)};this.swapChildren=function(e,f){var j=this.getChildIndex(e);var k=this.getChildIndex(f);if(j===-1||k===-1)return!1;this.setChildIndex(e,k);this.setChildIndex(f,j);return!0};this.update=function(i,g){this._49(g);this._53(g)};this._49=function(g){var c=this.props;if(this._21!==g.worldPropsUpdateId||c.isUpdated()){this._21=g.worldPropsUpdateId;this.worldPropsUpdateId++;this._28(c,g)}};this._53=function(g){var d=this.color;if(this._31!==g.worldColorUpdateId||d.isUpdated()){this._31=g.worldColorUpdateId;this.worldColorUpdateId++;var l=g.colorCache;this.colorCache[0]=l[0]*d.r;this.colorCache[1]=l[1]*d.g;this.colorCache[2]=l[2]*d.b;this.colorCache[3]=l[3]*d.a}}});cnst(AGL.Container,"TYPE","container");AGL.BaseRenderer=c4(AGL.Container,function E(s,D,G,y,k){AGL.Container.call(this);this.clearColor=new AGL.ColorProps();this._18=10000;this._98=0;this._92=0;this._78=0;this._52=-1;this._76=0;this._15=AGL.BlendModes.NORMAL;this._57=0;this._59=[];this._60=[];this._0=!1;this._88=k;this._94=s;this._85=null;this._100=this.context;this._100.pixelStorei(this._100.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);this._100.enable(this._100.BLEND);var t=AGL.Utils.createProgram(this._100,[AGL.Utils.loadVertexShader(this._100,D(this._88)),AGL.Utils.loadFragmentShader(this._100,G(this._88))]);this._65=AGL.Utils.getLocationsFor(this._100,t,Object.assign(y||{},{"a_pos":"getAttribLocation","a_mat":"getAttribLocation","a_worldMat":"getAttribLocation","a_texMat":"getAttribLocation","a_texCrop":"getAttribLocation","u_tex":"getUniformLocation",}));this._100.useProgram(t);this._42();var F=this._100.createBuffer();this._100.bindBuffer(this._100.ARRAY_BUFFER,F);this._100.bufferData(this._100.ARRAY_BUFFER,new Float32Array([0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0]),this._100.STATIC_DRAW);this._100.vertexAttribPointer(this._65["a_pos"],2,this._100.FLOAT,!1,0,0);this._100.enableVertexAttribArray(this._65["a_pos"]);var C=this._100.createBuffer();this._100.bindBuffer(this._100.ELEMENT_ARRAY_BUFFER,C);this._100.bufferData(this._100.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),this._100.STATIC_DRAW);this._62=new Float32Array(this._18*9);this._37=this._44(this._62,"a_mat",9,3,3,this._100.FLOAT,4);this._13=new Float32Array(this._18*9);this._9=this._44(this._62,"a_worldMat",9,3,3,this._100.FLOAT,4);this._5=new Float32Array(this._18*9);this._1=this._44(this._5,"a_texMat",9,3,3,this._100.FLOAT,4);this._16=new Float32Array(this._18*4);this._6=this._44(this._16,"a_texCrop",4,1,4,this._100.FLOAT,4);this._20={};this._20["item"]=emptyFunction;this._20["drawable"]=this._63.bind(this);this._20["container"]=this._32.bind(this);this._95=this._49=emptyFunction;this._87()},function(){get(this,"canvas",function(){return this._94});get(this,"stage",function(){return this});get(this,"context",function(){if(!this._85||(this._85.isContextLost&&this._85.isContextLost())){this._85=this._94.getContext("webgl2",this._88.contextAttributes)};return this._85});prop(this,"width",{get:function(){return this._98},set:function(v){if(this._98!==v){this._98=v;this._78++}}});prop(this,"height",{get:function(){return this._92},set:function(v){if(this._92!==v){this._92=v;this._78++}}});this.setSize=function(g,q){this.width=g;this.height=q};this.render=function(){this._87();this._89()};this._89=function(){this.clear();this._48=Date.now();this._32(this);this._57>0&&this._66();++this._76};this.clear=function(){var A=this.clearColor;A.isUpdated()&&this._100.clearColor(A.r,A.g,A.b,A.a);this._100.clear(this._100.COLOR_BUFFER_BIT)};this._80=function(e,r){if(!e.renderable)return;e.update(this._48,r);e.type!=="item"&&this._20[e.type](e,r)};this._32=function(x){var w=x.children;var i;var l;for(i=0,l=w.length;i<l;++i)this._80(w[i],x)};this._22=function(e){if(this._15!==e.blendMode){this._66();this._15=e.blendMode;this._42()}};this._64=function(e,r,H,h,o){arraySet(this._13,r.matrixCache,h);arraySet(this._62,e.matrixCache,h);arraySet(this._5,e.textureMatrixCache,h);arraySet(this._16,e.textureCropCache,o)};this._63=function(e,r){this._22(e);var H=this._83(e.texture);this._64(e,r,H,this._57*9,this._57*4);++this._57===this._18&&this._66()};this._44=function(c,z,n,b,f,d,j){var p=this._100.createBuffer();this._100.bindBuffer(this._100.ARRAY_BUFFER,p);this._100.bufferData(this._100.ARRAY_BUFFER,c.byteLength,this._100.DYNAMIC_DRAW);this._54(this._65[z],p,c,n,b,f,d,j);return p};this._54=function(u,p,c,n,b,f,d,j){this._67(p,c);var m=j*n;var i=b+1;while(--i){var a=u+(b-i);this._100.enableVertexAttribArray(a);this._100["vertexAttrib"+(d===this._100.FLOAT?"":"I")+"Pointer"](a,f,d,!1,m,(b-i)*j*f);this._100.vertexAttribDivisor(a,1)}};this._67=function(p,c){this._100.bindBuffer(this._100.ARRAY_BUFFER,p);this._100.bufferSubData(this._100.ARRAY_BUFFER,0,c)};this._75=function(){this._67(this._37,this._62);this._67(this._9,this._13);this._67(this._1,this._5);this._67(this._6,this._16)};this._66=function(){if(this._0){this._0=!1;var I=new Uint16Array(this._60);this._100.uniform1iv(this._65["u_tex"],I)};this._75();this._100.drawElementsInstanced(this._100.TRIANGLE_FAN,6,this._100.UNSIGNED_SHORT,0,this._57);this._57=0};this._83=function(B){if(!B.loaded)return 0;var H=this._59.indexOf(B);if(H===-1||B.autoUpdate(this._76)){if(H===-1){if(this._59.length===this._88.textureNum){this._66();this._60.length=this._59.length=0};this._59.push(B);H=this._59.length-1;this._60.push(H);this._0=!0};AGL.Utils.useTexture(this._100,H,B)};return H+1};this._42=function(){this._100[this._15.funcName](this._100[this._15.funcs[0]],this._100[this._15.funcs[1]],this._100[this._15.funcs[2]],this._100[this._15.funcs[3]])};this._87=function(){if(this._78===this._52)return!1;this._52=this._78;this._94.width=this._98;this._94.height=this._92;this._100.viewport(0,0,this._100.drawingBufferWidth,this._100.drawingBufferHeight);AGL.Matrix3.projection(this._98,this._92,this.matrixCache);this.worldPropsUpdateId++;return!0}});AGL.BaseRenderer.createVertexShader=function(){return"#version 300 es\nin vec2 a_pos;in mat3 a_mat;in mat3 a_worldMat;in mat3 a_texMat;in vec4 a_texCrop;out vec2 v_texCoord;out vec2 v_texCrop;out vec2 v_texCropSize;void main(void){vec3 pos=vec3(a_pos,1.0);gl_Position=vec4((a_worldMat*a_mat*pos).xy,0.0,1.0);v_texCoord=(a_texMat*pos).xy;v_texCrop=a_texCrop.xy;v_texCropSize=a_texCrop.zw-a_texCrop.xy;}"};AGL.BaseRenderer.createFragmentShader=function(){return"#version 300 es\nprecision lowp float;in vec2 v_texCoord;in vec2 v_texCrop;in vec2 v_texCropSize;out vec4 fgCol;void main(void){fgCol=vec4(1.0,0.0,1.0,1.0);}"};AGL.SimpleRenderer=c4(AGL.BaseRenderer,function k(c,j,l,d){AGL.BaseRenderer.call(this,c,j,l,{"a_texId":"getAttribLocation",},d);this._70=new Float32Array(this._18);this._51=this._44(this._70,"a_texId",1,1,1,this._100.FLOAT,4)},function(e){this._64=function(a,f,m,b,g){e._64.call(this,a,f,m,b,g);this._70[this._57]=m};this._75=function(){e._75.call(this);this._67(this._51,this._70)}});AGL.SimpleRenderer.createVertexShader=function(){var h="#version 300 es\nin vec2 a_pos;in mat3 a_mat;in mat3 a_worldMat;in mat3 a_texMat;in vec4 a_texCrop;in float a_texId;out vec2 v_texCoord;out vec2 v_texCrop;out vec2 v_texCropSize;out float v_texId;void main(void){vec3 pos=vec3(a_pos,1.0);gl_Position=vec4((a_worldMat*a_mat*pos).xy,0.0,1.0);v_texCoord=(a_texMat*pos).xy;v_texCrop=a_texCrop.xy;v_texCropSize=a_texCrop.zw-a_texCrop.xy;v_texId=a_texId;}";return h};AGL.SimpleRenderer.createFragmentShader=function(d){var n=d.textureNum;var h="#version 300 es\n#define MAX_TEXTURES "+n+"\nprecision lowp float;in vec2 v_texCoord;in vec2 v_texCrop;in vec2 v_texCropSize;in float v_texId;uniform sampler2D u_tex[MAX_TEXTURES];out vec4 fgCol;";h+="void main(void){";for(var i=-1;i<n;i++){h+=(i>-1?" else ":"")+"if(v_texId<"+(i+1)+".5){";h+="fgCol="+(i<0?"vec4(0.0,0.0,0.0,0.0);":"texture(u_tex["+i+"],v_texCrop+v_texCropSize*fract(v_texCoord));");h+="}"};h+="}";return h};AGL.MaskRenderer=c4(AGL.SimpleRenderer,function d(a,e,f,b){AGL.SimpleRenderer.call(this,a,e,f,b);this.clearColor.r=this.clearColor.g=this.clearColor.b=this.clearColor.a=0});AGL.MaskRenderer.createVertexShader=AGL.SimpleRenderer.createVertexShader;AGL.MaskRenderer.createFragmentShader=function(b){var g=b.textureNum;var c="#version 300 es\n#define MAX_TEXTURES "+g+"\nprecision lowp float;in vec2 v_texCoord;in vec2 v_texCrop;in vec2 v_texCropSize;in float v_texId;uniform sampler2D u_tex[MAX_TEXTURES];out vec4 fgCol;";c+="void main(void){";for(var i=-1;i<g;i++){c+=(i>-1?" else ":"")+"if(v_texId<"+(i+1)+".5){";c+=i<0?"fgCol=vec4(0.0,0.0,0.0,0.0);":"vec4 col=texture(u_tex["+i+"],v_texCrop+v_texCropSize*fract(v_texCoord));fgCol=vec4(vec3(1.0)*((col.r+col.g+col.b)/3.0),col.a);";c+="}"};c+="}";return c};AGL.Stage2D=c4(AGL.BaseRenderer,function q(g,o,p,h){AGL.BaseRenderer.call(this,g,o,p,{"a_fillCol":"getAttribLocation","a_tintCol":"getAttribLocation","a_fx":"getAttribLocation","u_res":"getUniformLocation","u_lightPos":"getUniformLocation","u_lightVol":"getUniformLocation","u_lightCol":"getUniformLocation","u_lightFX":"getUniformLocation","u_lightZIndices":"getUniformLocation","u_fog":"getUniformLocation","u_filters":"getUniformLocation",},h);this.fog=new AGL.ColorProps();this.fog.a=0;this.colorCache=this.color.items;this._50=[0,0];this._36=[0,0,0,0];this._71=0;this._61=0;this._23=[];this._86;this._47=!1;this._14=new Float32Array([0,0,1]);this._73=new Float32Array(6);this._11=new Float32Array(6);if(this._88.isLightEnabled){this._25=new Float32Array(this._88.lightNum*2);this._38=new Float32Array(this._88.lightNum*2);this._45=new Float32Array(this._88.lightNum*4);this._34=new Float32Array(this._88.lightNum*4);this._26=new Int32Array(this._88.lightNum)};this._8=this._88.isLightEnabled?this._30.bind(this):emptyFunction;this._68=new Float32Array(this._18*4);this._46=this._44(this._68,"a_fillCol",4,1,4,this._100.FLOAT,4);this._33=new Float32Array(this._18*4);this._19=this._44(this._33,"a_tintCol",4,1,4,this._100.FLOAT,4);this._39=(this._88.isMaskEnabled?4:3);this._58=new Float32Array(this._18*this._39);this._41=this._44(this._58,"a_fx",this._39,1,this._39,this._100.FLOAT,4);this._17=this._88.isMaskEnabled?this._43.bind(this):emptyFunction;this._27=0;this._87()},function(e){set(this,"filters",function(f){this._88.filters&&this._88.filters.length>0&&this._100.uniform1i(this._65["u_filters"],f)});get(this,"picked",function(){return this._86});this.render=function(){this._87();this._86=null;this._27=0;this._53();this._72();this._8();this._89();this._47=!1};this.isLightAttached=function(d){return this._23.has(d)};this.attachLight=function(d){!this.isLightAttached(d)&&this._23.length<this._88.lightNum&&this._23.push(d)};this.detachLight=function(d){this._23.remove(d)};this.setPickerPoint=function(x,y){this._47=!0;this._14[0]=(x-this._71)*this.matrixCache[0];this._14[1]=(y-this._61)*this.matrixCache[4]};this._72=function(){this.fog.isUpdated()&&this._100.uniform4fv(this._65["u_fog"],this.fog.items)};this._30=function(){var d;var b;var m;var i;var l;for(i=0,l=this._88.lightNum;i<l;++i){b=i*2;m=i*4;if(i>=this._23.length||!this._23[i].renderable){arraySet(this._25,this._50,b);arraySet(this._38,this._50,b);arraySet(this._45,this._36,m);arraySet(this._34,this._36,m);this._26[i]=-1}else{d=this._23[i];arraySet(this._25,d.positionCache,b);arraySet(this._38,d.volumeCache,b);arraySet(this._45,d.colorCache,m);arraySet(this._34,d.effectCache,m);this._26[i]=d.props.zIndex}};d=null;this._100.uniform2fv(this._65["u_lightPos"],this._25);this._100.uniform2fv(this._65["u_lightVol"],this._38);this._100.uniform4fv(this._65["u_lightCol"],this._45);this._100.uniform4fv(this._65["u_lightFX"],this._34);this._100.uniform1fv(this._65["u_lightZIndices"],this._26)};this._80=function(a,j){if(!a.renderable)return;a.props.zIndex=++this._27;a.update(this._48,j);a.type!=="item"&&this._20[a.type](a,j)};this._43=function(a){a.mask&&(this._58[this._57*this._39+3]=this._83(a.mask))};this._64=function(a,j,s,c,m,n){e._64.call(this,a,j,s,c,m);arraySet(this._68,j.colorCache,m);arraySet(this._33,a.colorCache,m);this._58[n]=s;this._58[n+1]=a.tintType;this._58[n+2]=a.props.zIndex};this._63=function(a,j){this._22(a);if(this._47&&a.interactive&&AGL.Matrix3.isPointInMatrix(this._14,j.matrixCache,a.matrixCache,this._73,this._11))this._86=a;this._17(a);var s=this._83(a.texture);this._64(a,j,s,this._57*9,this._57*4,this._57*this._39);++this._57===this._18&&this._66()};this._75=function(){e._75.call(this);this._67(this._46,this._68);this._67(this._19,this._33);this._67(this._41,this._58)};this._87=function(){if(e._87.call(this)){this._71=this._98*0.5;this._61=this._92*0.5;this._100.uniform2f(this._65["u_res"],this._98/this._92,100/this._98)}};this._53=function(){this.color.isUpdated()&&this.worldColorUpdateId++}});AGL.Stage2D.MAX_LIGHT_SOURCES=16;AGL.Stage2D.Filters={"NONE":0,"GRAYSCALE":1,"SEPIA":2,"INVERT":4,"COLORLIMIT":8,"VIGNETTE":16,"RAINBOW":32,"LINES":64,};AGL.Stage2D.createVertexShader=function(h){var r=h.lightNum;var k="#version 300 es\n";if(h.isLightEnabled){k+="#define MAX_LIGHT_SOURCES "+r+"\n"};k+="in vec2 a_pos;in mat3 a_mat;in mat3 a_worldMat;in mat3 a_texMat;in vec4 a_texCrop;in vec4 a_fillCol;in vec4 a_tintCol;in vec"+(h.isMaskEnabled?"4":"3")+" a_fx;";k+="uniform vec2 u_res;uniform vec4 u_fog;";if(h.isLightEnabled){k+="uniform vec2 u_lightPos[MAX_LIGHT_SOURCES];uniform vec2 u_lightVol[MAX_LIGHT_SOURCES];uniform vec4 u_lightCol[MAX_LIGHT_SOURCES];uniform vec4 u_lightFX[MAX_LIGHT_SOURCES];uniform float u_lightZIndices[MAX_LIGHT_SOURCES];"};k+="out vec2 v_texCoord;out vec4 v_coord;out vec2 v_texCrop;out vec2 v_texCropSize;out vec4 v_fillCol;out vec4 v_tintCol;out float v_texId;out float v_tintType;out float v_colMult;out vec4 v_fogCol;";if(h.isMaskEnabled)k+="out float v_maskTexId;";if(h.isLightEnabled){k+="vec4 lightVal(vec4 pos,vec2 lightPos,vec2 lightVol,vec4 lightCol,vec4 lightFX){vec2 dist=pos.xy-lightPos;return lightCol*lightCol.a*max(0.0,min(1.0,1.0-sqrt(pow(abs(dist.x+(abs(dist.x)*lightFX.x)),lightFX.z)*(lightVol.x/u_res.y)+pow(abs(dist.y+(abs(dist.y)*lightFX.y)),lightFX.w)*(lightVol.y/u_res.x/u_res.y))));}"};k+="void main(void){vec3 pos=vec3(a_pos,1.0);gl_Position=vec4((a_worldMat*a_mat*pos).xy,0.0,1.0);v_texCoord=(a_texMat*pos).xy;v_coord=gl_Position;v_texCrop=a_texCrop.xy;v_texCropSize=a_texCrop.zw-a_texCrop.xy;v_fillCol=a_fillCol;v_tintCol=a_tintCol;v_texId=a_fx.x;v_tintType=a_fx.y;";k+="vec4 lightCol=vec4(0.0);";if(h.isLightEnabled){for(var i=0;i<r;i++){k+="if(u_lightCol["+i+"].a>0.0 && u_lightZIndices["+i+"]>a_fx.z){lightCol+=lightVal(v_coord,u_lightPos["+i+"],u_lightVol["+i+"],u_lightCol["+i+"],u_lightFX["+i+"]);}"}};k+="float colLightMult=max(0.0,u_fog.a-lightCol.a);v_colMult=max(0.0,1.0-colLightMult);v_fogCol=vec4(u_fog.rgb*colLightMult,0.0);v_fillCol+=lightCol;";if(h.isMaskEnabled)k+="v_maskTexId=a_fx.w;";k+="}";return k};AGL.Stage2D.createFragmentShader=function(h){var t=h.textureNum;var k="#version 300 es\n#define MAX_TEXTURES "+t+"\n";k+="precision lowp float;in vec4 v_coord;in vec2 v_texCoord;in vec2 v_texCrop;in vec2 v_texCropSize;in vec4 v_fillCol;in vec4 v_tintCol;in float v_texId;in float v_tintType;in float v_colMult;in vec4 v_fogCol;";if(h.isMaskEnabled)k+="in float v_maskTexId;";k+="uniform sampler2D u_tex[MAX_TEXTURES];";if(h.isFilterEnabled)k+="uniform int u_filters;";k+="out vec4 fgCol;";k+="void main(void){";if(h.isMaskEnabled){k+="float maskAlpha=1.0;if(v_maskTexId>0.0){";for(var i=0;i<t;i++){k+=(i>0?" else ":"")+"if(v_maskTexId<"+(i+1)+".5){maskAlpha=texture(u_tex["+i+"],(v_coord.xy+vec2(1.0,-1.0))/vec2(2.0,-2.0)).r;if(maskAlpha==0.0) discard;}"};k+="}"};for(var i=-1;i<t;i++){k+=(i>-1?" else ":"")+"if(v_texId<"+(i+1)+".5){";k+="fgCol="+(i<0?"vec4(0.0,0.0,0.0,0.0);":"texture(u_tex["+i+"],v_texCrop+v_texCropSize*fract(v_texCoord));");k+="if(fgCol.a==0.0) discard;}"};k+="if(fgCol.a>0.0){if(v_tintType<0.5) fgCol*=v_tintCol;else if(v_tintType<1.5 && fgCol.r==fgCol.g && fgCol.r==fgCol.b) fgCol*=v_tintCol;else if(v_tintType<2.5) fgCol=vec4((fgCol.rgb*(1.0-v_tintCol.a))+(v_tintCol.rgb*v_tintCol.a),fgCol.a);";k+="vec4 finalCol=vec4(fgCol.rgb*v_colMult,fgCol.a);fgCol=(finalCol*v_fillCol)+v_fogCol;";if(h.isFilterEnabled){k+="if(u_filters>0 && fgCol.a>0.0){";for(var i=0;i<h.filters.length;i++){k+="if(("+h.filters[i]+" & u_filters)>0){";switch(h.filters[i]){case AGL.Stage2D.Filters.GRAYSCALE:k+="fgCol=vec4(vec3(1.0)*((fgCol.r+fgCol.g+fgCol.b)/3.0),fgCol.a);";break;case AGL.Stage2D.Filters.SEPIA:k+="fgCol=vec4(vec3(0.874,0.514,0.156)*((fgCol.r+(fgCol.g+fgCol.b))/3.0),fgCol.a);";break;case AGL.Stage2D.Filters.INVERT:k+="fgCol=abs(vec4(fgCol.rgb-1.0,fgCol.a));";break;case AGL.Stage2D.Filters.COLORLIMIT:k+="fgCol=vec4((floor((fgCol.rgb*256.0)/32.0)/256.0)*32.0,fgCol.a);";break;case AGL.Stage2D.Filters.VIGNETTE:k+="float vignetteValue=(1.0-sqrt(pow(v_coord.x,4.0)+pow(v_coord.y,4.0)));fgCol*=vec4(vec3(vignetteValue),1);";break;case AGL.Stage2D.Filters.RAINBOW:k+="fgCol+=vec4(v_coord.x*0.15,v_coord.y*0.15,(v_coord.x-v_coord.y)*0.15,0);";break;case AGL.Stage2D.Filters.LINES:k+="fgCol+=vec4(sin(v_coord.y*500.0)*0.2);";break};k+="}"};k+="}"};if(h.isMaskEnabled)k+="fgCol.a*=maskAlpha;";k+="}}";return k};}).call({});