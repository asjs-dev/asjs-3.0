(function(){var $_=["_currentScaledHeightUpdateId","_currentSinRotationUpdateId","_currentCosRotationUpdateId","_currentScaledWidthUpdateId","_currentWorldColorUpdateId","_currentWorldPropsUpdateId","_textureIdBufferUpdated","enableVertexAttribArray","_clearBeforeRenderFunc","_currentResizeUpdateId","_scaledHeightUpdateId","_sourceHeightProperty","ELEMENT_ARRAY_BUFFER","_textureMatrixBuffer","createFragmentShader","maxTextureImageUnits","_sourceWidthProperty","_scaledWidthUpdateId","_onTextureLoadedBind","AbstractColorFilter","vertexAttribPointer","_framebufferTexture","_updateTextureProps","createFunctionality","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","_currentRenderTime","worldColorUpdateId","_clearBeforeRender","createVertexShader","_textureMatrixData","worldPropsUpdateId","_attachArrayBuffer","loadFragmentShader","_collectLightsFunc","_createArrayBuffer","_worldMatrixBuffer","_textureCropBuffer","_tempInverseMatrix","textureMatrixCache","_rotationUpdateId","_parseTextureSize","_currentBlendMode","_tempPickerVector","loadVertexShader","_bindArrayBuffer","_worldMatrixData","_currentUpdateId","_textureCropData","_drawFunctionMap","_generateMipmap","_lightPositions","getLocationsFor","bindFramebuffer","_checkBlendMode","_resizeUpdateId","generateMipmap","AbstractFilter","RendererHelper","PostProcessing","isLightEnabled","_tintColorData","_textureIdData","_drawContainer","_setBufferData","_getSourceType","fragmentShader","SimpleRenderer","_transformItem","hasOwnProperty","_lightZIndices","_zIndexCounter","_lightVolumes","CLAMP_TO_EDGE","isMaskEnabled","texParameteri","_lightEffects","AbstractProps","_setBlendMode","createProgram","_resizeCanvas","_effectLength","setChildIndex","getChildIndex","_scaledHeight","_updateProps","ARRAY_BUFFER","createBuffer","BaseRenderer","TRIANGLE_FAN","_bindBuffers","_lightColors","vertexShader","_drawTexture","_updateColor","_cosRotation","getParameter","MaskRenderer","_framebuffer","_sinRotation","_isPickerSet","_batchItems","matrixCache","_effectData","_renderTime","_textureMap","_matrixData","bindTexture","removeChild","textureNum","_locations","colorCache","TEXTURE_2D","clearColor"];"use strict";Array.prototype.addUnique=function(item){this.indexOf(item)==-1&&this.push(item)};Array.prototype.has=function(item){return this.indexOf(item)>-1};Array.prototype.remove=function(item){var a=this.indexOf(item);a>-1&&this.splice(a,1)};Array.prototype.clone=function(){return this.slice(0)};Array.prototype.equal=function(arr){if(!arr||arr.length!==this.length)return!1;for(var i=0;i<this.length;i++){if(this[i]!==arr[i])return!1};return!0};var arraySet=function(target,source,from){var i=0;var l=source.length;while(i<l){target[from+i]=source[i];++i}};var _d=document;var _w=window;var _m=Math;var _crel=_d.createElement;var property=function(t,n,v){v.enumerable=!0;v.configurable=!0;Object.defineProperty(t,n,v)};var prop=property;var get=function(t,n,v){prop(t,n,{get:v})};var set=function(t,n,v){prop(t,n,{set:v})};var constant=function(t,n,v){prop(t,n,{value:v})};var cnst=constant;cnst(_w,"on","addEventListener");cnst(_w,"off","removeEventListener");cnst(_w,"offAll","removeEventListeners");cnst(_w,"de","dispatchEvent");cnst(_w,"has","hasEventListener");var empty=function(a){try{return a===undefined||a===null||a===""||a.length===0}catch(e){return!0}};var emp=empty;var map=function(o,cb){for(var k in o){if(!o[$_[69]](k))continue;var v=cb(k,o[k]);if(!emp(v))o[k]=v}};var emptyFunction=function(){};var ef=emptyFunction;var iterateOver=function(o,cb,ccb){if(emp(o))return b();var a=Object.keys(o);var k;var i=-1;function b(){ccb&&ccb()};function n(){i++;if(i===a.length){b();return};k=a[i];if(o[$_[69]]&&!o[$_[69]](k))n();var c;try{c=o[k]}catch(e){};var v=cb(k,c,n,b);if(!emp(v))o[k]=v};n()};var ito=iterateOver;var createPrototypeClass=function(parent,construct,body){var a=parent.prototype;var b=construct.prototype;Object.setPrototypeOf(construct,parent);Object.setPrototypeOf(b,a);b.constructor=construct;body&&body.call(b,a);return construct};var c4=createPrototypeClass;var deleteProperty=function(t,p){var a=Object.getOwnPropertyDescriptor(t,p);if(a&&(a.get||a.set))prop(t,p,{set:ef,get:ef});else{try{t[p]=null}catch(e){}};delete t[p]};var del=deleteProperty;var destructObjectFlat=function(t,stack){ito(t,function(a,b,c){del(t,a);c()});t=null};var destObjFlat=destructObjectFlat;var BasePrototypeClass=c4(Object,function a(){},function(){this.destruct=function(){destObjFlat(this)};this.toObject=function(){return JSON.parse(JSON.stringify(this))}});console.log("AGL 1.0");_w.AGL={};AGL.CreateConfig=function(options){var b="Maximum of ";if(options[$_[109]]===undefined||options[$_[109]]>AGL.Utils.info[$_[15]])options[$_[109]]=AGL.Utils.info[$_[15]];if(options.lightNum===undefined)options.lightNum=0;else if(options.lightNum>16)options.lightNum=16;var a=options.contextAttributes||{};return{"canvas":options.canvas,"locations":options.locations||{},"textureNum":options[$_[109]],"lightNum":options.lightNum,"isLightEnabled":options.lightNum>0,"isMaskEnabled":options[$_[74]],"vertexShader":options[$_[92]],"fragmentShader":options[$_[66]],"contextAttributes":{"alpha":a.alpha||!1,"antialias":a.antialias||!1,"depth":a.depth||!1,"stencil":a.stencil||!1,"premultipliedAlpha":a.premultipliedAlpha||!1,"powerPreference":a.powerPreference||"high-performance"}}};(function(){var f="ONE_MINUS_SRC_ALPHA";var g="ONE_MINUS_SRC_COLOR";var c="SRC_ALPHA";var d="DST_ALPHA";var a="ONE";function e(b){return{"funcName":b.length===2?"blendFunc":"blendFuncSeparate","funcs":b}};AGL.BlendModes={"NORMAL":e([c,f,a,f]),"ADD":e([c,d,a,d]),"MULTIPLY":e(["DST_COLOR",f]),"SCREEN":e([c,g,a,g]),"OVERLAY":e([a,f])};Object.freeze(AGL.BlendModes)})();AGL[$_[77]]=c4(BasePrototypeClass,function b(){BasePrototypeClass.call(this);this._id=-1;this[$_[47]]=-1},function(){this.isUpdated=function(){var a=this[$_[47]]<this._id;this[$_[47]]=this._id;return a}});AGL.ColorProps=c4(AGL[$_[77]],function a(){AGL[$_[77]].call(this);this.items=[1,1,1,1]},function(){prop(this,"r",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;++this._id}}});prop(this,"g",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;++this._id}}});prop(this,"b",{get:function(){return this.items[2]},set:function(v){if(this.items[2]!==v){this.items[2]=v;++this._id}}});prop(this,"a",{get:function(){return this.items[3]},set:function(v){if(this.items[3]!==v){this.items[3]=v;++this._id}}})});AGL.ItemProps=c4(AGL[$_[77]],function a(){AGL[$_[77]].call(this);this[$_[17]]=0;this[$_[3]]=-1;this[$_[10]]=0;this[$_[0]]=-1;this[$_[40]]=0;this[$_[1]]=-1;this[$_[2]]=-1;this._scaledWidth=1;this[$_[84]]=1;this[$_[99]]=0;this[$_[95]]=1;this._x=0;this._y=0;this._zIndex=0;this._rotation=0;this._scaleX=1;this._scaleY=1;this._width=1;this._height=1;this._anchorX=0;this._anchorY=0},function(){get(this,"scaledWidth",function(){if(this[$_[3]]!==this[$_[17]]){this[$_[3]]=this[$_[17]];this._scaledWidth=this._width*this._scaleX};return this._scaledWidth});get(this,"scaledHeight",function(){if(this[$_[0]]!==this[$_[10]]){this[$_[0]]=this[$_[10]];this[$_[84]]=this._height*this._scaleY};return this[$_[84]]});get(this,"sinR",function(){if(this[$_[1]]!==this[$_[40]]){this[$_[1]]=this[$_[40]];this[$_[99]]=_m.sin(this._rotation)};return this[$_[99]]});get(this,"cosR",function(){if(this[$_[2]]!==this[$_[40]]){this[$_[2]]=this[$_[40]];this[$_[95]]=_m.cos(this._rotation)};return this[$_[95]]});prop(this,"x",{get:function(){return this._x},set:function(v){if(this._x!==v){this._x=v;++this._id}}});prop(this,"y",{get:function(){return this._y},set:function(v){if(this._y!==v){this._y=v;++this._id}}});prop(this,"zIndex",{get:function(){return this._zIndex},set:function(v){this._zIndex!==v&&(this._zIndex=v)}});prop(this,"rotation",{get:function(){return this._rotation},set:function(v){if(this._rotation!==v){this._rotation=v;++this[$_[40]];++this._id}}});prop(this,"scaleX",{get:function(){return this._scaleX},set:function(v){if(this._scaleX!==v){this._scaleX=v;++this[$_[17]];++this._id}}});prop(this,"scaleY",{get:function(){return this._scaleY},set:function(v){if(this._scaleY!==v){this._scaleY=v;++this[$_[10]];++this._id}}});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;++this[$_[17]];++this._id}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;++this[$_[10]];++this._id}}});prop(this,"anchorX",{get:function(){return this._anchorX},set:function(v){if(this._anchorX!==v){this._anchorX=v;++this._id}}});prop(this,"anchorY",{get:function(){return this._anchorY},set:function(v){if(this._anchorY!==v){this._anchorY=v;++this._id}}})});AGL.LightEffectProps=c4(AGL[$_[77]],function a(){AGL[$_[77]].call(this);this.items=[0,0,2,2]},function(){prop(this,"anchorX",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;++this._id}}});prop(this,"anchorY",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;++this._id}}});prop(this,"quadX",{get:function(){return this.items[2]},set:function(v){if(this.items[2]!==v){this.items[2]=v;++this._id}}});prop(this,"quadY",{get:function(){return this.items[3]},set:function(v){if(this.items[3]!==v){this.items[3]=v;++this._id}}})});AGL.TextureCrop=c4(AGL[$_[77]],function a(){AGL[$_[77]].call(this);this._width=1;this._height=1;this.items=[0,0,1,1]},function(){prop(this,"x",{get:function(){return this.items[0]},set:function(v){if(this.items[0]!==v){this.items[0]=v;this._calcWidth();++this._id}}});prop(this,"y",{get:function(){return this.items[1]},set:function(v){if(this.items[1]!==v){this.items[1]=v;this._calcHeight();++this._id}}});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;this._calcWidth();++this._id}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;this._calcHeight();++this._id}}});this._calcWidth=function(){this.items[2]=this._width-this.items[0]};this._calcHeight=function(){this.items[3]=this._height-this.items[1]}});AGL.TextureProps=c4(AGL[$_[77]],function a(){AGL[$_[77]].call(this);this[$_[40]]=0;this[$_[1]]=-1;this[$_[2]]=-1;this[$_[99]]=0;this[$_[95]]=1;this._x=0;this._y=0;this._rotation=0;this._width=1;this._height=1;this._anchorX=0;this._anchorY=0},function(){get(this,"scaledWidth",function(){return this._width});get(this,"scaledHeight",function(){return this._height});get(this,"sinR",function(){if(this[$_[1]]!==this[$_[40]]){this[$_[1]]=this[$_[40]];this[$_[99]]=_m.sin(this._rotation)};return this[$_[99]]});get(this,"cosR",function(){if(this[$_[2]]!==this[$_[40]]){this[$_[2]]=this[$_[40]];this[$_[95]]=_m.cos(this._rotation)};return this[$_[95]]});prop(this,"x",{get:function(){return this._x},set:function(v){if(this._x!==v){this._x=v;++this._id}}});prop(this,"y",{get:function(){return this._y},set:function(v){if(this._y!==v){this._y=v;++this._id}}});prop(this,"rotation",{get:function(){return this._rotation},set:function(v){if(this._rotation!==v){this._rotation=v;++this[$_[40]];++this._id}}});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;++this._id}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;++this._id}}});prop(this,"anchorX",{get:function(){return this._anchorX},set:function(v){if(this._anchorX!==v){this._anchorX=v;++this._id}}});prop(this,"anchorY",{get:function(){return this._anchorY},set:function(v){if(this._anchorY!==v){this._anchorY=v;++this._id}}})});AGL.Matrix3={isPointInMatrix:function(j,b,a,l,o){l[0]=b[0]*a[0]+b[3]*a[1];l[1]=b[1]*a[0]+b[4]*a[1];l[2]=b[0]*a[3]+b[3]*a[4];l[3]=b[1]*a[3]+b[4]*a[4];l[4]=b[0]*a[6]+b[3]*a[7]+b[6];l[5]=b[1]*a[6]+b[4]*a[7]+b[7];var d=1/(l[0]*l[3]-l[2]*l[1]);o[0]=d*l[3];o[1]=-d*l[1];o[2]=-d*l[2];o[3]=d*l[0];o[4]=d*(l[2]*l[5]-l[3]*l[4]);o[5]=-d*(l[0]*l[5]-l[1]*l[4]);var x=j[0]*o[0]+j[1]*o[2]+o[4];var y=j[0]*o[1]+j[1]*o[3]+o[5];return x>=0&&y>=0&&x<=1&&y<=1},identity:function(){return new Float32Array([1,0,0,0,1,0,0,0,1,])},projection:function(n,p,k){k[0]=2/n;k[1]=0;k[2]=0;k[3]=0;k[4]=-2/p;k[5]=0;k[6]=-1;k[7]=1;k[8]=1},transformLocal:function(x,y,c,e,f,g,h,i,k){k[0]=e*h;k[1]=c*h;k[3]=-c*i;k[4]=e*i;k[6]=x-(f*k[0])-(g*k[3]);k[7]=y-(f*k[1])-(g*k[4])},transform:function(m,x,y,c,e,f,g,h,i,k){k[0]=(e*m[0])+(c*m[3]);k[1]=(e*m[1])+(c*m[4]);k[3]=(e*m[3])-(c*m[0]);k[4]=(e*m[4])-(c*m[1]);k[6]=-(f*k[0])-(g*k[3])+(x*m[0])+(y*m[3])+m[6];k[7]=-(f*k[1])-(g*k[4])+(x*m[1])+(y*m[4])+m[7];k[0]*=h;k[1]*=h;k[3]*=i;k[4]*=i}};Object.freeze(AGL.Matrix3);(function(){var c=c4(BasePrototypeClass,function c(){BasePrototypeClass.call(this);this.info={"isWebGl2Supported":!1};var h=_crel.call(_d,"canvas");var a;if(a=h.getContext("webgl2")){this.info.isWebGl2Supported=!0;this.info[$_[15]]=a[$_[96]](a.MAX_TEXTURE_IMAGE_UNITS);this.info.maxTextureSize=a[$_[96]](a.MAX_TEXTURE_SIZE);this.info.maxVertexAttributes=a[$_[96]](a.MAX_VERTEX_ATTRIBS);this.info.maxVaryingVectors=a[$_[96]](a.MAX_VARYING_VECTORS);this.info.maxVertexUniformVectors=a[$_[96]](a.MAX_VERTEX_UNIFORM_VECTORS);this.info.maxFragmentUniformComponents=a[$_[96]](a.MAX_FRAGMENT_UNIFORM_COMPONENTS);this.info.maxFragmentUniformVectors=a[$_[96]](a.MAX_FRAGMENT_UNIFORM_VECTORS);this.info.maxVaryingComponents=a[$_[96]](a.MAX_VARYING_COMPONENTS)}},function(){this.useTexture=function(a,e,q){a.activeTexture(a.TEXTURE0+e);a[$_[107]](q.target,q.texture);a.texImage2D(q.target,0,a.RGBA,q.width,q.height,0,a.RGBA,a.UNSIGNED_BYTE,q.source);a[$_[75]](q.target,a.TEXTURE_MAX_LEVEL,q.maxLevel);if(q[$_[56]]){a[$_[56]](q.target);a.flush()};a[$_[75]](q.target,a.TEXTURE_WRAP_S,q.wrapS);a[$_[75]](q.target,a.TEXTURE_WRAP_T,q.wrapT);if(q[$_[56]]){a[$_[75]](q.target,a[$_[25]],q.minFilter===a.LINEAR?a.LINEAR_MIPMAP_LINEAR:a.NEAREST_MIPMAP_NEAREST)}else{a[$_[75]](q.target,a[$_[25]],q.minFilter)};a[$_[75]](q.target,a[$_[25]],q.minFilter);a[$_[75]](q.target,a[$_[24]],q.magFilter)};this.loadShader=function(p,a,s){var g=a.createShader(a[p]);a.shaderSource(g,s);a.compileShader(g);var m=a.getShaderParameter(g,a.COMPILE_STATUS);if(!m){var n=a.getShaderInfoLog(g);console.log("Error compiling shader "+p+":"+n);a.deleteShader(g);return null};return g};this[$_[44]]=this.loadShader.bind(this,"VERTEX_SHADER");this[$_[33]]=this.loadShader.bind(this,"FRAGMENT_SHADER");this[$_[79]]=function(a,l,r,t){var j=a[$_[79]]();map(l,function(b,g){a.attachShader(j,g)});if(r){map(r,function(b,i){a.bindAttribLocation(j,t?t[b]:b,i)})};a.linkProgram(j);var f=a.getProgramParameter(j,a.LINK_STATUS);if(!f){var n=a.getProgramInfoLog(j);console.log("Error in program linking:"+n);a.deleteProgram(j);return null};a.flush();return j};this[$_[52]]=function(a,j,v){var o={};map(v,function(b,u){o[b]=a[u](j,b)});return o};this.unbindTexture=function(a,k){a[$_[107]](k.target,null)};this.destroyTexture=function(a,k){a[$_[107]](k.target,null);a.deleteTexture(k.texture)};this.isPowerOf2=function(d){return(d&(d-1))==0}});AGL.Utils=new c();Object.freeze(AGL.Utils)})();AGL.Texture=c4(BasePrototypeClass,function f(a,d){BasePrototypeClass.call(this);this._source;this[$_[18]]=this._onTextureLoaded.bind(this);this[$_[50]]=!1;this._loaded=!1;this.isVideo=!1;this.shouldUpdate=!1;this.texture=a.createTexture();this.maxLevel=10;this.target=a[$_[112]];this.wrapS=a[$_[73]];this.wrapT=a[$_[73]];this.minFilter=a.NEAREST;this.magFilter=a.NEAREST;this.source=d;this[$_[16]]="width";this[$_[11]]="height";this[$_[26]]=-1;this._eventType},function(e){get(this,"generateMipmap",function(){return this[$_[50]]});get(this,"loaded",function(){return this._loaded});get(this,"width",function(){return this._source[this[$_[16]]]});get(this,"height",function(){return this._source[this[$_[11]]]});prop(this,"source",{get:function(){return this._source},set:function(v){this._source&&this._source[off](this._eventType,this[$_[18]]);this._source=v;this.isVideo=this[$_[65]]()==="video";this._eventType=this.isVideo?"canplay":"load";this[$_[41]]();this._source[on](this._eventType,this[$_[18]])}});this.autoUpdate=function(h){var i=this[$_[26]]<h;this[$_[26]]=h;return i&&(this.shouldUpdate||(this.isVideo&&!this._source.paused))};this.destruct=function(){this._source&&this._source[off](this._eventType,this[$_[18]]);e.destruct.call(this)};this[$_[41]]=function(){this[$_[16]]="naturalWidth";this[$_[11]]="naturalHeight";if(!this._source[this[$_[16]]]){this[$_[16]]="videoWidth";this[$_[11]]="videoHeight"};if(!this._source[this[$_[16]]]){this[$_[16]]="width";this[$_[11]]="height"};this[$_[50]]=AGL.Utils.isPowerOf2(this.width)&&AGL.Utils.isPowerOf2(this.height);this._loaded=this[$_[65]]()==="canvas"||this.width>0&&this.height>0};this[$_[65]]=function(){return this._source.tagName.toLowerCase()};this._onTextureLoaded=this[$_[41]]});AGL.Texture.loadImage=function(a,src){var b=_crel.call(_d,"img");var g=new AGL.Texture(a,b);b.src=src;return g};AGL.Texture.loadVideo=function(a,src){var c=_crel.call(_d,"video");var g=new AGL.Texture(a,c);c.src=src;return g};AGL.Item=c4(BasePrototypeClass,function a(){BasePrototypeClass.call(this);cnst(this,"type","item");this.renderable=!0;this.interactive=!1;this[$_[102]]=AGL.Matrix3.identity();this.props=new AGL.ItemProps();this.color=new AGL.ColorProps();this[$_[111]]=this.color.items;this.parent=null},function(c){get(this,"stage",function(){return this.parent?this.parent.stage:null});this.destruct=function(){this.parent&&this.parent[$_[108]]&&this.parent[$_[108]](this);c.destruct.call(this)};this.update=function(e,d){this[$_[85]](d)};this[$_[85]]=function(d){var b=this.props;b.isUpdated()&&this[$_[68]](b,d)};this[$_[68]]=function(b,d){AGL.Matrix3.transform(d[$_[102]],b.x,b.y,b.sinR,b.cosR,b.anchorX,b.anchorY,b.scaledWidth,b.scaledHeight,this[$_[102]])}});cnst(AGL.Item,"TYPE","item");AGL.Light=c4(AGL.Item,function b(a,i,f,e,g,h){AGL.Item.call(this);this._on=!1;this[$_[5]]=-1;this._id=a;this._duoId=a*2;this._quadId=a*4;this[$_[51]]=i;this[$_[72]]=f;this[$_[91]]=e;this[$_[76]]=g;this[$_[70]]=h;this.effect=new AGL.LightEffectProps();this.effectCache=this.effect.items;this.color.a=0},function(){prop(this,"on",{get:function(){return this._on&&this.stage},set:function(v){this._on=v}});this[$_[85]]=function(d){var c=this.props;if(this[$_[5]]<d[$_[31]]||c.isUpdated()){if(this.on){this[$_[5]]=d[$_[31]];this[$_[68]](c,d);this[$_[51]][this._duoId]=this[$_[102]][6];this[$_[51]][this._duoId+1]=this[$_[102]][7];this[$_[72]][this._duoId]=1/_m.abs(this[$_[102]][0]);this[$_[72]][this._duoId+1]=1/_m.abs(this[$_[102]][4]);this[$_[70]][this._id]=this.props.zIndex;arraySet(this[$_[91]],this[$_[111]],this._quadId);arraySet(this[$_[76]],this.effectCache,this._quadId)}else this[$_[91]][this._quadId+3]=0}}});AGL.Image=c4(AGL.Item,function a(d){AGL.Item.call(this);cnst(this,"type","drawable");this[$_[39]]=AGL.Matrix3.identity();this.mask=null;this.tintType=AGL.Image.Tint.NORMAL;this.blendMode=AGL.BlendModes.NORMAL;this.textureProps=new AGL.TextureProps();this.textureCrop=new AGL.TextureCrop();this.textureCropCache=this.textureCrop.items;this.texture=d},function(){this.mouseOver=function(){};this.update=function(){this[$_[85]]();this[$_[22]]()};this[$_[85]]=function(){var b=this.props;b.isUpdated()&&this[$_[68]](b,this[$_[102]])};this[$_[22]]=function(){var e=this.textureProps;e.isUpdated()&&this[$_[68]](e,this[$_[39]])};this[$_[68]]=function(b,c){AGL.Matrix3.transformLocal(b.x,b.y,b.sinR,b.cosR,b.anchorX,b.anchorY,b.scaledWidth,b.scaledHeight,c)}});cnst(AGL.Image,"TYPE","drawable");cnst(AGL.Image,"Tint",{"NORMAL":0,"GRAYSCALE":1,"OVERRIDE":2,});AGL.AnimatedImage=c4(AGL.Image,function g(c){AGL.Image.call(this,c);this.frameLength=120;this.frame=0;this.frames=[];this.isPlaying=!1;this[$_[26]]=-1},function(b){this.gotoAndStop=function(a){this.frame=a};this.gotoAndPlay=function(a){this.frame=a;this.play()};this.stop=function(){this.isPlaying=!1};this.play=function(){this.isPlaying=!0};this.update=function(d){this.updateAnimation(d);b.update.call(this)};this.updateAnimation=function(d){if(this.isPlaying){var f=d-this[$_[26]];if(f>=this.frameLength){this[$_[26]]=d;this.frame+=_m.floor(f/this.frameLength);this.frame>=this.frames.length&&(this.frame=0);var h=this.frames[this.frame];var e=this.textureCrop;e.x=h.x;e.y=h.y;e.width=h.width;e.height=h.height}}};this.destruct=function(){this.stop();b.destruct.call(this)}});AGL.Container=c4(AGL.Item,function h(){AGL.Item.call(this);cnst(this,"type","container");this[$_[5]]=-1;this[$_[4]]=-1;this._children=[];this[$_[31]]=this[$_[27]]=0;this[$_[111]]=[1,1,1,1]},function(){get(this,"children",function(){return this._children});get(this,"numChildren",function(){return this._children.length});this.clear=function(){while(this.numChildren)this.removeChildAt(0)};this.contains=function(a){return this[$_[83]](a)>-1};this.addChild=function(a){return this.addChildAt(a,this.numChildren)};this.addChildAt=function(a,b){if(!a)return null;if(a.parent)a.parent[$_[108]](a);this._children.push(a);this[$_[82]](a,b);a.parent=this;return a};this[$_[108]]=function(a){if(!a||!this.contains(a))return null;_chldrn.remove(a);a.parent=null;return a};this.removeChildAt=function(b){return this[$_[108]](this.getChildAt(b))};this.getChildAt=function(b){return this._children[b]};this[$_[82]]=function(a,b){if(!a||b<0)return null;this._children.remove(a);this._children.splice(b,0,a);return a};this[$_[83]]=function(a){return this._children.indexOf(a)};this.swapChildren=function(e,f){var j=this[$_[83]](e);var k=this[$_[83]](f);if(j===-1||k===-1)return!1;this[$_[82]](e,k);this[$_[82]](f,j);return!0};this.update=function(i,g){this[$_[85]](g);this[$_[94]](g)};this[$_[85]]=function(g){var c=this.props;if(this[$_[5]]<g[$_[31]]||c.isUpdated()){this[$_[5]]=g[$_[31]];this[$_[31]]++;this[$_[68]](c,g)}};this[$_[94]]=function(g){var d=this.color;if(this[$_[4]]<g[$_[27]]||d.isUpdated()){this[$_[4]]=g[$_[27]];this[$_[27]]++;var l=g[$_[111]];this[$_[111]][0]=l[0]*d.r;this[$_[111]][1]=l[1]*d.g;this[$_[111]][2]=l[2]*d.b;this[$_[111]][3]=l[3]*d.a}}});cnst(AGL.Container,"TYPE","container");AGL[$_[58]]={"init":function(c){this._width=this._height=0;this[$_[55]]=0;this[$_[9]]=-1;this._canvas=c;this[$_[104]]=0;this._context=null;this._gl=this.context;this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);this._gl.enable(this._gl.BLEND)},"createFunctionality":function(c){get(this,"canvas",function(){return this._canvas});get(this,"context",function(){if(!this._context||(this._context.isContextLost&&this._context.isContextLost())){this._canvas[on]("webglcontextlost",function(a){console.log(a)});this._canvas[on]("webglcontextrestored",function(a){console.log(a)});this._canvas[on]("webglcontextcreationerror",function(a){console.log(a)});this._context=this._canvas.getContext("webgl2",this._config.contextAttributes)};return this._context});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;this[$_[55]]++}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;this[$_[55]]++}}});this.setSize=function(b,d){this.width=b;this.height=d};this.render=function(){this._preRender();this._render()};this._preRender=function(){this[$_[104]]=Date.now();this._resize()};this._render=function(){};this[$_[80]]=function(){if(this[$_[55]]===this[$_[9]])return!1;this[$_[9]]=this[$_[55]];this._canvas.width=this._width;this._canvas.height=this._height;this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight);return!0};this._resize=this[$_[80]]}};AGL[$_[88]]=c4(AGL.Container,function z(k){k[$_[92]]=k[$_[92]]||AGL[$_[88]][$_[29]];k[$_[66]]=k[$_[66]]||AGL[$_[88]][$_[14]];Object.freeze(k);AGL.Container.call(this);this[$_[113]]=new AGL.ColorProps();cnst(this,"_MAX_BATCH_ITEMS",10000);this[$_[28]]=!0;this[$_[8]]=this.clear.bind(this);this[$_[42]]=AGL.BlendModes.NORMAL;this[$_[101]]=0;this[$_[105]]=[];this._textureIds=[];this[$_[6]]=!1;this._config=k;AGL[$_[58]].init.call(this,k.canvas);var q=AGL.Utils[$_[79]](this._gl,[AGL.Utils[$_[44]](this._gl,k[$_[92]](k)),AGL.Utils[$_[33]](this._gl,k[$_[66]](k))]);this[$_[110]]=AGL.Utils[$_[52]](this._gl,q,Object.assign(k.locations,{"aPos":"getAttribLocation","aMat":"getAttribLocation","aWorldMat":"getAttribLocation","aTexMat":"getAttribLocation","aTexCrop":"getAttribLocation","uTex":"getUniformLocation",}));this._gl.useProgram(q);this[$_[78]]();var A=this._gl[$_[87]]();this._gl.bindBuffer(this._gl[$_[86]],A);this._gl.bufferData(this._gl[$_[86]],new Float32Array([0,0,1,0,1,1,0,1]),this._gl.STATIC_DRAW);this._gl[$_[20]](this[$_[110]]["aPos"],2,this._gl.FLOAT,!1,0,0);this._gl[$_[7]](this[$_[110]]["aPos"]);var y=this._gl[$_[87]]();this._gl.bindBuffer(this._gl[$_[12]],y);this._gl.bufferData(this._gl[$_[12]],new Uint16Array([0,1,2,0,2,3]),this._gl.STATIC_DRAW);this[$_[106]]=new Float32Array(10000*9);this._matrixBuffer=this[$_[35]](this[$_[106]],"aMat",9,3,3,this._gl.FLOAT,4);this[$_[46]]=new Float32Array(10000*9);this[$_[36]]=this[$_[35]](this[$_[106]],"aWorldMat",9,3,3,this._gl.FLOAT,4);this[$_[30]]=new Float32Array(10000*9);this[$_[13]]=this[$_[35]](this[$_[30]],"aTexMat",9,3,3,this._gl.FLOAT,4);this[$_[48]]=new Float32Array(10000*4);this[$_[37]]=this[$_[35]](this[$_[48]],"aTexCrop",4,1,4,this._gl.FLOAT,4);this[$_[49]]={};this[$_[49]]["item"]=emptyFunction;this[$_[49]]["drawable"]=this._drawImage.bind(this);this[$_[49]]["container"]=this[$_[63]].bind(this);this._update=this[$_[85]]=emptyFunction;this._resize()},function(){AGL[$_[58]][$_[23]].call(this);prop(this,"clearBeforeRender",{get:function(){return this[$_[28]]},set:function(v){this[$_[28]]=v;this[$_[8]]=v?this.clear.bind(this):emptyFunction}});get(this,"stage",function(){return this});this.clear=function(){var w=this[$_[113]];w.isUpdated()&&this._gl[$_[113]](w.r,w.g,w.b,w.a);this._gl.clear(this._gl.COLOR_BUFFER_BIT)};this._render=function(){this[$_[8]]();this[$_[63]](this);this[$_[101]]>0&&this._batchDraw()};this._drawItem=function(e,n){if(!e.renderable)return;e.update(this[$_[104]],n);e.type!=="item"&&this[$_[49]][e.type](e,n)};this[$_[63]]=function(t){var r=t.children;var i;var l;for(i=0,l=r.length;i<l;++i)this._drawItem(r[i],t)};this[$_[54]]=function(e){if(this[$_[42]]!==e.blendMode){this._batchDraw();this[$_[42]]=e.blendMode;this[$_[78]]()}};this[$_[64]]=function(e,n,B,g,m){arraySet(this[$_[46]],n[$_[102]],g);arraySet(this[$_[106]],e[$_[102]],g);arraySet(this[$_[30]],e[$_[39]],g);arraySet(this[$_[48]],e.textureCropCache,m)};this._drawImage=function(e,n){this[$_[54]](e);var B=this[$_[93]](e.texture);this[$_[64]](e,n,B,this[$_[101]]*9,this[$_[101]]*4);++this[$_[101]]===10000&&this._batchDraw()};this[$_[35]]=function(f,u,o,b,d,c,h){var j=this._gl[$_[87]]();this._gl.bindBuffer(this._gl[$_[86]],j);this._gl.bufferData(this._gl[$_[86]],f.byteLength,this._gl.DYNAMIC_DRAW);this[$_[32]](this[$_[110]][u],j,f,o,b,d,c,h);return j};this[$_[32]]=function(s,j,f,o,b,d,c,h){this[$_[45]](j,f);var p=h*o;var i=b+1;while(--i){var a=s+(b-i);this._gl[$_[7]](a);this._gl["vertexAttrib"+(c===this._gl.FLOAT?"":"I")+"Pointer"](a,d,c,!1,p,(b-i)*h*d);this._gl.vertexAttribDivisor(a,1)}};this[$_[45]]=function(j,f){this._gl.bindBuffer(this._gl[$_[86]],j);this._gl.bufferSubData(this._gl[$_[86]],0,f)};this[$_[90]]=function(){this[$_[45]](this._matrixBuffer,this[$_[106]]);this[$_[45]](this[$_[36]],this[$_[46]]);this[$_[45]](this[$_[13]],this[$_[30]]);this[$_[45]](this[$_[37]],this[$_[48]])};this._batchDraw=function(){if(this[$_[6]]){this[$_[6]]=!1;var C=new Uint16Array(this._textureIds);this._gl.uniform1iv(this[$_[110]]["uTex"],C)};this[$_[90]]();this._gl.drawElementsInstanced(this._gl[$_[89]],6,this._gl.UNSIGNED_SHORT,0,this[$_[101]]);this[$_[101]]=0};this[$_[93]]=function(x){if(!x.loaded)return 0;var B=this[$_[105]].indexOf(x);if(B===-1||x.autoUpdate(this[$_[104]])){if(B===-1){if(this[$_[105]].length===this._config[$_[109]]){this._batchDraw();this._textureIds.length=this[$_[105]].length=0};this[$_[105]].push(x);B=this[$_[105]].length-1;this._textureIds.push(B);this[$_[6]]=!0};AGL.Utils.useTexture(this._gl,B,x)};return B+1};this[$_[78]]=function(){this._gl[this[$_[42]].funcName](this._gl[this[$_[42]].funcs[0]],this._gl[this[$_[42]].funcs[1]],this._gl[this[$_[42]].funcs[2]],this._gl[this[$_[42]].funcs[3]])};this._resize=function(){if(!this[$_[80]]())return!1;AGL.Matrix3.projection(this._width,this._height,this[$_[102]]);this[$_[31]]++;return!0}});AGL[$_[88]][$_[29]]=function(){return"#version 300 es\nin vec2 aPos;in mat3 aMat;in mat3 aWorldMat;in mat3 aTexMat;in vec4 aTexCrop;out vec2 vTexCrd;out vec2 vTexCrop;out vec2 vTexCropSize;void main(void){vec3 pos=vec3(aPos,1);gl_Position=vec4((aWorldMat*aMat*pos).xy,0,1);vTexCrd=(aTexMat*pos).xy;vTexCrop=aTexCrop.xy;vTexCropSize=aTexCrop.zw;}"};AGL[$_[88]][$_[14]]=function(){return"#version 300 es\nprecision lowp float;in vec2 vTexCrd;in vec2 vTexCrop;in vec2 vTexCropSize;out vec4 fgCol;void main(void){fgCol=vec4(1);}"};AGL[$_[59]]=c4(BasePrototypeClass,function e(a){BasePrototypeClass.call(this);a[$_[92]]=a[$_[92]]||AGL[$_[59]][$_[29]];a[$_[66]]=a[$_[66]]||AGL[$_[59]][$_[14]];Object.freeze(a);this.texture=null;this.filters=[];this._config=a;AGL[$_[58]].init.call(this,a.canvas);var d=AGL.Utils[$_[79]](this._gl,[AGL.Utils[$_[44]](this._gl,a[$_[92]](a)),AGL.Utils[$_[33]](this._gl,a[$_[66]](a))]);this[$_[110]]=AGL.Utils[$_[52]](this._gl,d,Object.assign(a.locations,{"aPos":"getAttribLocation","uTex":"getUniformLocation","uDspTex":"getUniformLocation","uFlpY":"getUniformLocation","uFtrT":"getUniformLocation","uFtrST":"getUniformLocation","uFtrVal":"getUniformLocation","uTm":"getUniformLocation",}));this._gl.useProgram(d);var f=this._gl[$_[87]]();this._gl.bindBuffer(this._gl[$_[86]],f);this._gl.bufferData(this._gl[$_[86]],new Float32Array([0,0,1,0,1,1,0,1]),this._gl.STATIC_DRAW);this._gl[$_[20]](this[$_[110]]["aPos"],2,this._gl.FLOAT,!1,0,0);this._gl[$_[7]](this[$_[110]]["aPos"]);this._gl.bufferData(this._gl[$_[86]],new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,1,1,-1]),this._gl.STATIC_DRAW);this._gl.uniform1i(this[$_[110]]["uTex"],0);this._gl.uniform1i(this[$_[110]]["uDspTex"],2);this._resize()},function(){AGL[$_[58]][$_[23]].call(this);this._render=function(){if(!this.texture.loaded)return;this._gl.clear(this._gl.COLOR_BUFFER_BIT);AGL.Utils.useTexture(this._gl,0,this.texture);this._gl.uniform1f(this[$_[110]]["uFlpY"],1);this._gl.uniform1i(this[$_[110]]["uFtrT"],0);this._gl.uniform1f(this[$_[110]]["uTm"],(this[$_[104]]/10000)%10000);this._gl.drawArrays(this._gl[$_[89]],0,6);var i;var l=this.filters.length;for(i=0;i<l;++i){var b=this.filters[i];this._gl.uniform1i(this[$_[110]]["uTex"],0);this._gl.uniform1i(this[$_[110]]["uDspTex"],2);b.texture&&b.texture.loaded&&AGL.Utils.useTexture(this._gl,2,b.texture);b.updateFramebuffer(this._gl,this._width,this._height);this._gl[$_[53]](this._gl.FRAMEBUFFER,b.framebuffer);this._gl.uniform1f(this[$_[110]]["uFlpY"],-1);this._gl.uniform1fv(this[$_[110]]["uFtrVal"],b.values);this._gl.uniform1i(this[$_[110]]["uFtrT"],b.type);this._gl.uniform1i(this[$_[110]]["uFtrST"],b.subType);this._gl.drawArrays(this._gl[$_[89]],0,6);b[$_[107]](this._gl,0)};this._gl[$_[53]](this._gl.FRAMEBUFFER,null);this._gl.uniform1f(this[$_[110]]["uFlpY"],1);this._gl.uniform1i(this[$_[110]]["uFtrT"],0);this._gl.drawArrays(this._gl[$_[89]],0,6)}});AGL[$_[59]][$_[29]]=function(){return"#version 300 es\nin vec2 aPos;uniform float uFlpY;out vec2 vCrd;out vec2 vTexCrd;void main(void){gl_Position=vec4(aPos.xy,0,1);gl_Position.y*=uFlpY;vCrd=aPos;vTexCrd=(aPos+vec2(1,-1))/vec2(2,-2);}"};AGL[$_[59]][$_[14]]=function(){var c="#version 300 es\nprecision lowp float;\nuniform sampler2D uTex;uniform sampler2D uDspTex;uniform int uFtrT;uniform int uFtrST;uniform float uFtrVal[9];uniform float uTm;in vec2 vCrd;in vec2 vTexCrd;out vec4 fgCol;vec4 blur(vec4 oCol,float bx, float by,vec2 crd,vec2 oPx){vec4 col=oCol;float w=oPx.x*bx;float h=oPx.y*by;for(float i=-2.;i<3.;++i){for(float j=-2.;j<3.;++j){if(i!=0.&&j!=0.)col+=texture(uTex,crd+vec2(i*w,j*h));}}return col/25.;}vec4 glw(vec4 oCol,float bx, float by,vec2 crd,vec2 oPx){float oAvg=(oCol.r+oCol.g+oCol.b)/3.;vec4 col=oCol;float w=oPx.x*bx;float h=oPx.y*by;float c=1.;for(float i=-3.;i<4.;++i){for(float j=-3.;j<4.;++j){vec4 tCol=texture(uTex,crd+vec2(i*w,j*h));float avg=(tCol.r+tCol.g+tCol.b)/3.;if(avg>oAvg){col+=tCol;c++;}}}return col/c;}vec4 convMat(vec4 oCol,float v[9],vec2 crd,vec2 oPx){return (texture(uTex,crd-oPx)*v[0]+texture(uTex,crd+vec2(0,-oPx.y))*v[1]+texture(uTex,crd+vec2(oPx.x,-oPx.y))*v[2]+texture(uTex,crd+vec2(-oPx.x,0))*v[3]+oCol*v[4]+texture(uTex,crd+vec2(oPx.x,0))*v[5]+texture(uTex,crd+vec2(-oPx.x,oPx.y))*v[6]+texture(uTex,crd+vec2(0,oPx.y))*v[7]+texture(uTex,crd+oPx)*v[8])/9.;}vec4 pxlt(float v,vec2 crd,vec2 oPx){vec2 vol=v*oPx;return texture(uTex,floor(crd/vol)*vol);}void main(void){float[] fvl=uFtrVal;vec2 oSz=vec2(textureSize(uTex,0));vec2 oPx=vec2(1)/oSz;fgCol=texture(uTex,vTexCrd);if(uFtrT>0){if(uFtrT<2)fgCol=convMat(fgCol,fvl,vTexCrd,oPx);else if(uFtrT<3){if(uFtrST<2)fgCol=vec4(vec3((fgCol.r+fgCol.g+fgCol.b)/3.),fgCol.a);else if(uFtrST<3)fgCol=vec4(vec3(.874,.514,.156)*((fgCol.r+fgCol.g+fgCol.b)/3.),fgCol.a);else if(uFtrST<4)fgCol=abs(vec4(fgCol.rgb-1.,fgCol.a));else if(uFtrST<5)fgCol=vec4(fgCol.rgb*vec3(fvl[0],fvl[1],fvl[2]),fgCol.a);else if(uFtrST<6)fgCol=vec4((round((fgCol.rgb*256.)/fvl[0])/256.)*fvl[0],fgCol.a);else if(uFtrST<7)fgCol*=vec4(vec3((1.-sqrt(pow(vCrd.x,4.)+pow(vCrd.y,4.)))),1);else if(uFtrST<8)fgCol+=vec4(vCrd.xy*.15,(vCrd.x-vCrd.y)*.15,0);else if(uFtrST<9)fgCol*=vec4(.2+sin(vCrd.y*500.)*.5);else if(uFtrST<10)fgCol=vec4((fgCol.rgb-.5)*fvl[1]+.5+fvl[0],fgCol.a);else if(uFtrST<11)fgCol=vec4(pow(fgCol.rgb,vec3(fvl[0])),fgCol.a);}else if(uFtrT<4)fgCol=blur(fgCol,fvl[0],fvl[1],vTexCrd,oPx);else if(uFtrT<5)fgCol=pxlt(fvl[0],vTexCrd,oPx);else if(uFtrT<6)fgCol=glw(fgCol,fvl[0],fvl[1],vTexCrd,oPx);else if(uFtrT<7){vec2 dspMd=vec2(1,-1)*(texture(uDspTex,fract(vec2(1,-1)*vCrd*.5+vec2(.5)+uTm*vec2(fvl[1],fvl[2]))).rg-.5)*2.*oPx*fvl[0];vec2 mdPs=vTexCrd+dspMd;if(mdPs.x>=.0&&mdPs.y>=.0&&mdPs.x<=1.&&mdPs.y<=1.)fgCol=texture(uTex,mdPs);}}}";return c};AGL[$_[67]]=c4(AGL[$_[88]],function h(c){c[$_[92]]=c[$_[92]]||AGL[$_[67]][$_[29]];c[$_[66]]=c[$_[66]]||AGL[$_[67]][$_[14]];c.locations=Object.assign(c.locations,{"aTexId":"getAttribLocation",});AGL[$_[88]].call(this,c);this[$_[62]]=new Float32Array(10000);this._textureIdBuffer=this[$_[35]](this[$_[62]],"aTexId",1,1,1,this._gl.FLOAT,4)},function(d){this[$_[64]]=function(a,e,j,b,f){d[$_[64]].call(this,a,e,j,b,f);this[$_[62]][this[$_[101]]]=j};this[$_[90]]=function(){d[$_[90]].call(this);this[$_[45]](this._textureIdBuffer,this[$_[62]])}});AGL[$_[67]][$_[29]]=function(){var g="#version 300 es\nin vec2 aPos;in mat3 aMat;in mat3 aWorldMat;in mat3 aTexMat;in vec4 aTexCrop;in float aTexId;out vec2 vTexCrd;out vec2 vTexCrop;out vec2 vTexCropSize;out float vTexId;void main(void){vec3 pos=vec3(aPos,1);gl_Position=vec4((aWorldMat*aMat*pos).xy,0,1);vTexCrd=(aTexMat*pos).xy;vTexCrop=aTexCrop.xy;vTexCropSize=aTexCrop.zw;vTexId=aTexId;}";return g};AGL[$_[67]][$_[14]]=function(c){var k=c[$_[109]];var g="#version 300 es\nprecision lowp float;in vec2 vTexCrd;in vec2 vTexCrop;in vec2 vTexCropSize;in float vTexId;uniform sampler2D uTex["+k+"];out vec4 fgCol;";g+="void main(void){";for(var i=-1;i<k;i++){g+=(i>-1?" else ":"")+"if(vTexId<"+(i+1)+".5){";g+="fgCol="+(i<0?"vec4(0);":"texture(uTex["+i+"],vTexCrop+vTexCropSize*fract(vTexCrd));");g+="}"};g+="}";return g};AGL[$_[97]]=c4(AGL[$_[67]],function c(a){a[$_[92]]=a[$_[92]]||AGL[$_[97]][$_[29]];a[$_[66]]=a[$_[66]]||AGL[$_[97]][$_[14]];AGL[$_[67]].call(this,a);this[$_[113]].r=this[$_[113]].g=this[$_[113]].b=this[$_[113]].a=0});AGL[$_[97]][$_[29]]=AGL[$_[67]][$_[29]];AGL[$_[97]][$_[14]]=function(a){var d=a[$_[109]];var b="#version 300 es\nprecision lowp float;in vec2 vTexCrd;in vec2 vTexCrop;in vec2 vTexCropSize;in float vTexId;uniform sampler2D uTex["+d+"];out vec4 fgCol;";b+="void main(void){";for(var i=-1;i<d;i++){b+=(i>-1?" else ":"")+"if(vTexId<"+(i+1)+".5){";b+=i<0?"fgCol=vec4(0);":"vec4 col=texture(uTex["+i+"],vTexCrop+vTexCropSize*fract(vTexCrd));fgCol=vec4(1)*((col.r+col.g+col.b+col.a)/4.);";b+="}"};b+="}";return b};AGL.Stage2D=c4(AGL[$_[88]],function k(d){d[$_[92]]=d[$_[92]]||AGL.Stage2D[$_[29]];d[$_[66]]=d[$_[66]]||AGL.Stage2D[$_[14]];d.locations=Object.assign(d.locations,{"aFillCol":"getAttribLocation","aTintCol":"getAttribLocation","aFx":"getAttribLocation","uRes":"getUniformLocation","uLghtPos":"getUniformLocation","uLghtVol":"getUniformLocation","uLghtCol":"getUniformLocation","uLghtFX":"getUniformLocation","uLghtZIndices":"getUniformLocation","uFog":"getUniformLocation",});AGL[$_[88]].call(this,d);this.fog=new AGL.ColorProps();this.fog.a=0;this[$_[111]]=this.color.items;this._DEFAULT_DUO=[0,0];this._DEFAULT_QUAD=[0,0,0,0];this._widthHalf=0;this._heightHalf=0;this._lights=[];this._picked;this[$_[100]]=!1;this[$_[43]]=new Float32Array([0,0,1]);this._tempMatrix=new Float32Array(6);this[$_[38]]=new Float32Array(6);this[$_[34]]=emptyFunction;if(this._config[$_[60]]){this[$_[51]]=new Float32Array(this._config.lightNum*2);this[$_[72]]=new Float32Array(this._config.lightNum*2);this[$_[91]]=new Float32Array(this._config.lightNum*4);this[$_[76]]=new Float32Array(this._config.lightNum*4);this[$_[70]]=new Int32Array(this._config.lightNum);for(var i=0,l=this._config.lightNum;i<l;++i){this._lights.push(new AGL.Light(i,this[$_[51]],this[$_[72]],this[$_[91]],this[$_[76]],this[$_[70]]))};this[$_[34]]=this._collectLights.bind(this)};this._colorData=new Float32Array(10000*4);this._colorBuffer=this[$_[35]](this._colorData,"aFillCol",4,1,4,this._gl.FLOAT,4);this[$_[61]]=new Float32Array(10000*4);this._tintColorBuffer=this[$_[35]](this[$_[61]],"aTintCol",4,1,4,this._gl.FLOAT,4);this[$_[81]]=(this._config[$_[74]]?4:3);this[$_[103]]=new Float32Array(10000*this[$_[81]]);this._effectBuffer=this[$_[35]](this[$_[103]],"aFx",this[$_[81]],1,this[$_[81]],this._gl.FLOAT,4);this._setMaskDataFunc=this._config[$_[74]]?this._setMaskData.bind(this):emptyFunction;this[$_[71]]=0;this._resize()},function(e){get(this,"picked",function(){return this._picked});this.render=function(){this._preRender();this._picked=null;this[$_[71]]=0;this[$_[94]]();this._updateFog();this[$_[34]]();this._render();this[$_[100]]=!1};this.getLight=function(a){return this._lights[a]};this.setPickerPoint=function(x,y){this[$_[100]]=!0;this[$_[43]][0]=(x-this._widthHalf)*this[$_[102]][0];this[$_[43]][1]=(y-this._heightHalf)*this[$_[102]][4]};this._updateFog=function(){this.fog.isUpdated()&&this._gl.uniform4fv(this[$_[110]]["uFog"],this.fog.items)};this._collectLights=function(){this._gl.uniform2fv(this[$_[110]]["uLghtPos"],this[$_[51]]);this._gl.uniform2fv(this[$_[110]]["uLghtVol"],this[$_[72]]);this._gl.uniform4fv(this[$_[110]]["uLghtCol"],this[$_[91]]);this._gl.uniform4fv(this[$_[110]]["uLghtFX"],this[$_[76]]);this._gl.uniform1fv(this[$_[110]]["uLghtZIndices"],this[$_[70]])};this._drawItem=function(b,f){if(!b.renderable)return;b.props.zIndex=++this[$_[71]];b.update(this[$_[104]],f);b.type!=="item"&&this[$_[49]][b.type](b,f)};this._setMaskData=function(b){b.mask&&(this[$_[103]][this[$_[101]]*this[$_[81]]+3]=this[$_[93]](b.mask))};this[$_[64]]=function(b,f,l,c,g,j){e[$_[64]].call(this,b,f,l,c,g);arraySet(this._colorData,f[$_[111]],g);arraySet(this[$_[61]],b[$_[111]],g);this[$_[103]][j]=l;this[$_[103]][j+1]=b.tintType;this[$_[103]][j+2]=b.props.zIndex};this._drawImage=function(b,f){this[$_[54]](b);if(this[$_[100]]&&b.interactive&&AGL.Matrix3.isPointInMatrix(this[$_[43]],f[$_[102]],b[$_[102]],this._tempMatrix,this[$_[38]]))this._picked=b;this._setMaskDataFunc(b);var l=this[$_[93]](b.texture);this[$_[64]](b,f,l,this[$_[101]]*9,this[$_[101]]*4,this[$_[101]]*this[$_[81]]);++this[$_[101]]===10000&&this._batchDraw()};this[$_[90]]=function(){e[$_[90]].call(this);this[$_[45]](this._colorBuffer,this._colorData);this[$_[45]](this._tintColorBuffer,this[$_[61]]);this[$_[45]](this._effectBuffer,this[$_[103]])};this._resize=function(){if(!e._resize.call(this))return;this._widthHalf=this._width*0.5;this._heightHalf=this._height*0.5;this._gl.uniform2f(this[$_[110]]["uRes"],this._width/this._height,100/this._width)};this[$_[94]]=function(){this.color.isUpdated()&&this[$_[27]]++}});cnst(AGL.Stage2D,"MAX_LIGHT_SOURCES",16);AGL.Stage2D[$_[29]]=function(d){var m=d.lightNum;var h="#version 300 es\n";h+="in vec2 aPos;in mat3 aMat;in mat3 aWorldMat;in mat3 aTexMat;in vec4 aTexCrop;in vec4 aFillCol;in vec4 aTintCol;in vec"+(d[$_[74]]?"4":"3")+" aFx;";h+="uniform vec2 uRes;uniform vec4 uFog;";if(d[$_[60]]){h+="uniform vec2 uLghtPos["+m+"];uniform vec2 uLghtVol["+m+"];uniform vec4 uLghtCol["+m+"];uniform vec4 uLghtFX["+m+"];uniform float uLghtZIndices["+m+"];"};h+="out vec2 vTexCrd;out vec4 vCrd;out vec2 vMskCrd;out vec2 vTexCrop;out vec2 vTexCropSize;out vec4 vFillCol;out vec4 vTintCol;out float vTexId;out float vTintType;out float vColMult;out vec4 vFogCol;";if(d[$_[74]])h+="out float vMskTexId;";if(d[$_[60]]){h+="vec4 lghtVal(vec4 pos,vec2 lghtPos,vec2 lghtVol,vec4 lghtCol,vec4 lghtFX){vec2 dist=pos.xy-lghtPos;return lghtCol*lghtCol.a*max(0.,min(1.,1.-sqrt(pow(abs(dist.x+(abs(dist.x)*lghtFX.x)),lghtFX.z)*(lghtVol.x/uRes.y)+pow(abs(dist.y+(abs(dist.y)*lghtFX.y)),lghtFX.w)*(lghtVol.y/uRes.x/uRes.y))));}"};h+="void main(void){vec3 pos=vec3(aPos,1);gl_Position=vec4((aWorldMat*aMat*pos).xy,0,1);vTexCrd=(aTexMat*pos).xy;vCrd=gl_Position;vMskCrd=(vCrd.xy+vec2(1,-1))/vec2(2,-2);vTexCrop=aTexCrop.xy;vTexCropSize=aTexCrop.zw;vFillCol=aFillCol;vTintCol=aTintCol;vTexId=aFx.x;vTintType=aFx.y;";h+="vec4 lghtCol=vec4(0);";if(d[$_[60]]){for(var i=0;i<m;i++){h+="if(uLghtCol["+i+"].a>0. && uLghtZIndices["+i+"]>aFx.z){lghtCol+=lghtVal(vCrd,uLghtPos["+i+"],uLghtVol["+i+"],uLghtCol["+i+"],uLghtFX["+i+"]);}"}};h+="float colLghtMult=max(0.,uFog.a-lghtCol.a);vColMult=max(0.,1.-colLghtMult);vFogCol=vec4(uFog.rgb*colLghtMult,0);vFillCol+=lghtCol;";if(d[$_[74]])h+="vMskTexId=aFx.w;";h+="}";return h};AGL.Stage2D[$_[14]]=function(d){var n=d[$_[109]];var h="#version 300 es\nprecision lowp float;in vec4 vCrd;in vec2 vMskCrd;in vec2 vTexCrd;in vec2 vTexCrop;in vec2 vTexCropSize;in vec4 vFillCol;in vec4 vTintCol;in float vTexId;in float vTintType;in float vColMult;in vec4 vFogCol;";if(d[$_[74]])h+="in float vMskTexId;";h+="uniform sampler2D uTex["+n+"];";h+="out vec4 fgCol;";h+="void main(void){";if(d[$_[74]]){h+="float mskAlpha=1.;if(vMskTexId>0.){";for(var i=0;i<n;i++){h+=(i>0?" else ":"")+"if(vMskTexId<"+(i+1)+".5){mskAlpha=texture(uTex["+i+"],vMskCrd).r;if(mskAlpha==0.)discard;}"};h+="}"};for(var i=-1;i<n;i++){h+=(i>-1?" else ":"")+"if(vTexId<"+(i+1)+".5){";h+="fgCol="+(i<0?"vec4(0);":"texture(uTex["+i+"],vTexCrop+vTexCropSize*fract(vTexCrd));");h+="if(fgCol.a==0.) discard;}"};h+="if(fgCol.a>.0){if(vTintType<.5) fgCol*=vTintCol;else if(vTintType<1.5 && fgCol.r==fgCol.g && fgCol.r==fgCol.b) fgCol*=vTintCol;else if(vTintType<2.5) fgCol=vec4((fgCol.rgb*(1.-vTintCol.a))+(vTintCol.rgb*vTintCol.a),fgCol.a);";h+="vec4 finalCol=vec4(fgCol.rgb*vColMult,fgCol.a);fgCol=(finalCol*vFillCol)+vFogCol;";if(d[$_[74]])h+="fgCol.a*=mskAlpha;";h+="}}";return h};AGL[$_[57]]=c4(BasePrototypeClass,function e(){BasePrototypeClass.call(this);this.type=this.subType=0;this._values=new Float32Array(9);this._width=this._height=0;this._gl=this[$_[21]]=this[$_[98]]=null},function(){get(this,"framebufferTexture",function(){return this[$_[21]]});get(this,"framebuffer",function(){return this[$_[98]]});get(this,"values",function(){return this._values});prop(this,"intensity",{get:function(){return this._values[0]},set:function(v){this._values[0]=v},});this.updateFramebuffer=function(a,b,d){if(b>0&&d>0&&(!this[$_[98]]||this._gl!==a||this._width!==b||this._height!==d)){this[$_[21]]&&this._gl.deleteTexture(this[$_[21]]);this[$_[98]]&&this._gl.deleteFramebuffer(this[$_[98]]);this._width=b;this._height=d;this._gl=a;this[$_[21]]=a.createTexture();this[$_[107]](a,0);a.texImage2D(a[$_[112]],0,a.RGBA,this._width,this._height,0,a.RGBA,a.UNSIGNED_BYTE,null);this[$_[98]]=a.createFramebuffer();a[$_[53]](a.FRAMEBUFFER,this[$_[98]]);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a[$_[112]],this[$_[21]],0)}};this[$_[107]]=function(a,c){a.activeTexture(a.TEXTURE0+c);a[$_[107]](a[$_[112]],this[$_[21]]);a[$_[75]](a[$_[112]],a.TEXTURE_WRAP_S,a[$_[73]]);a[$_[75]](a[$_[112]],a.TEXTURE_WRAP_T,a[$_[73]]);a[$_[75]](a[$_[112]],a[$_[25]],a.NEAREST);a[$_[75]](a[$_[112]],a[$_[24]],a.NEAREST)}});cnst(AGL[$_[57]],"CONVOLUTE_TYPE",1);cnst(AGL[$_[57]],"COLOR_MANIPULATION_TYPE",2);AGL.BlurFilter=c4(AGL[$_[57]],function c(b,a){AGL[$_[57]].call(this);this.type=3;this.blurX=b;this.blurY=a},function(){prop(this,"blurX",{get:function(){return this._values[0]},set:function(v){this._values[0]=v},});prop(this,"blurY",{get:function(){return this._values[1]},set:function(v){this._values[1]=v},})});AGL.EdgeDetectFilter=c4(AGL[$_[57]],function a(){AGL[$_[57]].call(this);this.type=1;this._values.set([-1,-1,-1,-1,8,-1,-1,-1,-1],0)});AGL.SharpenFilter=c4(AGL[$_[57]],function a(){AGL[$_[57]].call(this);this.type=1;this._values.set([-1,-1,-1,-1,16,-1,-1,-1,-1],0)});AGL.PixelateFilter=c4(AGL[$_[57]],function b(a){AGL[$_[57]].call(this);this.type=4;this.intensity=a});AGL.GlowFilter=c4(AGL[$_[57]],function a(b,c){AGL[$_[57]].call(this);this.type=5;this.intensityX=b;this.intensityY=c},function(){prop(this,"intensityX",{get:function(){return this._values[0]},set:function(v){this._values[0]=v},});prop(this,"intensityY",{get:function(){return this._values[1]},set:function(v){this._values[1]=v},})});AGL[$_[19]]=c4(AGL[$_[57]],function b(a){AGL[$_[57]].call(this);this.type=2;this.subType=a});AGL.GrayscaleFilter=c4(AGL[$_[19]],function a(){AGL[$_[19]].call(this,1)});AGL.SepiaFilter=c4(AGL[$_[19]],function a(){AGL[$_[19]].call(this,2)});AGL.InvertFilter=c4(AGL[$_[19]],function a(){AGL[$_[19]].call(this,3)});AGL.TintFilter=c4(AGL[$_[19]],function a(r,g,b){AGL[$_[19]].call(this,4);this.r=r;this.g=g;this.b=b},function(){prop(this,"r",{get:function(){return this._values[0]},set:function(v){this._values[0]=v}});prop(this,"g",{get:function(){return this._values[1]},set:function(v){this._values[1]=v}});prop(this,"b",{get:function(){return this._values[2]},set:function(v){this._values[2]=v}})});AGL.ColorLimitFilter=c4(AGL[$_[19]],function b(a){AGL[$_[19]].call(this,5);this.intensity=a});AGL.VignetteFilter=c4(AGL[$_[19]],function a(){AGL[$_[19]].call(this,6)});AGL.RainbowFilter=c4(AGL[$_[19]],function a(){AGL[$_[19]].call(this,7)});AGL.LinesFilter=c4(AGL[$_[19]],function a(){AGL[$_[19]].call(this,8)});AGL.BrightnessContrastFilter=c4(AGL[$_[19]],function c(b,a){AGL[$_[19]].call(this,9);this.brightness=b;this.contrast=a},function(){prop(this,"brightness",{get:function(){return this._values[0]},set:function(v){this._values[0]=v}});prop(this,"contrast",{get:function(){return this._values[1]},set:function(v){this._values[1]=v}})});AGL.GammaFilter=c4(AGL[$_[19]],function b(a){AGL[$_[19]].call(this,10);this.intensity=a});AGL.DisplacementFilter=c4(AGL[$_[57]],function c(a,b,x,y){AGL[$_[57]].call(this);this.type=6;this.texture=a;this.intensity=b;this.x=x;this.y=y},function(){prop(this,"x",{get:function(){return this._values[1]},set:function(v){this._values[1]=v||0},});prop(this,"y",{get:function(){return this._values[2]},set:function(v){this._values[2]=v||0},})});}).call({});