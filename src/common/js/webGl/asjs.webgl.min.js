(function(){"use strict";Array.prototype.addUnique=function(item){this.indexOf(item)==-1&&this.push(item)};Array.prototype.has=function(item){return this.indexOf(item)>-1};Array.prototype.remove=function(item){var a=this.indexOf(item);a>-1&&this.splice(a,1)};Array.prototype.clone=function(){return this.slice(0)};Array.prototype.equal=function(arr){if(!arr||arr.length!==this.length)return!1;for(var i=0;i<this.length;i++){if(this[i]!==arr[i])return!1};return!0};var arraySet=function(target,source,from){var i=0;var l=source.length;while(i<l){target[from+i]=source[i];++i}};var trace=console.log;var trc=trace;try{trc("")}catch(e){console.log(e);trace=function(){}};trc=trace;console.clear();var _d=document;var _w=window;var _m=Math;var _crel=_d.createElement;var property=function(t,n,v){v.enumerable=!0;v.configurable=!0;Object.defineProperty(t,n,v)};var prop=property;var get=function(t,n,v){prop(t,n,{get:v})};var set=function(t,n,v){prop(t,n,{set:v})};var constant=function(t,n,v){prop(t,n,{value:v})};var cnst=constant;cnst(_w,"on","addEventListener");cnst(_w,"off","removeEventListener");cnst(_w,"offAll","removeEventListeners");cnst(_w,"de","dispatchEvent");cnst(_w,"has","hasEventListener");var empty=function(a){try{return a===undefined||a===null||a===""||a.length===0}catch(e){return!0}};var emp=empty;var map=function(o,cb){for(var k in o){if(!o.hasOwnProperty(k))continue;var v=cb(k,o[k]);if(!emp(v))o[k]=v}};var emptyFunction=function(){};var ef=emptyFunction;var createPrototypeClass=function(parent,construct,body){var a=parent.prototype;var b=construct.prototype;Object.setPrototypeOf(construct,parent);Object.setPrototypeOf(b,a);b.constructor=construct;body&&body.call(b,a);return construct};var c4=createPrototypeClass;var deleteProperty=function(t,p){var a=Object.getOwnPropertyDescriptor(t,p);if(a&&(a.get||a.set))prop(t,p,{set:ef,get:ef});else{try{t[p]=null}catch(e){}};delete t[p]};var del=deleteProperty;var destructObjectFlat=function(t,stack){ito(t,function(a,b,c){del(t,a);c()});t=null};var destObjFlat=destructObjectFlat;var BasePrototypeClass=c4(Object,function a(){},function(){this.destruct=function(){destObjFlat(this)};this.toObject=function(){return JSON.parse(JSON.stringify(this))}});trc("AGL 1.0");_w.AGL={};AGL.CreateConfig=function(options){var c="Maximum of ";if(options.textureNum===undefined||options.textureNum>AGL.Utils.info.maxTextureImageUnits){console.warn(c+"texture units is "+16);options.textureNum=AGL.Utils.info.maxTextureImageUnits};if(options.lightNum===undefined)options.lightNum=0;else if(options.lightNum>16){console.warn(c+"lights is "+16);options.lightNum=16};var b=options.contextAttributes||{};var a={"textureNum":options.textureNum,"lightNum":options.lightNum,"isLightEnabled":options.lightNum>0,"isMaskEnabled":options.isMaskEnabled,"filters":options.filters,"isFilterEnabled":options.filters&&options.filters.length>0,"contextAttributes":{"alpha":b.alpha||!1,"antialias":b.antialias||!1,"depth":b.depth||!1,"stencil":b.stencil||!1,"premultipliedAlpha":b.premultipliedAlpha||!1,"powerPreference":b.powerPreference||"high-performance"}};Object.freeze(a);return a};(function(){var f="ONE_MINUS_SRC_ALPHA";var g="ONE_MINUS_SRC_COLOR";var c="SRC_ALPHA";var d="DST_ALPHA";var a="ONE";function e(b){return{"funcName":b.length===2?"blendFunc":"blendFuncSeparate","funcs":b}};AGL.BlendModes={"NORMAL":e([c,f,a,f]),"ADD":e([c,d,a,d]),"MULTIPLY":e(["DST_COLOR",f]),"SCREEN":e([c,g,a,g]),"OVERLAY":e([a,f])};Object.freeze(AGL.BlendModes)})();AGL.AbstractProps=c4(BasePrototypeClass,function b(){BasePrototypeClass.call(this);this._id=-1;this._curId=-1},function(){this.isUpdated=function(){var a=this._curId!==this._id;this._curId=this._id;return a}});AGL.ColorProps=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this._v=[1,1,1,1];this.items=this._v},function(){prop(this,"r",{get:function(){return this._v[0]},set:function(v){if(this._v[0]!==v){this._v[0]=v;++this._id}}});prop(this,"g",{get:function(){return this._v[1]},set:function(v){if(this._v[1]!==v){this._v[1]=v;++this._id}}});prop(this,"b",{get:function(){return this._v[2]},set:function(v){if(this._v[2]!==v){this._v[2]=v;++this._id}}});prop(this,"a",{get:function(){return this._v[3]},set:function(v){if(this._v[3]!==v){this._v[3]=v;++this._id}}})});AGL.ItemProps=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this._sWUId=0;this._curSWUId=-1;this._sHUId=0;this._curSHUId=-1;this._rUId=0;this._curSRUId=-1;this._curCRUId=-1;this._sW=1;this._sH=1;this._sr=0;this._cr=1;this._x=0;this._y=0;this._zId=0;this._r=0;this._sX=1;this._sY=1;this._w=1;this._h=1;this._aX=0;this._aY=0},function(){get(this,"scaledWidth",function(){if(this._curSWUId!==this._sWUId){this._curSWUId=this._sWUId;this._sW=this._w*this._sX};return this._sW});get(this,"scaledHeight",function(){if(this._curSHUId!==this._sHUId){this._curSHUId=this._sHUId;this._sH=this._h*this._sY};return this._sH});get(this,"sinR",function(){if(this._curSRUId!==this._rUId){this._curSRUId=this._rUId;this._sr=_m.sin(this._r)};return this._sr});get(this,"cosR",function(){if(this._curCRUId!==this._rUId){this._curCRUId=this._rUId;this._cr=_m.cos(this._r)};return this._cr});get(this,"scaledHeight",function(){if(this._curSHUId!==this._sHUId){this._curSHUId=this._sHUId;this._sH=this._h*this._sY};return this._sH});prop(this,"x",{get:function(){return this._x},set:function(v){if(this._x!==v){this._x=v;++this._id}}});prop(this,"y",{get:function(){return this._y},set:function(v){if(this._y!==v){this._y=v;++this._id}}});prop(this,"zIndex",{get:function(){return this._zId},set:function(v){this._zId!==v&&(this._zId=v)}});prop(this,"rotation",{get:function(){return this._r},set:function(v){if(this._r!==v){this._r=v;++this._rUId;++this._id}}});prop(this,"scaleX",{get:function(){return this._sX},set:function(v){if(this._sX!==v){this._sX=v;++this._sWUId;++this._id}}});prop(this,"scaleY",{get:function(){return this._sY},set:function(v){if(this._sY!==v){this._sY=v;++this._sHUId;++this._id}}});prop(this,"width",{get:function(){return this._w},set:function(v){if(this._w!==v){this._w=v;++this._sWUId;++this._id}}});prop(this,"height",{get:function(){return this._h},set:function(v){if(this._h!==v){this._h=v;++this._sHUId;++this._id}}});prop(this,"anchorX",{get:function(){return this._aX},set:function(v){if(this._aX!==v){this._aX=v;++this._id}}});prop(this,"anchorY",{get:function(){return this._aY},set:function(v){if(this._aY!==v){this._aY=v;++this._id}}})});AGL.LightEffectProps=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this._v=[0,0,2,2];this.items=this._v},function(){prop(this,"anchorX",{get:function(){return this._v[0]},set:function(v){if(this._v[0]!==v){this._v[0]=v;++this._id}}});prop(this,"anchorY",{get:function(){return this._v[1]},set:function(v){if(this._v[1]!==v){this._v[1]=v;++this._id}}});prop(this,"quadX",{get:function(){return this._v[2]},set:function(v){if(this._v[2]!==v){this._v[2]=v;++this._id}}});prop(this,"quadY",{get:function(){return this._v[3]},set:function(v){if(this._v[3]!==v){this._v[3]=v;++this._id}}})});AGL.TextureCrop=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this._v=[0,0,1,1];this.items=this._v},function(){prop(this,"x",{get:function(){return this._v[0]},set:function(v){if(this._v[0]!==v){this._v[0]=v;++this._id}}});prop(this,"y",{get:function(){return this._v[1]},set:function(v){if(this._v[1]!==v){this._v[1]=v;++this._id}}});prop(this,"width",{get:function(){return this._v[2]},set:function(v){if(this._v[2]!==v){this._v[2]=v;++this._id}}});prop(this,"height",{get:function(){return this._v[3]},set:function(v){if(this._v[3]!==v){this._v[3]=v;++this._id}}})});AGL.TextureProps=c4(AGL.AbstractProps,function a(){AGL.AbstractProps.call(this);this._rUId=0;this._curSRUId=-1;this._curCRUId=-1;this._sr=0;this._cr=1;this._x=0;this._y=0;this._r=0;this._w=1;this._h=1;this._aX=0;this._aY=0},function(){get(this,"sinR",function(){if(this._curSRUId!==this._rUId){this._curSRUId=this._rUId;this._sr=_m.sin(this._r)};return this._sr});get(this,"cosR",function(){if(this._curCRUId!==this._rUId){this._curCRUId=this._rUId;this._cr=_m.cos(this._r)};return this._cr});prop(this,"x",{get:function(){return this._x},set:function(v){if(this._x!==v){this._x=v;++this._id}}});prop(this,"y",{get:function(){return this._y},set:function(v){if(this._y!==v){this._y=v;++this._id}}});prop(this,"rotation",{get:function(){return this.this._r},set:function(v){if(this.this._r!==v){this.this._r=v;++this._rUId;++this._id}}});prop(this,"width",{get:function(){return this._w},set:function(v){if(this._w!==v){this._w=v;++this._id}}});prop(this,"height",{get:function(){return this._h},set:function(v){if(this._h!==v){this._h=v;++this._id}}});prop(this,"anchorX",{get:function(){return this._aX},set:function(v){if(this._aX!==v){this._aX=v;++this._id}}});prop(this,"anchorY",{get:function(){return this._aY},set:function(v){if(this._aY!==v){this._aY=v;++this._id}}})});AGL.Matrix3={isPointInMatrix:function(j,b,a,l,o){l[0]=b[0]*a[0]+b[3]*a[1];l[1]=b[1]*a[0]+b[4]*a[1];l[2]=b[0]*a[3]+b[3]*a[4];l[3]=b[1]*a[3]+b[4]*a[4];l[4]=b[0]*a[6]+b[3]*a[7]+b[6];l[5]=b[1]*a[6]+b[4]*a[7]+b[7];var d=1/(l[0]*l[3]-l[2]*l[1]);o[0]=d*l[3];o[1]=-d*l[1];o[2]=-d*l[2];o[3]=d*l[0];o[4]=d*(l[2]*l[5]-l[3]*l[4]);o[5]=-d*(l[0]*l[5]-l[1]*l[4]);var x=j[0]*o[0]+j[1]*o[2]+o[4];var y=j[0]*o[1]+j[1]*o[3]+o[5];return x>=0&&y>=0&&x<=1&&y<=1},identity:function(){return new Float32Array([1,0,0,0,1,0,0,0,1,])},projection:function(n,p,k){k[0]=2/n;k[1]=0;k[2]=0;k[3]=0;k[4]=-2/p;k[5]=0;k[6]=-1;k[7]=1;k[8]=1},transformLocal:function(x,y,c,e,f,g,h,i,k){k[0]=e*h;k[1]=c*h;k[3]=-c*i;k[4]=e*i;k[6]=x-(f*k[0])-(g*k[3]);k[7]=y-(f*k[1])-(g*k[4])},transform:function(m,x,y,c,e,f,g,h,i,k){k[0]=(e*m[0])+(c*m[3]);k[1]=(e*m[1])+(c*m[4]);k[3]=(e*m[3])-(c*m[0]);k[4]=(e*m[4])-(c*m[1]);k[6]=-(f*k[0])-(g*k[3])+(x*m[0])+(y*m[3])+m[6];k[7]=-(f*k[1])-(g*k[4])+(x*m[1])+(y*m[4])+m[7];k[0]*=h;k[1]*=h;k[3]*=i;k[4]*=i}};Object.freeze(AGL.Matrix3);(function(){var c=c4(BasePrototypeClass,function c(){BasePrototypeClass.call(this);this.info={"isWebGl2Supported":!1};var h=_crel.call(_d,"canvas");var a;if(a=h.getContext("webgl2")){this.info.isWebGl2Supported=!0;this.info.maxTextureImageUnits=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.info.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.info.maxVertexAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.info.maxVaryingVectors=a.getParameter(a.MAX_VARYING_VECTORS);this.info.maxVertexUniformVectors=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.info.maxFragmentUniformComponents=a.getParameter(a.MAX_FRAGMENT_UNIFORM_COMPONENTS);this.info.maxFragmentUniformVectors=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.info.maxVaryingComponents=a.getParameter(a.MAX_VARYING_COMPONENTS)}},function(){this.useTexture=function(a,e,q){a.activeTexture(a.TEXTURE0+e);a.bindTexture(q.target,q.texture);a.texImage2D(q.target,0,a.RGBA,q.width,q.height,0,a.RGBA,a.UNSIGNED_BYTE,q.source);a.texParameteri(q.target,a.TEXTURE_MAX_LEVEL,q.maxLevel);if(q.generateMipmap){a.generateMipmap(q.target);a.flush()};a.texParameteri(q.target,a.TEXTURE_WRAP_S,q.wrapS);a.texParameteri(q.target,a.TEXTURE_WRAP_T,q.wrapT);if(q.generateMipmap){a.texParameteri(q.target,a.TEXTURE_MIN_FILTER,q.minFilter===a.LINEAR?a.LINEAR_MIPMAP_LINEAR:a.NEAREST_MIPMAP_NEAREST)}else{a.texParameteri(q.target,a.TEXTURE_MIN_FILTER,q.minFilter)};a.texParameteri(q.target,a.TEXTURE_MIN_FILTER,q.minFilter);a.texParameteri(q.target,a.TEXTURE_MAG_FILTER,q.magFilter)};this.loadShader=function(p,a,s){var g=a.createShader(a[p]);a.shaderSource(g,s);a.compileShader(g);var m=a.getShaderParameter(g,a.COMPILE_STATUS);if(!m){var n=a.getShaderInfoLog(g);trc("Error compiling shader "+p+":"+n);a.deleteShader(g);return null};return g};this.loadVertexShader=this.loadShader.bind(this,"VERTEX_SHADER");this.loadFragmentShader=this.loadShader.bind(this,"FRAGMENT_SHADER");this.createProgram=function(a,l,r,t){var j=a.createProgram();map(l,function(b,g){a.attachShader(j,g)});if(r){map(r,function(b,i){a.bindAttribLocation(j,t?t[b]:b,i)})};a.linkProgram(j);var f=a.getProgramParameter(j,a.LINK_STATUS);if(!f){var n=a.getProgramInfoLog(j);trc("Error in program linking:"+n);a.deleteProgram(j);return null};a.flush();return j};this.getLocationsFor=function(a,j,v){var o={};map(v,function(b,u){o[b]=a[u](j,b)});return o};this.destroyTexture=function(a,k){a.bindTexture(k.target,null);a.deleteTexture(k.texture)};this.isPowerOf2=function(d){return(d&(d-1))==0}});AGL.Utils=new c();Object.freeze(AGL.Utils)})();AGL.Texture=c4(BasePrototypeClass,function f(a,d){BasePrototypeClass.call(this);this._source;this._onTextureLoadedBind=this._onTextureLoaded.bind(this);this._generateMipmap=!1;this._loaded=!1;this.isVideo=!1;this.shouldUpdate=!1;this.texture=a.createTexture();this.maxLevel=10;this.target=a.TEXTURE_2D;this.wrapS=a.CLAMP_TO_EDGE;this.wrapT=a.CLAMP_TO_EDGE;this.minFilter=a.NEAREST;this.magFilter=a.NEAREST;this.source=d;this._srcWProp="width";this._srcHProp="height";this._eventType;this._curRenderId=-1},function(e){get(this,"generateMipmap",function(){return this._generateMipmap});get(this,"loaded",function(){return this._loaded});get(this,"width",function(){return this._source[this._srcWProp]});get(this,"height",function(){return this._source[this._srcHProp]});prop(this,"source",{get:function(){return this._source},set:function(v){this._source&&this._source[off](this._eventType,this._onTextureLoadedBind);this._source=v;this.isVideo=this._getSourceType()==="video";this._eventType=this.isVideo?"canplay":"load";this._parseTextureSize();this._source[on](this._eventType,this._onTextureLoadedBind)}});this.autoUpdate=function(h){var i=h!==this._curRenderId;this._curRenderId=h;return i&&(this.shouldUpdate||(this.isVideo&&!this._source.paused))};this.destruct=function(){this._source&&this._source[off](this._eventType,this._onTextureLoadedBind);e.destruct.call(this)};this._parseTextureSize=function(){this._srcWProp="naturalWidth";this._srcHProp="naturalHeight";if(!this._source[this._srcWProp]){this._srcWProp="videoWidth";this._srcHProp="videoHeight"};if(!this._source[this._srcWProp]){this._srcWProp="width";this._srcHProp="height"};this._generateMipmap=AGL.Utils.isPowerOf2(this.width)&&AGL.Utils.isPowerOf2(this.height);this._loaded=this._getSourceType()==="canvas"||this.width>0&&this.height>0};this._getSourceType=function(){return this._source.tagName.toLowerCase()};this._onTextureLoaded=this._parseTextureSize});AGL.Texture.loadImage=function(a,src){var b=_crel.call(_d,"img");var g=new AGL.Texture(a,b);b.src=src;return g};AGL.Texture.loadVideo=function(a,src){var c=_crel.call(_d,"video");var g=new AGL.Texture(a,c);c.src=src;return g};AGL.Item=c4(BasePrototypeClass,function a(){BasePrototypeClass.call(this);cnst(this,"type","item");this.renderable=!0;this.interactive=!1;this.matrixCache=AGL.Matrix3.identity();this.props=new AGL.ItemProps();this.color=new AGL.ColorProps();this.colorCache=this.color.items;this.parent=null},function(c){get(this,"stage",function(){return this.parent?this.parent.stage:null});this.destruct=function(){this.parent&&this.parent.removeChild&&this.parent.removeChild(this);c.destruct.call(this)};this.update=function(e,d){this._updateProps(d)};this._updateProps=function(d){var b=this.props;b.isUpdated()&&this._transformItem(b,d)};this._transformItem=function(b,d){AGL.Matrix3.transform(d.matrixCache,b.x,b.y,b.sinR,b.cosR,b.anchorX,b.anchorY,b.scaledWidth,b.scaledHeight,this.matrixCache)}});cnst(AGL.Item,"TYPE","item");AGL.Light=c4(AGL.Item,function a(){AGL.Item.call(this);this._curWorldPropsId=-1;this.positionCache=[];this.volumeCache=[];this.effect=new AGL.LightEffectProps();this.effectCache=this.effect.items;this.color.a=0},function(){this._updateProps=function(c){var b=this.props;if(this._curWorldPropsId!==c.worldPropsUpdateId||b.isUpdated()){this._curWorldPropsId=c.worldPropsUpdateId;this._transformItem(b,c);this.positionCache[0]=this.matrixCache[6];this.positionCache[1]=this.matrixCache[7];this.volumeCache[0]=1/_m.abs(this.matrixCache[0]);this.volumeCache[1]=1/_m.abs(this.matrixCache[4])}}});AGL.Image=c4(AGL.Item,function a(d){AGL.Item.call(this);cnst(this,"type","drawable");this.textureMatrixCache=AGL.Matrix3.identity();this.mask=null;this.tintType=AGL.Image.Tint.NORMAL;this.blendMode=AGL.BlendModes.NORMAL;this.textureProps=new AGL.TextureProps();this.textureCrop=new AGL.TextureCrop();this.textureCropCache=this.textureCrop.items;this.texture=d},function(){this.mouseOver=function(){};this.update=function(){this._updateProps();this._updateTextureProps()};this._updateProps=function(){var b=this.props;b.isUpdated()&&this._transformItem(b,this.matrixCache)};this._updateTextureProps=function(){var e=this.textureProps;e.isUpdated()&&this._transformItem(e,this.textureMatrixCache)};this._transformItem=function(b,c){AGL.Matrix3.transformLocal(b.x,b.y,b.sinR,b.cosR,b.anchorX,b.anchorY,b.scaledWidth,b.scaledHeight,c)}});cnst(AGL.Image,"TYPE","drawable");cnst(AGL.Image,"Tint",{"NORMAL":0,"GRAYSCALE":1,"OVERRIDE":2,});AGL.AnimatedImage=c4(AGL.Image,function g(c){AGL.Image.call(this,c);this.frameLength=120;this.frame=0;this.frames=[];this.isPlaying=!1;this._latestUpdate=-1},function(b){this.gotoAndStop=function(a){this.frame=a};this.gotoAndPlay=function(a){this.frame=a;this.play()};this.stop=function(){this.isPlaying=!1};this.play=function(){this.isPlaying=!0};this.update=function(d){this.updateAnimation(d);b.update.call(this)};this.updateAnimation=function(d){if(this.isPlaying){var f=d-this._latestUpdate;if(f>=this.frameLength){this._latestUpdate=d;this.frame+=_m.floor(f/this.frameLength);this.frame>=this.frames.length&&(this.frame=0);var h=this.frames[this.frame];var e=this.textureCrop;e.x=h.x;e.y=h.y;e.width=h.width;e.height=h.height}}};this.destruct=function(){this.stop();b.destruct.call(this)}});AGL.Container=c4(AGL.Item,function h(){AGL.Item.call(this);cnst(this,"type","container");this._curWorldPropsId=-1;this._curWorldColId=-1;this._children=[];this.worldPropsUpdateId=this.worldColorUpdateId=0;this.colorCache=[1,1,1,1]},function(){get(this,"children",function(){return this._children});get(this,"numChildren",function(){return this._children.length});this.clear=function(){while(this.numChildren)this.removeChildAt(0)};this.contains=function(a){return this.getChildIndex(a)>-1};this.addChild=function(a){return this.addChildAt(a,this.numChildren)};this.addChildAt=function(a,b){if(!a)return null;if(a.parent)a.parent.removeChild(a);this._children.push(a);this.setChildIndex(a,b);a.parent=this;return a};this.removeChild=function(a){if(!a||!this.contains(a))return null;_children.remove(a);a.parent=null;return a};this.removeChildAt=function(b){return this.removeChild(this.getChildAt(b))};this.getChildAt=function(b){return this._children[b]};this.setChildIndex=function(a,b){if(!a||b<0)return null;this._children.remove(a);this._children.splice(b,0,a);return a};this.getChildIndex=function(a){return this._children.indexOf(a)};this.swapChildren=function(e,f){var j=this.getChildIndex(e);var k=this.getChildIndex(f);if(j===-1||k===-1)return!1;this.setChildIndex(e,k);this.setChildIndex(f,j);return!0};this.update=function(i,g){this._updateProps(g);this._updateColor(g)};this._updateProps=function(g){var c=this.props;if(this._curWorldPropsId!==g.worldPropsUpdateId||c.isUpdated()){this._curWorldPropsId=g.worldPropsUpdateId;this.worldPropsUpdateId++;this._transformItem(c,g)}};this._updateColor=function(g){var d=this.color;if(this._curWorldColId!==g.worldColorUpdateId||d.isUpdated()){this._curWorldColId=g.worldColorUpdateId;this.worldColorUpdateId++;var l=g.colorCache;this.colorCache[0]=l[0]*d.r;this.colorCache[1]=l[1]*d.g;this.colorCache[2]=l[2]*d.b;this.colorCache[3]=l[3]*d.a}}});cnst(AGL.Container,"TYPE","container");AGL.BaseRenderer=c4(AGL.Container,function F(r,E,G,z,p){AGL.Container.call(this);this.clearColor=new AGL.ColorProps();cnst(this,"_MAX_BATCH_ITEMS",10000);this._width=0;this._height=0;this._resUpdId=0;this._curResUpdId=-1;this._renderId=0;this._latestBlendMode=AGL.BlendModes.NORMAL;this._batchItems=0;this._textureMap=[];this._textureIds=[];this._textureIdBufUpdated=!1;this._config=p;this._canvas=r;this._context=null;this._gl=this.context;this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);this._gl.enable(this._gl.BLEND);var t=AGL.Utils.createProgram(this._gl,[AGL.Utils.loadVertexShader(this._gl,E(this._config)),AGL.Utils.loadFragmentShader(this._gl,G(this._config))]);this._locations=AGL.Utils.getLocationsFor(this._gl,t,Object.assign(z||{},{"a_pos":"getAttribLocation","a_mat":"getAttribLocation","a_worldMat":"getAttribLocation","a_texMat":"getAttribLocation","a_texCrop":"getAttribLocation","u_tex":"getUniformLocation",}));this._gl.useProgram(t);this._setBlendMode();var D=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,D);this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0]),this._gl.STATIC_DRAW);this._gl.vertexAttribPointer(this._locations["a_pos"],2,this._gl.FLOAT,!1,0,0);this._gl.enableVertexAttribArray(this._locations["a_pos"]);var x=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,x);this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),this._gl.STATIC_DRAW);this._matrixDat=new Float32Array(10000*9);this._matrixBuf=this._createArBuf(this._matrixDat,"a_mat",9,3,3,this._gl.FLOAT,4);this._worldMatrixDat=new Float32Array(10000*9);this._worldMatrixBuf=this._createArBuf(this._matrixDat,"a_worldMat",9,3,3,this._gl.FLOAT,4);this._textureMatrixDat=new Float32Array(10000*9);this._textureMatrixBuf=this._createArBuf(this._textureMatrixDat,"a_texMat",9,3,3,this._gl.FLOAT,4);this._textureCropDat=new Float32Array(10000*4);this._textureCropBuf=this._createArBuf(this._textureCropDat,"a_texCrop",4,1,4,this._gl.FLOAT,4);this._drawFunctionMap={};this._drawFunctionMap["item"]=emptyFunction;this._drawFunctionMap["drawable"]=this._drawImage.bind(this);this._drawFunctionMap["container"]=this._drawContainer.bind(this);this._update=this._updateProps=emptyFunction;this._resize()},function(){get(this,"canvas",function(){return this._canvas});get(this,"stage",function(){return this});get(this,"context",function(){if(!this._context||(this._context.isContextLost&&this._context.isContextLost())){this._context=this._canvas.getContext("webgl2",this._config.contextAttributes)};return this._context});prop(this,"width",{get:function(){return this._width},set:function(v){if(this._width!==v){this._width=v;this._resUpdId++}}});prop(this,"height",{get:function(){return this._height},set:function(v){if(this._height!==v){this._height=v;this._resUpdId++}}});this.setSize=function(j,m){this.width=j;this.height=m};this.render=function(){this._resize();this._render()};this._render=function(){this.clear();this._renderTimer=Date.now();this._drawContainer(this);this._batchItems>0&&this._batchDraw();++this._renderId};this.clear=function(){var B=this.clearColor;B.isUpdated()&&this._gl.clearColor(B.r,B.g,B.b,B.a);this._gl.clear(this._gl.COLOR_BUFFER_BIT)};this._drawItem=function(e,k){if(!e.renderable)return;e.update(this._renderTimer,k);e.type!=="item"&&this._drawFunctionMap[e.type](e,k)};this._drawContainer=function(y){var u=y.children;var i;var l;for(i=0,l=u.length;i<l;++i)this._drawItem(u[i],y)};this._checkBlendMode=function(e){if(this._latestBlendMode!==e.blendMode){this._batchDraw();this._latestBlendMode=e.blendMode;this._setBlendMode()}};this._setBufDat=function(e,k,H,g,q){arraySet(this._worldMatrixDat,k.matrixCache,g);arraySet(this._matrixDat,e.matrixCache,g);arraySet(this._textureMatrixDat,e.textureMatrixCache,g);arraySet(this._textureCropDat,e.textureCropCache,q)};this._drawImage=function(e,k){this._checkBlendMode(e);var H=this._drawTex(e.texture);this._setBufDat(e,k,H,this._batchItems*9,this._batchItems*4);++this._batchItems===10000&&this._batchDraw()};this._createArBuf=function(d,A,o,b,c,f,h){var s=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s);this._gl.bufferData(this._gl.ARRAY_BUFFER,d.byteLength,this._gl.DYNAMIC_DRAW);this._attachArBuf(this._locations[A],s,d,o,b,c,f,h);return s};this._attachArBuf=function(w,s,d,o,b,c,f,h){this._bindArBuf(s,d);var n=h*o;var i=b+1;while(--i){var a=w+(b-i);this._gl.enableVertexAttribArray(a);this._gl["vertexAttrib"+(f===this._gl.FLOAT?"":"I")+"Pointer"](a,c,f,!1,n,(b-i)*h*c);this._gl.vertexAttribDivisor(a,1)}};this._bindArBuf=function(s,d){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s);this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,d)};this._bindBufs=function(){this._bindArBuf(this._matrixBuf,this._matrixDat);this._bindArBuf(this._worldMatrixBuf,this._worldMatrixDat);this._bindArBuf(this._textureMatrixBuf,this._textureMatrixDat);this._bindArBuf(this._textureCropBuf,this._textureCropDat)};this._batchDraw=function(){if(this._textureIdBufUpdated){this._textureIdBufUpdated=!1;var I=new Uint16Array(this._textureIds);this._gl.uniform1iv(this._locations["u_tex"],I)};this._bindBufs();this._gl.drawElementsInstanced(this._gl.TRIANGLE_FAN,6,this._gl.UNSIGNED_SHORT,0,this._batchItems);this._batchItems=0};this._drawTex=function(C){if(!C.loaded)return 0;var H=this._textureMap.indexOf(C);if(H===-1||C.autoUpdate(this._renderId)){if(H===-1){if(this._textureMap.length===this._config.textureNum){this._batchDraw();this._textureIds.length=this._textureMap.length=0};this._textureMap.push(C);H=this._textureMap.length-1;this._textureIds.push(H);this._textureIdBufUpdated=!0};AGL.Utils.useTexture(this._gl,H,C)};return H+1};this._setBlendMode=function(){this._gl[this._latestBlendMode.funcName](this._gl[this._latestBlendMode.funcs[0]],this._gl[this._latestBlendMode.funcs[1]],this._gl[this._latestBlendMode.funcs[2]],this._gl[this._latestBlendMode.funcs[3]])};this._resize=function(){if(this._resUpdId===this._curResUpdId)return!1;this._curResUpdId=this._resUpdId;this._canvas.width=this._width;this._canvas.height=this._height;this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight);AGL.Matrix3.projection(this._width,this._height,this.matrixCache);this.worldPropsUpdateId++;return!0}});AGL.BaseRenderer.createVertexShader=function(){return"#version 300 es\nin vec2 a_pos;in mat3 a_mat;in mat3 a_worldMat;in mat3 a_texMat;in vec4 a_texCrop;out vec2 v_texCoord;out vec2 v_texCrop;out vec2 v_texCropSize;void main(void){vec3 pos=vec3(a_pos,1.0);gl_Position=vec4((a_worldMat*a_mat*pos).xy,0.0,1.0);v_texCoord=(a_texMat*pos).xy;v_texCrop=a_texCrop.xy;v_texCropSize=a_texCrop.zw-a_texCrop.xy;}"};AGL.BaseRenderer.createFragmentShader=function(){return"#version 300 es\nprecision lowp float;in vec2 v_texCoord;in vec2 v_texCrop;in vec2 v_texCropSize;out vec4 fgCol;void main(void){fgCol=vec4(1.0,0.0,1.0,1.0);}"};AGL.SimpleRenderer=c4(AGL.BaseRenderer,function k(c,j,l,d){AGL.BaseRenderer.call(this,c,j,l,{"a_texId":"getAttribLocation",},d);this._texIdDat=new Float32Array(10000);this._texIdBuf=this._createArBuf(this._texIdDat,"a_texId",1,1,1,this._gl.FLOAT,4)},function(e){this._setBufDat=function(a,f,m,b,g){e._setBufDat.call(this,a,f,m,b,g);this._texIdDat[this._batchItems]=m};this._bindBufs=function(){e._bindBufs.call(this);this._bindArBuf(this._texIdBuf,this._texIdDat)}});AGL.SimpleRenderer.createVertexShader=function(){var h="#version 300 es\nin vec2 a_pos;in mat3 a_mat;in mat3 a_worldMat;in mat3 a_texMat;in vec4 a_texCrop;in float a_texId;out vec2 v_texCoord;out vec2 v_texCrop;out vec2 v_texCropSize;out float v_texId;void main(void){vec3 pos=vec3(a_pos,1.0);gl_Position=vec4((a_worldMat*a_mat*pos).xy,0.0,1.0);v_texCoord=(a_texMat*pos).xy;v_texCrop=a_texCrop.xy;v_texCropSize=a_texCrop.zw-a_texCrop.xy;v_texId=a_texId;}";return h};AGL.SimpleRenderer.createFragmentShader=function(d){var n=d.textureNum;var h="#version 300 es\n#define MAX_TEXTURES "+n+"\nprecision lowp float;in vec2 v_texCoord;in vec2 v_texCrop;in vec2 v_texCropSize;in float v_texId;uniform sampler2D u_tex[MAX_TEXTURES];out vec4 fgCol;";h+="void main(void){";for(var i=-1;i<n;i++){h+=(i>-1?" else ":"")+"if(v_texId<"+(i+1)+".5){";h+="fgCol="+(i<0?"vec4(0.0,0.0,0.0,0.0);":"texture(u_tex["+i+"],v_texCrop+v_texCropSize*fract(v_texCoord));");h+="}"};h+="}";return h};AGL.MaskRenderer=c4(AGL.SimpleRenderer,function d(a,e,f,b){AGL.SimpleRenderer.call(this,a,e,f,b);this.clearColor.r=this.clearColor.g=this.clearColor.b=this.clearColor.a=0});AGL.MaskRenderer.createVertexShader=AGL.SimpleRenderer.createVertexShader;AGL.MaskRenderer.createFragmentShader=function(b){var g=b.textureNum;var c="#version 300 es\n#define MAX_TEXTURES "+g+"\nprecision lowp float;in vec2 v_texCoord;in vec2 v_texCrop;in vec2 v_texCropSize;in float v_texId;uniform sampler2D u_tex[MAX_TEXTURES];out vec4 fgCol;";c+="void main(void){";for(var i=-1;i<g;i++){c+=(i>-1?" else ":"")+"if(v_texId<"+(i+1)+".5){";c+=i<0?"fgCol=vec4(0.0,0.0,0.0,0.0);":"vec4 col=texture(u_tex["+i+"],v_texCrop+v_texCropSize*fract(v_texCoord));fgCol=vec4(vec3(1.0)*((col.r+col.g+col.b)/3.0),col.a);";c+="}"};c+="}";return c};AGL.Stage2D=c4(AGL.BaseRenderer,function q(g,o,p,h){AGL.BaseRenderer.call(this,g,o,p,{"a_fillCol":"getAttribLocation","a_tintCol":"getAttribLocation","a_fx":"getAttribLocation","u_res":"getUniformLocation","u_lightPos":"getUniformLocation","u_lightVol":"getUniformLocation","u_lightCol":"getUniformLocation","u_lightFX":"getUniformLocation","u_lightZIndices":"getUniformLocation","u_fog":"getUniformLocation","u_filters":"getUniformLocation",},h);this.fog=new AGL.ColorProps();this.fog.a=0;this.colorCache=this.color.items;this._DEFAULT_DUO=[0,0];this._DEFAULT_QUAD=[0,0,0,0];this._widthHalf=0;this._heightHalf=0;this._attachedLights=[];this._picked;this._isPickerSet=!1;this._tmpPickerVector=new Float32Array([0,0,1]);this._tmpMatrix=new Float32Array(6);this._tmpInverseMatrix=new Float32Array(6);if(this._config.isLightEnabled){this._lightPositions=new Float32Array(this._config.lightNum*2);this._lightVolumes=new Float32Array(this._config.lightNum*2);this._lightColors=new Float32Array(this._config.lightNum*4);this._lightEffects=new Float32Array(this._config.lightNum*4);this._lightZIndices=new Int32Array(this._config.lightNum)};this._collectLightsFunc=this._config.isLightEnabled?this._collectLights.bind(this):emptyFunction;this._colorDat=new Float32Array(10000*4);this._colorbuf=this._createArBuf(this._colorDat,"a_fillCol",4,1,4,this._gl.FLOAT,4);this._tintColorDat=new Float32Array(10000*4);this._tintColorbuf=this._createArBuf(this._tintColorDat,"a_tintCol",4,1,4,this._gl.FLOAT,4);this._effectLength=(this._config.isMaskEnabled?4:3);this._effectDat=new Float32Array(10000*this._effectLength);this._effectbuf=this._createArBuf(this._effectDat,"a_fx",this._effectLength,1,this._effectLength,this._gl.FLOAT,4);this._setMaskDatFunc=this._config.isMaskEnabled?this._setMaskDat.bind(this):emptyFunction;this._zIndexCounter=0;this._resize()},function(e){set(this,"filters",function(f){this._config.filters&&this._config.filters.length>0&&this._gl.uniform1i(this._locations["u_filters"],f)});get(this,"picked",function(){return this._picked});this.render=function(){this._resize();this._picked=null;this._zIndexCounter=0;this._updateColor();this._updateFog();this._collectLightsFunc();this._render();this._isPickerSet=!1};this.isLightAttached=function(d){return this._attachedLights.has(d)};this.attachLight=function(d){!this.isLightAttached(d)&&this._attachedLights.length<this._config.lightNum&&this._attachedLights.push(d)};this.detachLight=function(d){this._attachedLights.remove(d)};this.setPickerPoint=function(x,y){this._isPickerSet=!0;this._tmpPickerVector[0]=(x-this._widthHalf)*this.matrixCache[0];this._tmpPickerVector[1]=(y-this._heightHalf)*this.matrixCache[4]};this._updateFog=function(){this.fog.isUpdated()&&this._gl.uniform4fv(this._locations["u_fog"],this.fog.items)};this._collectLights=function(){var d;var b;var m;var i;var l;for(i=0,l=this._config.lightNum;i<l;++i){b=i*2;m=i*4;if(i>=this._attachedLights.length||!this._attachedLights[i].renderable){arraySet(this._lightPositions,this._DEFAULT_DUO,b);arraySet(this._lightVolumes,this._DEFAULT_DUO,b);arraySet(this._lightColors,this._DEFAULT_QUAD,m);arraySet(this._lightEffects,this._DEFAULT_QUAD,m);this._lightZIndices[i]=-1}else{d=this._attachedLights[i];arraySet(this._lightPositions,d.positionCache,b);arraySet(this._lightVolumes,d.volumeCache,b);arraySet(this._lightColors,d.colorCache,m);arraySet(this._lightEffects,d.effectCache,m);this._lightZIndices[i]=d.props.zIndex}};d=null;this._gl.uniform2fv(this._locations["u_lightPos"],this._lightPositions);this._gl.uniform2fv(this._locations["u_lightVol"],this._lightVolumes);this._gl.uniform4fv(this._locations["u_lightCol"],this._lightColors);this._gl.uniform4fv(this._locations["u_lightFX"],this._lightEffects);this._gl.uniform1fv(this._locations["u_lightZIndices"],this._lightZIndices)};this._drawItem=function(a,j){if(!a.renderable)return;a.props.zIndex=++this._zIndexCounter;a.update(this._renderTimer,j);a.type!=="item"&&this._drawFunctionMap[a.type](a,j)};this._setMaskDat=function(a){a.mask&&(this._effectDat[this._batchItems*this._effectLength+3]=this._drawTex(a.mask))};this._setBufDat=function(a,j,s,c,m,n){e._setBufDat.call(this,a,j,s,c,m);arraySet(this._colorDat,j.colorCache,m);arraySet(this._tintColorDat,a.colorCache,m);this._effectDat[n]=s;this._effectDat[n+1]=a.tintType;this._effectDat[n+2]=a.props.zIndex};this._drawImage=function(a,j){this._checkBlendMode(a);if(this._isPickerSet&&a.interactive&&AGL.Matrix3.isPointInMatrix(this._tmpPickerVector,j.matrixCache,a.matrixCache,this._tmpMatrix,this._tmpInverseMatrix))this._picked=a;this._setMaskDatFunc(a);var s=this._drawTex(a.texture);this._setBufDat(a,j,s,this._batchItems*9,this._batchItems*4,this._batchItems*this._effectLength);++this._batchItems===10000&&this._batchDraw()};this._bindBufs=function(){e._bindBufs.call(this);this._bindArBuf(this._colorbuf,this._colorDat);this._bindArBuf(this._tintColorbuf,this._tintColorDat);this._bindArBuf(this._effectbuf,this._effectDat)};this._resize=function(){if(e._resize.call(this)){this._widthHalf=this._width*0.5;this._heightHalf=this._height*0.5;this._gl.uniform2f(this._locations["u_res"],this._width/this._height,100/this._width)}};this._updateColor=function(){this.color.isUpdated()&&this.worldColorUpdateId++}});cnst(AGL.Stage2D,"MAX_LIGHT_SOURCES",16);cnst(AGL.Stage2D,"Filters",{});cnst(AGL.Stage2D.Filters,"NONE",0);cnst(AGL.Stage2D.Filters,"GRAYSCALE",1);cnst(AGL.Stage2D.Filters,"SEPIA",2);cnst(AGL.Stage2D.Filters,"INVERT",4);cnst(AGL.Stage2D.Filters,"COLORLIMIT",8);cnst(AGL.Stage2D.Filters,"VIGNETTE",16);cnst(AGL.Stage2D.Filters,"RAINBOW",32);cnst(AGL.Stage2D.Filters,"LINES",64);AGL.Stage2D.createVertexShader=function(h){var r=h.lightNum;var k="#version 300 es\n";if(h.isLightEnabled){k+="#define MAX_LIGHT_SOURCES "+r+"\n"};k+="in vec2 a_pos;in mat3 a_mat;in mat3 a_worldMat;in mat3 a_texMat;in vec4 a_texCrop;in vec4 a_fillCol;in vec4 a_tintCol;in vec"+(h.isMaskEnabled?"4":"3")+" a_fx;";k+="uniform vec2 u_res;uniform vec4 u_fog;";if(h.isLightEnabled){k+="uniform vec2 u_lightPos[MAX_LIGHT_SOURCES];uniform vec2 u_lightVol[MAX_LIGHT_SOURCES];uniform vec4 u_lightCol[MAX_LIGHT_SOURCES];uniform vec4 u_lightFX[MAX_LIGHT_SOURCES];uniform float u_lightZIndices[MAX_LIGHT_SOURCES];"};k+="out vec2 v_texCoord;out vec4 v_coord;out vec2 v_texCrop;out vec2 v_texCropSize;out vec4 v_fillCol;out vec4 v_tintCol;out float v_texId;out float v_tintType;out float v_colMult;out vec4 v_fogCol;";if(h.isMaskEnabled)k+="out float v_maskTexId;";if(h.isLightEnabled){k+="vec4 lightVal(vec4 pos,vec2 lightPos,vec2 lightVol,vec4 lightCol,vec4 lightFX){vec2 dist=pos.xy-lightPos;return lightCol*lightCol.a*max(0.0,min(1.0,1.0-sqrt(pow(abs(dist.x+(abs(dist.x)*lightFX.x)),lightFX.z)*(lightVol.x/u_res.y)+pow(abs(dist.y+(abs(dist.y)*lightFX.y)),lightFX.w)*(lightVol.y/u_res.x/u_res.y))));}"};k+="void main(void){vec3 pos=vec3(a_pos,1.0);gl_Position=vec4((a_worldMat*a_mat*pos).xy,0.0,1.0);v_texCoord=(a_texMat*pos).xy;v_coord=gl_Position;v_texCrop=a_texCrop.xy;v_texCropSize=a_texCrop.zw-a_texCrop.xy;v_fillCol=a_fillCol;v_tintCol=a_tintCol;v_texId=a_fx.x;v_tintType=a_fx.y;";k+="vec4 lightCol=vec4(0.0);";if(h.isLightEnabled){for(var i=0;i<r;i++){k+="if(u_lightCol["+i+"].a>0.0 && u_lightZIndices["+i+"]>a_fx.z){lightCol+=lightVal(v_coord,u_lightPos["+i+"],u_lightVol["+i+"],u_lightCol["+i+"],u_lightFX["+i+"]);}"}};k+="float colLightMult=max(0.0,u_fog.a-lightCol.a);v_colMult=max(0.0,1.0-colLightMult);v_fogCol=vec4(u_fog.rgb*colLightMult,0.0);v_fillCol+=lightCol;";if(h.isMaskEnabled)k+="v_maskTexId=a_fx.w;";k+="}";return k};AGL.Stage2D.createFragmentShader=function(h){var t=h.textureNum;var k="#version 300 es\n#define MAX_TEXTURES "+t+"\n";k+="precision lowp float;in vec4 v_coord;in vec2 v_texCoord;in vec2 v_texCrop;in vec2 v_texCropSize;in vec4 v_fillCol;in vec4 v_tintCol;in float v_texId;in float v_tintType;in float v_colMult;in vec4 v_fogCol;";if(h.isMaskEnabled)k+="in float v_maskTexId;";k+="uniform sampler2D u_tex[MAX_TEXTURES];";if(h.isFilterEnabled)k+="uniform int u_filters;";k+="out vec4 fgCol;";k+="void main(void){";if(h.isMaskEnabled){k+="float maskAlpha=1.0;if(v_maskTexId>0.0){";for(var i=0;i<t;i++){k+=(i>0?" else ":"")+"if(v_maskTexId<"+(i+1)+".5){maskAlpha=texture(u_tex["+i+"],(v_coord.xy+vec2(1.0,-1.0))/vec2(2.0,-2.0)).r;if(maskAlpha==0.0) discard;}"};k+="}"};for(var i=-1;i<t;i++){k+=(i>-1?" else ":"")+"if(v_texId<"+(i+1)+".5){";k+="fgCol="+(i<0?"vec4(0.0,0.0,0.0,0.0);":"texture(u_tex["+i+"],v_texCrop+v_texCropSize*fract(v_texCoord));");k+="if(fgCol.a==0.0) discard;}"};k+="if(fgCol.a>0.0){if(v_tintType<0.5) fgCol*=v_tintCol;else if(v_tintType<1.5 && fgCol.r==fgCol.g && fgCol.r==fgCol.b) fgCol*=v_tintCol;else if(v_tintType<2.5) fgCol=vec4((fgCol.rgb*(1.0-v_tintCol.a))+(v_tintCol.rgb*v_tintCol.a),fgCol.a);";k+="vec4 finalCol=vec4(fgCol.rgb*v_colMult,fgCol.a);fgCol=(finalCol*v_fillCol)+v_fogCol;";if(h.isFilterEnabled){k+="if(u_filters>0 && fgCol.a>0.0){";for(var i=0;i<h.filters.length;i++){k+="if(("+h.filters[i]+" & u_filters)>0){";switch(h.filters[i]){case 1:k+="fgCol=vec4(vec3(1.0)*((fgCol.r+fgCol.g+fgCol.b)/3.0),fgCol.a);";break;case 2:k+="fgCol=vec4(vec3(0.874,0.514,0.156)*((fgCol.r+(fgCol.g+fgCol.b))/3.0),fgCol.a);";break;case 4:k+="fgCol=abs(vec4(fgCol.rgb-1.0,fgCol.a));";break;case 8:k+="fgCol=vec4((floor((fgCol.rgb*256.0)/32.0)/256.0)*32.0,fgCol.a);";break;case 16:k+="float vignetteValue=(1.0-sqrt(pow(v_coord.x,4.0)+pow(v_coord.y,4.0)));fgCol*=vec4(vec3(vignetteValue),1);";break;case 32:k+="fgCol+=vec4(v_coord.x*0.15,v_coord.y*0.15,(v_coord.x-v_coord.y)*0.15,0);";break;case 64:k+="fgCol+=vec4(sin(v_coord.y*500.0)*0.2);";break};k+="}"};k+="}"};if(h.isMaskEnabled)k+="fgCol.a*=maskAlpha;";k+="}}";return k};}).call({});